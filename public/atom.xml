<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Zehai&#39;blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://zehai.info/"/>
  <updated>2020-05-30T01:40:04.967Z</updated>
  <id>http://zehai.info/</id>
  
  <author>
    <name>Zhang Zehai</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>deno</title>
    <link href="http://zehai.info/2020/05/29/2020-05-29-deno/"/>
    <id>http://zehai.info/2020/05/29/2020-05-29-deno/</id>
    <published>2020-05-29T08:18:55.000Z</published>
    <updated>2020-05-30T01:40:04.967Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0-Attention"><a href="#0-Attention" class="headerlink" title="0. Attention"></a>0. Attention</h1><p>æœ¬æ–‡ä¸ºä¸ªäººç¿»è¯‘ï¼Œå­¦ä¹ è¾“å‡ºï¼Œä»…ä¾›å‚è€ƒï¼Œæ¬¢è¿æŒ‡å‡ºç†è§£ä¸è¶³ä¹‹å¤„</p><h1 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h1><h1 id="2-Getting-Started"><a href="#2-Getting-Started" class="headerlink" title="2.Getting Started"></a>2.Getting Started</h1><h2 id="2-1-Installation"><a href="#2-1-Installation" class="headerlink" title="2.1 Installation"></a>2.1 Installation</h2><h2 id="2-2-Setup-your-environment"><a href="#2-2-Setup-your-environment" class="headerlink" title="2.2 Setup your environment"></a>2.2 Setup your environment</h2><h2 id="2-3-First-steps"><a href="#2-3-First-steps" class="headerlink" title="2.3 First steps"></a>2.3 First steps</h2><h3 id="2-3-1-helloworld"><a href="#2-3-1-helloworld" class="headerlink" title="2.3.1 helloworld"></a>2.3.1 helloworld</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"Welcome to Deno ğŸ¦•"</span>);</span><br><span class="line">deno run https:<span class="comment">//deno.land/std/examples/welcome.ts</span></span><br></pre></td></tr></table></figure><h3 id="2-3-2-Make-http-request"><a href="#2-3-2-Make-http-request" class="headerlink" title="2.3.2 Make http request"></a>2.3.2 Make http request</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url = Deno.args[<span class="number">0</span>];<span class="comment">//get url</span></span><br><span class="line"><span class="keyword">const</span> res = <span class="keyword">await</span> fetch(url);<span class="comment">//await response --&gt;res</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> body = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(<span class="keyword">await</span> res.arrayBuffer());<span class="comment">//parse body as ArrayBuffer and convert into Uint8Array</span></span><br><span class="line"><span class="keyword">await</span> Deno.stdout.write(body);<span class="comment">//write body --&gt; stdout</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//run</span></span><br><span class="line"><span class="comment">//wrong cause no permision</span></span><br><span class="line">deno run https:<span class="comment">//deno.land/std/examples/curl.ts https://example.com</span></span><br><span class="line"><span class="comment">//right</span></span><br><span class="line">deno run --allow-net=example.com https:<span class="comment">//deno.land/std/examples/curl.ts https://example.com</span></span><br></pre></td></tr></table></figure><h3 id="2-3-3-reading-a-file"><a href="#2-3-3-reading-a-file" class="headerlink" title="2.3.3 reading a file"></a>2.3.3 reading a file</h3><p>denoæä¾›éæºè‡ªç½‘ç»œçš„apiï¼Œè¿™äº›å¯ä»¥åœ¨denoå…¨å±€è°ƒç”¨ï¼Œç”±äºç›®å‰æ²¡æœ‰webæ ‡å‡†ï¼Œæ‰€ä»¥denoå°±è‡ªå·±åšäº†ä¸€å¥—æ ‡å‡†ï¼Œä»¥ä¸‹ç¤ºä¾‹filenameâ€“&gt;openâ€“&gt;print</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> filenames = Deno.args;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> filename <span class="keyword">of</span> filenames) &#123;</span><br><span class="line">  <span class="keyword">const</span> file = <span class="keyword">await</span> Deno.open(filename);</span><br><span class="line">  <span class="keyword">await</span> Deno.copy(file, Deno.stdout);</span><br><span class="line">  file.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨äº†<strong>kernel-&gt;user-&gt;kernel</strong>çš„æ–¹å¼copyï¼Œä¿è¯æ•°æ®<strong>ä¸€è‡´æ€§</strong></p><p>é¿å…äº†å¸¸è§çš„4æ¬¡æ‹·è´</p><ol><li>ç£ç›˜â€”â€“DMAâ€”-&gt;é¡µç¼“å­˜ï¼ˆkernelï¼‰</li><li>é¡µç¼“å­˜(kernel)â€“&gt;ç”¨æˆ·ç¼“å­˜ï¼ˆuserï¼‰</li><li>ç”¨æˆ·ç¼“å­˜ï¼ˆuserï¼‰â€“&gt;socketç¼“å†²åŒºï¼ˆkernelï¼‰</li><li>Socket(kernel)â€”DMA copyâ€”&gt;network</li></ol><p>ç»è¿‡å¤šæ¬¡æ‹·è´ï¼Œç¼“å­˜æ•°æ®å¯èƒ½è¢«ä¿®æ”¹ï¼Œ<strong>å¯¼è‡´å’ŒåŸæ–‡ä»¶æ•°æ®ä¸ä¸€è‡´</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deno run --allow-read https://deno.land/std/examples/cat.ts /etc/passwd</span><br></pre></td></tr></table></figure><h3 id="2-3-4-tcp-server"><a href="#2-3-4-tcp-server" class="headerlink" title="2.3.4 tcp server"></a>2.3.4 tcp server</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hostname = <span class="string">"0.0.0.0"</span>;</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8080</span>;</span><br><span class="line"><span class="keyword">const</span> listener = Deno.listen(&#123; hostname, port &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Listening on <span class="subst">$&#123;hostname&#125;</span>:<span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">await</span> (<span class="keyword">const</span> conn <span class="keyword">of</span> listener) &#123;</span><br><span class="line">  Deno.copy(conn, conn);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœªç»å…è®¸ä¸å¯è®¿é—®ç½‘ç»œï¼Œå¦‚æœéœ€è¦ï¼Œåˆ™æ·»åŠ â€“allow-net</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deno run --allow-net https://deno.land/std/examples/echo_server.ts</span><br><span class="line">//shell netcat(nc)</span><br><span class="line">nc localhost 8080</span><br><span class="line">hello world//input</span><br></pre></td></tr></table></figure><h2 id="2-4-Permissions"><a href="#2-4-Permissions" class="headerlink" title="2.4 Permissions"></a>2.4 Permissions</h2><p>denoæ‹¥æœ‰ä¸¥æ ¼çš„æƒé™ç®¡ç†ï¼Œé™¤éä½ å£°æ˜ï¼Œå¦åˆ™denoä¸ä¼šæœ‰file network enviromentæƒé™ï¼Œèµ‹äºˆåªè¯»æƒé™å°±ä¸ä¼šæœ‰è¯»å†™æƒé™</p><h3 id="2-4-1-Permissions-list"><a href="#2-4-1-Permissions-list" class="headerlink" title="2.4.1 Permissions list"></a>2.4.1 Permissions list</h3><ul><li><strong>-A, â€“allow-all</strong> Allow all permissions. This disables all security.</li><li><strong>â€“allow-env</strong> Allow environment access for things like getting and setting of environment variables.</li><li><strong>â€“allow-hrtime</strong> Allow high resolution time measurement. High resolution time can be used in timing attacks and fingerprinting.</li><li><strong>â€“allow-net=\<allow-net></allow-net></strong> Allow network access. You can specify an optional, comma separated list of domains to provide a whitelist of allowed domains.</li><li><strong>â€“allow-plugin</strong> Allow loading plugins. Please note that â€“allow-plugin is an unstable feature.</li><li><strong>â€“allow-read=\<allow-read></allow-read></strong> Allow file system read access. You can specify an optional, comma separated list of directories or files to provide a whitelist of allowed file system access.</li><li><strong>â€“allow-run</strong> Allow running subprocesses. Be aware that subprocesses are not run in a sandbox and therefore do not have the same security restrictions as the deno process. Therefore, use with caution.</li><li><strong>â€“allow-write=\<allow-write></allow-write></strong> Allow file system write access. You can specify an optional, comma separated list of directories or files to provide a whitelist of allowed file system access.</li></ul><h3 id="2-4-2-Permission-whitelist"><a href="#2-4-2-Permission-whitelist" class="headerlink" title="2.4.2 Permission whitelist"></a>2.4.2 Permission whitelist</h3><p>é€šè¿‡ç™½åå•ï¼Œå®ç°æ›´é«˜ç²’åº¦çš„æƒé™æ§åˆ¶</p><p>ç¤ºä¾‹ç»™äºˆ/usræƒé™ï¼Œä½†è®¿é—®/etc</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> deno run --allow-read=/usr https://deno.land/std/examples/cat.ts /etc/passwd</span><br><span class="line">error: Uncaught PermissionDenied: read access to "/etc/passwd", run again with the --allow-read flag</span><br><span class="line">â–º $deno$/dispatch_json.ts:40:11</span><br><span class="line">    at DenoError ($deno$/errors.ts:20:5)</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">//yes    </span><br><span class="line"><span class="meta">$</span> deno run --allow-read=/etc https://deno.land/std/examples/cat.ts /etc/passwd</span><br></pre></td></tr></table></figure><h3 id="2-4-3-Network-access"><a href="#2-4-3-Network-access" class="headerlink" title="2.4.3 Network access"></a>2.4.3 Network access</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> fetch(<span class="string">"https://deno.land/"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//run</span></span><br><span class="line">$ deno run --allow-net=github.com,deno.land fetch.ts<span class="comment">//failed</span></span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>å¦‚æœfetch.tså°è¯•ä¸åˆ«çš„domainå»ºç«‹è¿æ¥ï¼Œprocesså°†ä¼šå¤±è´¥ï¼Œä½¿ç”¨<code>deno run --allow-net fetch.ts</code>åˆ™å¯ä»¥</p><h2 id="2-5-Using-TS"><a href="#2-5-Using-TS" class="headerlink" title="2.5 Using TS"></a>2.5 Using TS</h2><p>å¤©ç”Ÿæ”¯æŒJS,TSï¼Œéœ€è¦å¼•å…¥æ¨¡å—æ‹“å±•ï¼Œä½¿ç”¨æ–‡ä»¶ï¼Œæˆ–è€…urlè¿›è¡Œå¯¼å…¥</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Response &#125; <span class="keyword">from</span> <span class="string">"https://deno.land/std@0.53.0/http/server.ts"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; queue &#125; <span class="keyword">from</span> <span class="string">"./collections.ts"</span>;</span><br></pre></td></tr></table></figure><h3 id="2-5-1-Using-external-type-definitions"><a href="#2-5-1-Using-external-type-definitions" class="headerlink" title="2.5.1 Using external type definitions"></a>2.5.1 Using external type definitions</h3><p>å¼€ç®±å³ç”¨çš„TSç¼–è¯‘å™¨ï¼Œä¹Ÿä¾é æ— æ‰©å±•æ¨¡å—(extension-less modules)ï¼Œnodeæ¨¡å—è§£æé€»è¾‘(module resolution logic)æ¥å®ç°å°†ç±»å‹ï¼ˆtpyesï¼‰åº”ç”¨äºJSæ¨¡å—ï¼Œä¸ºäº†ç»™TSä¸JSå»ºç«‹æ¡¥æ¢ï¼Œæ”¯æŒä¸‰ç§å¼•ç”¨ç±»å‹å®šä¹‰æ–‡ä»¶çš„æ–¹å¼</p><ul><li><p>compiler hint</p></li><li><p>Triple-slash reference directive</p></li><li><h4 id="X-TypeScript-Types-custom-header"><a href="#X-TypeScript-Types-custom-header" class="headerlink" title="X-TypeScript-Types custom header"></a>X-TypeScript-Types custom header</h4></li></ul><p>Compiler hint ï¼šå½“ä½ çŸ¥é“æ–‡ä»¶ä½ç½®æ—¶å€™å¼•ç”¨,denoç¼–è¯‘å™¨ä¼šå¤¹åœ¨foo.d.tsè€Œä¸æ˜¯foo.js</p><p>å½“è¿è¡Œæ—¶ï¼ŒDenoä¼šä¸€ç›´åŠ è½½foo.js</p><p><a href="https://deno.land/manual/getting_started/typescript#compiler-hint" target="_blank" rel="noopener">ä¸å…¨å¾…è¡¥å……</a></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @deno-types="./foo.d.ts"</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> foo <span class="keyword">from</span> <span class="string">"./foo.js"</span>;</span><br></pre></td></tr></table></figure><p>ä¸æ˜¯æ‰€æœ‰å®šä¹‰éƒ½æ”¯æŒï¼šdenoä¼šåŠ è½½*.d.tsæ–‡ä»¶ï¼Œä½†ä¸æ˜¯æ‰€æœ‰æ–‡ä»¶éƒ½æ”¯æŒï¼Œå¦‚è®¿é—®:<code>./node_modules/@types/node/index.d.ts</code></p><p>ä¸ºä»€ä¹ˆTSæ–‡ä»¶ä¸­ä¸ä½¿ç”¨triple-slash type reference</p><p>å¦‚æœä½¿ç”¨ï¼Œå¹²æ‰°TSç¼–è¯‘å™¨çš„è¡Œä¸ºï¼ŒDenoå°½åœ¨JSå’ŒJSXæ–‡ä»¶ä¸­æŸ¥æ‰¾æŒ‡ä»¤</p><h3 id="2-5-2-Custom-TypeScript-Compiler-Options"><a href="#2-5-2-Custom-TypeScript-Compiler-Options" class="headerlink" title="2.5.2 Custom TypeScript Compiler Options"></a>2.5.2 Custom TypeScript Compiler Options</h3><p>Deno é»˜è®¤å¼€å§‹ä¸¥æ ¼æ¨¡å¼ï¼Œä½¿ç”¨<code>tsconfig.ts</code>æ¥é…ç½®ï¼Œéœ€è¦é€šè¿‡-cæ¥å‘Šè¯‰denoé…ç½®æ–‡ä»¶<code>deno run -c tsconfig.json mod.ts</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">//default optins</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"allowJs"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"allowUmdGlobalAccess"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"allowUnreachableCode"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"allowUnusedLabels"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"alwaysStrict"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"assumeChangesOnlyAffectDirectDependencies"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"checkJs"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"disableSizeLimit"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"generateCpuProfile"</span>: <span class="string">"profile.cpuprofile"</span>,</span><br><span class="line">    <span class="attr">"jsx"</span>: <span class="string">"react"</span>,</span><br><span class="line">    <span class="attr">"jsxFactory"</span>: <span class="string">"React.createElement"</span>,</span><br><span class="line">    <span class="attr">"lib"</span>: [],</span><br><span class="line">    <span class="attr">"noFallthroughCasesInSwitch"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"noImplicitAny"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"noImplicitReturns"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"noImplicitThis"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"noImplicitUseStrict"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"noStrictGenericChecks"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"noUnusedLocals"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"noUnusedParameters"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"preserveConstEnums"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"removeComments"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"resolveJsonModule"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"strict"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"strictBindCallApply"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"strictFunctionTypes"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"strictNullChecks"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"strictPropertyInitialization"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"suppressExcessPropertyErrors"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"suppressImplicitAnyIndexErrors"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"useDefineForClassFields"</span>: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-6-Using-WebAssembly"><a href="#2-6-Using-WebAssembly" class="headerlink" title="2.6 Using WebAssembly"></a>2.6 Using WebAssembly</h2><p>denoå¯ä»¥æ‰§è¡Œ<code>wasm</code>äºŒè¿›åˆ¶æ–‡ä»¶</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wasmCode = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>([</span><br><span class="line">  <span class="number">0</span>, <span class="number">97</span>, <span class="number">115</span>, <span class="number">109</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">133</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">96</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">127</span>,</span><br><span class="line">  <span class="number">3</span>, <span class="number">130</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">132</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">112</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">5</span>, <span class="number">131</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">129</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">145</span>,</span><br><span class="line">  <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">109</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">114</span>, <span class="number">121</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">109</span>, <span class="number">97</span>,</span><br><span class="line">  <span class="number">105</span>, <span class="number">110</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">138</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">132</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">65</span>, <span class="number">42</span>, <span class="number">11</span></span><br><span class="line">]);</span><br><span class="line"><span class="keyword">const</span> wasmModule = <span class="keyword">new</span> WebAssembly.Module(wasmCode);</span><br><span class="line"><span class="keyword">const</span> wasmInstance = <span class="keyword">new</span> WebAssembly.Instance(wasmModule);</span><br><span class="line"><span class="built_in">console</span>.log(wasmInstance.exports.main().toString());</span><br></pre></td></tr></table></figure><h1 id="3-The-Runtime"><a href="#3-The-Runtime" class="headerlink" title="3. The Runtime"></a>3. The Runtime</h1><p>Runtime functions(web Apis + deco global)</p><h2 id="3-1-Stability"><a href="#3-1-Stability" class="headerlink" title="3.1 Stability"></a>3.1 Stability</h2><p>è‡ª1.0.0ç‰ˆæœ¬åï¼Œå„APIè¶‹äºç¨³å®šï¼Œä½†å¹¶éæ‰€æœ‰çš„APIéƒ½å¯ä»¥æŠ•å…¥prodä½¿ç”¨ï¼Œä½¿ç”¨â€“unstableè§£é™¤é”å®š</p><h2 id="3-2-Program-lifecycle"><a href="#3-2-Program-lifecycle" class="headerlink" title="3.2 Program lifecycle"></a>3.2 Program lifecycle</h2><p>denoæ”¯æŒä¸æµè§ˆå™¨å…¼å®¹çš„ç”Ÿå‘½å‘¨æœŸeventsï¼Œ<code>load</code> and <code>unload</code></p><p>ä½ å¯ä»¥ä½¿ç”¨è¿™äº›eventsï¼Œåœ¨ä½ çš„ç¨‹åºä¸­æä¾› setup/cleanup code</p><p>load æ˜¯å¼‚æ­¥çš„ï¼Œç­‰å¾…çš„ï¼Œ<strong>ä¸å¯å–æ¶ˆçš„</strong></p><p>unloadæ˜¯åŒæ­¥çš„ï¼Œ<strong>ä¸å¯å–æ¶ˆçš„</strong></p><p><strong>main.ts</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"./imported.ts"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handler = (e: Event): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`got <span class="subst">$&#123;e.type&#125;</span> event in event handler (main)`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"load"</span>, handler);</span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"unload"</span>, handler);</span><br><span class="line"><span class="built_in">window</span>.onload = (e: Event): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`got <span class="subst">$&#123;e.type&#125;</span> event in onload function (main)`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">window</span>.onunload = (e: Event): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`got <span class="subst">$&#123;e.type&#125;</span> event in onunload function (main)`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"log from main script"</span>);</span><br></pre></td></tr></table></figure><p><strong>imported.ts</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handler = (e: Event): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`got <span class="subst">$&#123;e.type&#125;</span> event in event handler (imported)`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"load"</span>, handler);</span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"unload"</span>, handler);</span><br><span class="line"><span class="built_in">window</span>.onload = (e: Event): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`got <span class="subst">$&#123;e.type&#125;</span> event in onload function (imported)`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">window</span>.onunload = (e: Event): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`got <span class="subst">$&#123;e.type&#125;</span> event in onunload function (imported)`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"log from imported script"</span>);</span><br></pre></td></tr></table></figure><p>run</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> deno run main.ts</span><br><span class="line">log from imported script</span><br><span class="line">log from main script</span><br><span class="line">got load event in onload function (main)</span><br><span class="line">got load event in event handler (imported)</span><br><span class="line">got load event in event handler (main)</span><br><span class="line">got unload event in onunload function (main)</span><br><span class="line">got unload event in event handler (imported)</span><br><span class="line">got unload event in event handler (main)</span><br></pre></td></tr></table></figure><p>Importes.tsçš„æ–¹æ³•è¢«mainè¦†ç›–</p><h2 id="3-3-Compiler-APIs"><a href="#3-3-Compiler-APIs" class="headerlink" title="3.3 Compiler APIs"></a>3.3 Compiler APIs</h2><p>ç›®å‰ç¼–è¯‘å™¨çš„apisæ˜¯unstableçš„ï¼Œdenoæ”¯æŒå¯¹å†…ç½®tsç¼–è¯‘å™¨runtimeçš„è®¿é—®ï¼Œæœ‰ä¸‰ç§æ–¹æ³•è®¿é—®</p><ul><li>Deno.complie()</li><li>Deno.bundle()</li><li>Deno.transpileOnly()</li></ul><h3 id="3-3-1-Referencing-TypeScipt-library-files"><a href="#3-3-1-Referencing-TypeScipt-library-files" class="headerlink" title="3.3.1 Referencing TypeScipt library files"></a>3.3.1 Referencing TypeScipt library files</h3><h2 id="3-4-Workers"><a href="#3-4-Workers" class="headerlink" title="3.4 Workers"></a>3.4 Workers</h2><p>denoæ”¯æŒweb worker api</p><p>workerå¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸Šè¿è¡Œä»£ç ï¼Œæ¯ä¸ªworkerå®ä¾‹åœ¨å•ç‹¬ä¸“ç”¨çš„çº¿ç¨‹ä¸Šè¿è¡Œï¼Œç›®å‰ä»…æ”¯æŒ<code>module</code>ç±»å‹çš„worker</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Good</span></span><br><span class="line"><span class="keyword">new</span> Worker(<span class="string">"./worker.js"</span>, &#123; <span class="keyword">type</span>: <span class="string">"module"</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Bad</span></span><br><span class="line"><span class="keyword">new</span> Worker(<span class="string">"./worker.js"</span>);</span><br><span class="line"><span class="keyword">new</span> Worker(<span class="string">"./worker.js"</span>, &#123; <span class="keyword">type</span>: <span class="string">"classic"</span> &#125;);</span><br></pre></td></tr></table></figure><h3 id="3-4-1-Permissions"><a href="#3-4-1-Permissions" class="headerlink" title="3.4.1 Permissions"></a>3.4.1 Permissions</h3><p>åˆ›å»ºæ–°çš„workeræ˜¯åŠ¨æ€å¯¼å…¥ï¼Œéœ€è¦èµ‹äºˆæƒé™</p><p><strong>main.ts</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Worker(<span class="string">"./worker.ts"</span>, &#123; <span class="keyword">type</span>: <span class="string">"module"</span> &#125;);</span><br></pre></td></tr></table></figure><p><strong>worker.ts</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"hello world"</span>);</span><br><span class="line">self.close();</span><br><span class="line">---</span><br><span class="line">$ deno run main.ts</span><br><span class="line">error: Uncaught PermissionDenied: read access to <span class="string">"./worker.ts"</span>, run again <span class="keyword">with</span> the --allow-read flag</span><br><span class="line">$ deno run --allow-read main.ts</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure><p>For workers using remote modules; <code>--allow-net</code> permission is required:</p><h3 id="3-4-2-Using-Deno-in-worker"><a href="#3-4-2-Using-Deno-in-worker" class="headerlink" title="3.4.2 Using Deno in worker"></a>3.4.2 Using Deno in worker</h3><p><strong>main.js</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> worker = <span class="keyword">new</span> Worker(<span class="string">"./worker.js"</span>, &#123; <span class="keyword">type</span>: <span class="string">"module"</span>, deno: <span class="literal">true</span> &#125;);</span><br><span class="line">worker.postMessage(&#123; filename: <span class="string">"./log.txt"</span> &#125;);</span><br></pre></td></tr></table></figure><p><strong>worker.js</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">self.onmessage = <span class="keyword">async</span> (e) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; filename &#125; = e.data;</span><br><span class="line">  <span class="keyword">const</span> text = <span class="keyword">await</span> Deno.readTextFile(filename);</span><br><span class="line">  <span class="built_in">console</span>.log(text);</span><br><span class="line">  self.close();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>log.txt</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hello world</span><br><span class="line">$ deno run --allow-read --unstable main.js</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure><h1 id="4-Linking-to-external-code"><a href="#4-Linking-to-external-code" class="headerlink" title="4. Linking to external code"></a>4. Linking to external code</h1><h1 id="5-Standard-library"><a href="#5-Standard-library" class="headerlink" title="5. Standard library"></a>5. Standard library</h1><h1 id="6-Testing"><a href="#6-Testing" class="headerlink" title="6. Testing"></a>6. Testing</h1><h1 id="7-Tools"><a href="#7-Tools" class="headerlink" title="7. Tools"></a>7. Tools</h1><h1 id="8-Embedding-Deno"><a href="#8-Embedding-Deno" class="headerlink" title="8. Embedding Deno"></a>8. Embedding Deno</h1><h1 id="9-Contributing"><a href="#9-Contributing" class="headerlink" title="9. Contributing"></a>9. Contributing</h1><h1 id="10-Examples"><a href="#10-Examples" class="headerlink" title="10. Examples"></a>10. Examples</h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;0-Attention&quot;&gt;&lt;a href=&quot;#0-Attention&quot; class=&quot;headerlink&quot; title=&quot;0. Attention&quot;&gt;&lt;/a&gt;0. Attention&lt;/h1&gt;&lt;p&gt;æœ¬æ–‡ä¸ºä¸ªäººç¿»è¯‘ï¼Œå­¦ä¹ è¾“å‡ºï¼Œä»…ä¾›å‚è€ƒï¼Œæ¬¢è¿æŒ‡å‡ºç†è§£ä¸è¶³ä¹‹å¤„&lt;/p&gt;
      
    
    </summary>
    
      <category term="nodejs" scheme="http://zehai.info/categories/nodejs/"/>
    
    
      <category term="deno" scheme="http://zehai.info/tags/deno/"/>
    
  </entry>
  
  <entry>
    <title>monit</title>
    <link href="http://zehai.info/2020/05/13/2020-05-13-%E7%9B%91%E6%8E%A7%E8%BD%AF%E4%BB%B6/"/>
    <id>http://zehai.info/2020/05/13/2020-05-13-ç›‘æ§è½¯ä»¶/</id>
    <published>2020-05-13T08:18:55.000Z</published>
    <updated>2020-05-30T01:39:47.826Z</updated>
    
    <content type="html"><![CDATA[<p>ç›‘æ§</p><h1 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h1><p>prometheus vs zabbix</p><p>å…ˆå¯¹ä¸¤è€…çš„å„è‡ªç‰¹ç‚¹è¿›è¡Œä¸€ä¸‹å¯¹æ¯”ï¼š</p><table><thead><tr><th>Zabbix</th><th>Prometheus</th></tr></thead><tbody><tr><td>åç«¯ç”¨ C å¼€å‘ï¼Œç•Œé¢ç”¨ PHP å¼€å‘ï¼Œå®šåˆ¶åŒ–éš¾åº¦å¾ˆé«˜ã€‚</td><td>åç«¯ç”¨ golang å¼€å‘ï¼Œå‰ç«¯æ˜¯ Grafanaï¼ŒJSON ç¼–è¾‘å³å¯è§£å†³ã€‚å®šåˆ¶åŒ–éš¾åº¦è¾ƒä½ã€‚</td></tr><tr><td>é›†ç¾¤è§„æ¨¡ä¸Šé™ä¸º 10000 ä¸ªèŠ‚ç‚¹ã€‚</td><td>æ”¯æŒæ›´å¤§çš„é›†ç¾¤è§„æ¨¡ï¼Œé€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚</td></tr><tr><td>æ›´é€‚åˆç›‘æ§ç‰©ç†æœºç¯å¢ƒã€‚</td><td>æ›´é€‚åˆäº‘ç¯å¢ƒçš„ç›‘æ§ï¼Œå¯¹ OpenStackï¼Œ<strong>Kubernetes</strong> æœ‰æ›´å¥½çš„é›†æˆã€‚</td></tr><tr><td>ç›‘æ§æ•°æ®å­˜å‚¨åœ¨å…³ç³»å‹æ•°æ®åº“å†…ï¼Œå¦‚ MySQLï¼Œå¾ˆéš¾ä»ç°æœ‰æ•°æ®ä¸­æ‰©å±•ç»´åº¦ã€‚</td><td>ç›‘æ§æ•°æ®å­˜å‚¨åœ¨åŸºäº<strong>æ—¶é—´åºåˆ—(TSDB)</strong>çš„æ•°æ®åº“å†…ï¼Œä¾¿äºå¯¹å·²æœ‰æ•°æ®è¿›è¡Œæ–°çš„èšåˆã€‚</td></tr><tr><td>å®‰è£…ç®€å•ï¼Œzabbix-server ä¸€ä¸ªè½¯ä»¶åŒ…ä¸­åŒ…æ‹¬äº†æ‰€æœ‰çš„æœåŠ¡ç«¯åŠŸèƒ½ã€‚</td><td>å®‰è£…ç›¸å¯¹å¤æ‚ï¼Œ<strong>ç›‘æ§ã€å‘Šè­¦å’Œç•Œé¢</strong>éƒ½åˆ†å±äºä¸åŒçš„ç»„ä»¶ã€‚</td></tr><tr><td><strong>å›¾å½¢åŒ–ç•Œé¢</strong>æ¯”è¾ƒæˆç†Ÿï¼Œç•Œé¢ä¸ŠåŸºæœ¬ä¸Šèƒ½å®Œæˆå…¨éƒ¨çš„é…ç½®æ“ä½œã€‚</td><td>ç•Œé¢ç›¸å¯¹è¾ƒå¼±ï¼Œå¾ˆå¤šé…ç½®éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚</td></tr><tr><td>å‘å±•æ—¶é—´æ›´é•¿ï¼Œå¯¹äºå¾ˆå¤šç›‘æ§åœºæ™¯ï¼Œéƒ½æœ‰ç°æˆçš„è§£å†³æ–¹æ¡ˆã€‚</td><td>2015 å¹´åå¼€å§‹å¿«é€Ÿå‘å±•ï¼Œä½†å‘å±•æ—¶é—´è¾ƒçŸ­ï¼Œæˆç†Ÿåº¦ä¸åŠ Zabbixã€‚</td></tr></tbody></table><p>ç”±äºæœ€åæ•²å®šäº†Prometheusæ–¹æ¡ˆï¼Œå¯¹äºzabbixå°±äº‘è¯„æµ‹äº†ï¼Œæ¬¢è¿æŒ‡æ­£</p><ul><li>è™½ç„¶å›¾å½¢åŒ–ç•Œé¢å¼±åŒ–ï¼Œå¾ˆå¤šé…ç½®èµ°ymlæ–‡ä»¶ï¼Œä½†å›¾å½¢åŒ–ç•Œé¢çœŸçš„æ²¡æœ‰å¿…è¦</li><li>æ—¶åºæ•°æ®åº“ï¼Œé«˜å¹¶å‘ä¸‹å¥½äºmysqlï¼ˆä¸ç„¶å¹²å˜›å¼€å‘tsdbåº”å¯¹ç›‘æ§åœºæ™¯ï¼‰</li><li>promæ”¯æŒpullå’Œpushæ¨¡å‹ï¼Œå¯ä»¥æ”¯æŒk8sï¼Œswarmç­‰æœåŠ¡å‘ç°</li></ul><h1 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h1><p>Performanceï¼ŸwebVitalsï¼Ÿä»¥åç”¨åˆ°å†è¡¥å……</p><p>ä¸»è¦å…³æ³¨æ€§èƒ½ï¼Œpvï¼Œredirectï¼Œerrç­‰é—®é¢˜</p><h1 id="é¡µé¢æ˜¯å¦å¯ç”¨"><a href="#é¡µé¢æ˜¯å¦å¯ç”¨" class="headerlink" title="é¡µé¢æ˜¯å¦å¯ç”¨"></a>é¡µé¢æ˜¯å¦å¯ç”¨</h1><p>é˜¿é‡Œäº‘-äº‘ç›‘æ§æ§åˆ¶å°</p><p>å¯æä¾›ç½‘å€ç›‘æ§ï¼ŒåŒ…æ‹¬cookie, headers ç­‰è‡ªå®šä¹‰çš„ç®€å•é…ç½®ï¼Œè¿›è¡Œç”µè¯ï¼Œé‚®ä»¶ï¼ŒçŸ­ä¿¡ï¼Œæ—ºæ—ºç­‰æŠ¥è­¦</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç›‘æ§&lt;/p&gt;
&lt;h1 id=&quot;åç«¯&quot;&gt;&lt;a href=&quot;#åç«¯&quot; class=&quot;headerlink&quot; title=&quot;åç«¯&quot;&gt;&lt;/a&gt;åç«¯&lt;/h1&gt;&lt;p&gt;prometheus vs zabbix&lt;/p&gt;
&lt;p&gt;å…ˆå¯¹ä¸¤è€…çš„å„è‡ªç‰¹ç‚¹è¿›è¡Œä¸€ä¸‹å¯¹æ¯”ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;th
      
    
    </summary>
    
      <category term="monit" scheme="http://zehai.info/categories/monit/"/>
    
    
      <category term="intro" scheme="http://zehai.info/tags/intro/"/>
    
  </entry>
  
  <entry>
    <title>pandle</title>
    <link href="http://zehai.info/2020/05/12/2020-05-12-paddle/"/>
    <id>http://zehai.info/2020/05/12/2020-05-12-paddle/</id>
    <published>2020-05-12T08:18:55.000Z</published>
    <updated>2020-05-30T01:40:04.969Z</updated>
    
    <content type="html"><![CDATA[<h1 id="start"><a href="#start" class="headerlink" title="start"></a>start</h1><p>use docker</p><h1 id="platform"><a href="#platform" class="headerlink" title="platform"></a>platform</h1><ul><li><strong>AI Studio</strong>ï¼š<a href="https://aistudio.baidu.com/" target="_blank" rel="noopener">https://aistudio.baidu.com/</a></li><li><strong>é£æ¡¨å®˜ç½‘</strong>ï¼š<a href="https://www.paddlepaddle.org.cn/" target="_blank" rel="noopener">https://www.paddlepaddle.org.cn/</a></li><li><strong>ç™¾åº¦æŠ€æœ¯å­¦é™¢</strong>ï¼š<a href="http://bit.baidu.com/index" target="_blank" rel="noopener">http://bit.baidu.com/index</a></li></ul><h1 id="about"><a href="#about" class="headerlink" title="about"></a>about</h1><p>äººå·¥æ™ºèƒ½&gt;æœºå™¨å­¦ä¹ &gt;æ·±åº¦å­¦ä¹ </p><ul><li><p>äººå·¥æ™ºèƒ½æ˜¯ç ”å‘ç”¨äºæ¨¡æ‹Ÿã€å»¶ä¼¸å’Œæ‰©å±•äººçš„æ™ºèƒ½çš„ç†è®ºã€æ–¹æ³•ã€æŠ€æœ¯åŠåº”ç”¨ç³»ç»Ÿçš„ä¸€é—¨æ–°çš„æŠ€æœ¯ç§‘å­¦ã€‚ç”±äºè¿™ä¸ªå®šä¹‰åªé˜è¿°äº†ç›®æ ‡ï¼Œè€Œæ²¡æœ‰é™å®šæ–¹æ³•ï¼Œå› æ­¤å®ç°äººå·¥æ™ºèƒ½å­˜åœ¨çš„è¯¸å¤šæ–¹æ³•å’Œåˆ†æ”¯ï¼Œå¯¼è‡´å…¶å˜æˆä¸€ä¸ªâ€œå¤§æ‚çƒ©â€å¼çš„å­¦ç§‘ã€‚</p></li><li><p>æœºå™¨å­¦ä¹ ã€å°¤å…¶æ˜¯ç›‘ç£å­¦ä¹ åˆ™æœ‰æ›´åŠ æ˜ç¡®çš„æŒ‡ä»£ã€‚æœºå™¨å­¦ä¹ æ˜¯ä¸“é—¨ç ”ç©¶è®¡ç®—æœºæ€æ ·æ¨¡æ‹Ÿæˆ–å®ç°äººç±»çš„å­¦ä¹ è¡Œä¸ºï¼Œä»¥è·å–æ–°çš„çŸ¥è¯†æˆ–æŠ€èƒ½ï¼Œé‡æ–°ç»„ç»‡å·²æœ‰çš„çŸ¥è¯†ç»“æ„ï¼Œä½¿ä¹‹ä¸æ–­æ”¹å–„è‡ªèº«çš„æ€§èƒ½</p></li><li><p>å¤šæ•°æœºå™¨å­¦ä¹ ä»»åŠ¡éƒ½å¯ä»¥ä½¿ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹è§£å†³ï¼Œå°¤å…¶åœ¨åœ¨è¯­éŸ³ã€è®¡ç®—æœºè§†è§‰å’Œè‡ªç„¶è¯­è¨€å¤„ç†ç­‰é¢†åŸŸï¼Œæ·±åº¦å­¦ä¹ æ¨¡å‹çš„æ•ˆæœæ¯”ä¼ ç»Ÿæœºå™¨å­¦ä¹ ç®—æ³•æœ‰æ˜¾è‘—æå‡ã€‚</p><p>é‚£ä¹ˆç›¸æ¯”ä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œæ·±åº¦å­¦ä¹ åšå‡ºäº†æ”¹è¿›ï¼Œ<strong>ä¸¤è€…åœ¨ç†è®ºç»“æ„ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œå³ï¼šæ¨¡å‹å‡è®¾ã€è¯„ä»·å‡½æ•°å’Œä¼˜åŒ–ç®—æ³•ï¼Œå…¶æ ¹æœ¬å·®åˆ«åœ¨äºå‡è®¾çš„å¤æ‚åº¦</strong></p></li></ul><p>äººå·¥ç¥ç»ç½‘ç»œåŒ…æ‹¬å¤šä¸ªç¥ç»ç½‘ç»œå±‚ï¼Œå¦‚å·ç§¯å±‚ã€å…¨è¿æ¥å±‚ã€LSTMç­‰ï¼Œæ¯ä¸€å±‚åˆåŒ…æ‹¬å¾ˆå¤šç¥ç»å…ƒï¼Œè¶…è¿‡ä¸‰å±‚çš„éçº¿æ€§ç¥ç»ç½‘ç»œéƒ½å¯ä»¥è¢«ç§°ä¸ºæ·±åº¦ç¥ç»ç½‘ç»œã€‚é€šä¿—çš„è®²ï¼Œæ·±åº¦å­¦ä¹ çš„æ¨¡å‹å¯ä»¥è§†ä¸ºæ˜¯è¾“å…¥åˆ°è¾“å‡ºçš„æ˜ å°„å‡½æ•°ï¼Œå¦‚å›¾åƒåˆ°é«˜çº§è¯­ä¹‰ï¼ˆç¾å¥³ï¼‰çš„æ˜ å°„ï¼Œè¶³å¤Ÿæ·±çš„ç¥ç»ç½‘ç»œç†è®ºä¸Šå¯ä»¥æ‹Ÿåˆä»»ä½•å¤æ‚çš„å‡½æ•°ã€‚å› æ­¤ç¥ç»ç½‘ç»œéå¸¸é€‚åˆå­¦ä¹ æ ·æœ¬æ•°æ®çš„å†…åœ¨è§„å¾‹å’Œè¡¨ç¤ºå±‚æ¬¡ï¼Œå¯¹æ–‡å­—ã€å›¾åƒå’Œè¯­éŸ³ä»»åŠ¡æœ‰å¾ˆå¥½çš„é€‚ç”¨æ€§ã€‚å› ä¸ºè¿™å‡ ä¸ªé¢†åŸŸçš„ä»»åŠ¡æ˜¯äººå·¥æ™ºèƒ½çš„åŸºç¡€æ¨¡å—ï¼Œæ‰€ä»¥æ·±åº¦å­¦ä¹ è¢«ç§°ä¸ºå®ç°äººå·¥æ™ºèƒ½çš„åŸºç¡€ä¹Ÿå°±ä¸è¶³ä¸ºå¥‡äº†ã€‚</p><ul><li>ç¥ç»å…ƒï¼šç¥ç»ç½‘ç»œä¸­æ¯ä¸ªèŠ‚ç‚¹ç§°ä¸ºç¥ç»å…ƒï¼Œç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š<ul><li>åŠ æƒå’Œï¼šå°†æ‰€æœ‰è¾“å…¥åŠ æƒæ±‚å’Œã€‚</li><li>éçº¿æ€§å˜æ¢ï¼ˆæ¿€æ´»å‡½æ•°ï¼‰ï¼šåŠ æƒå’Œçš„ç»“æœç»è¿‡ä¸€ä¸ªéçº¿æ€§å‡½æ•°å˜æ¢ï¼Œè®©ç¥ç»å…ƒè®¡ç®—å…·å¤‡éçº¿æ€§çš„èƒ½åŠ›ã€‚</li></ul></li><li><strong>å¤šå±‚è¿æ¥ï¼š</strong> å¤§é‡è¿™æ ·çš„èŠ‚ç‚¹æŒ‰ç…§ä¸åŒçš„å±‚æ¬¡æ’å¸ƒï¼Œå½¢æˆå¤šå±‚çš„ç»“æ„è¿æ¥èµ·æ¥ï¼Œå³ç§°ä¸ºç¥ç»ç½‘ç»œã€‚</li><li><strong>å‰å‘è®¡ç®—ï¼š</strong> ä»è¾“å…¥è®¡ç®—è¾“å‡ºçš„è¿‡ç¨‹ï¼Œé¡ºåºä»ç½‘ç»œå‰è‡³åã€‚</li><li><strong>è®¡ç®—å›¾ï¼š</strong> ä»¥å›¾å½¢åŒ–çš„æ–¹å¼å±•ç°ç¥ç»ç½‘ç»œçš„è®¡ç®—é€»è¾‘åˆæˆä¸ºè®¡ç®—å›¾ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ç¥ç»ç½‘ç»œçš„è®¡ç®—å›¾ä»¥å…¬å¼çš„æ–¹å¼è¡¨è¾¾å¦‚ä¸‹ï¼š</li></ul><p>ç”±æ­¤å¯è§ï¼Œç¥ç»ç½‘ç»œå¹¶æ²¡æœ‰é‚£ä¹ˆç¥ç§˜ï¼Œå®ƒçš„æœ¬è´¨æ˜¯ä¸€ä¸ªå«æœ‰å¾ˆå¤šå‚æ•°çš„â€œå¤§å…¬å¼â€ã€‚</p><p>æ·±åº¦å­¦ä¹ æ¡†æ¶æ ‡å‡†åŒ–ï¼Œè‡ªåŠ¨åŒ–ï¼Œæ¨¡å—åŒ–</p><p>æ•°æ®å¤„ç†-&gt;æ¨¡å‹è®¾è®¡-&gt;è®­ç»ƒé…ç½®-&gt;è®­ç»ƒè¿‡ç¨‹-&gt;æ¨¡å‹ä¿å­˜</p><ul><li>æ•°æ®å¤„ç†ï¼šæ•°æ®å¯¼å…¥â€“&gt;æ•°æ®å½¢çŠ¶å˜æ¢â€“&gt;æ•°æ®é›†åˆ’åˆ†â€“&gt;æ•°æ®å½’ä¸€åŒ–å¤„ç†â€“&gt;å°è£…load dataæ•°æ®â€“&gt;æ•°æ®é¢„å¤„ç†â€“&gt;æ¨¡å‹è°ƒç”¨</li></ul><h1 id="æ„å»ºç¥ç»ç½‘ç»œæ¨¡å‹"><a href="#æ„å»ºç¥ç»ç½‘ç»œæ¨¡å‹" class="headerlink" title="æ„å»ºç¥ç»ç½‘ç»œæ¨¡å‹"></a>æ„å»ºç¥ç»ç½‘ç»œæ¨¡å‹</h1><p>ç¥ç»ç½‘ç»œçš„åŸºæœ¬æ¦‚å¿µï¼ˆå¦‚ç¥ç»å…ƒã€å¤šå±‚è¿æ¥ã€å‰å‘è®¡ç®—ã€è®¡ç®—å›¾ï¼‰å’Œæ¨¡å‹ç»“æ„ä¸‰è¦ç´ ï¼ˆæ¨¡å‹å‡è®¾ã€è¯„ä»·å‡½æ•°å’Œä¼˜åŒ–ç®—æ³•ï¼‰</p><p>è¿ç»­â€“&gt;å›å½’ä»»åŠ¡</p><p>ç¦»æ•£â€“&gt;åˆ†ç±»ä»»åŠ¡</p><p>æ•°æ®å¤„ç†ï¼ˆæ•°æ®å¯¼å…¥ã€æ•°æ®å½¢çŠ¶å˜æ¢ã€æ•°æ®é›†åˆ’åˆ†ã€æ•°æ®å½’ä¸€åŒ–å¤„ç†ï¼Œå°è£…load dataå‡½æ•°ï¼‰-&gt;æ¨¡å‹è®¾è®¡-&gt;è®­ç»ƒé…ç½®-&gt;è®­ç»ƒè¿‡ç¨‹-&gt;æ¨¡å‹ä¿å­˜</p><h2 id="æ•°æ®å¤„ç†"><a href="#æ•°æ®å¤„ç†" class="headerlink" title="æ•°æ®å¤„ç†"></a>æ•°æ®å¤„ç†</h2><p>1.æ•°æ®å¯¼å…¥</p><p>2.æ•°æ®å½¢çŠ¶å˜æ¢ï¼ˆ1ç»´æ•°æ®æ”¹æˆå¯ç”¨å½¢å¼ï¼‰</p><p>3.æ•°æ®é›†åˆ’åˆ†ï¼Œåˆ’åˆ†è®­ç»ƒé›†ï¼Œæµ‹è¯•é›†</p><p>4.æ•°æ®å½’ä¸€åŒ–ï¼ˆç‰¹å¾å€¼0ï½1ï¼‰</p><p>5.å°è£…load dataå‡½æ•°</p><h2 id="æ¨¡å‹è®¾è®¡"><a href="#æ¨¡å‹è®¾è®¡" class="headerlink" title="æ¨¡å‹è®¾è®¡"></a>æ¨¡å‹è®¾è®¡</h2><p>æ¨¡å‹è®¾è®¡æ˜¯æ·±åº¦å­¦ä¹ æ¨¡å‹å…³é”®è¦ç´ ä¹‹ä¸€ï¼Œä¹Ÿç§°ä¸ºç½‘ç»œç»“æ„è®¾è®¡ï¼Œç›¸å½“äºæ¨¡å‹çš„å‡è®¾ç©ºé—´ï¼Œå³å®ç°æ¨¡å‹â€œå‰å‘è®¡ç®—â€ï¼ˆä»è¾“å…¥åˆ°è¾“å‡ºï¼‰çš„è¿‡ç¨‹ã€‚</p><h2 id="æç£ä¸‹é™ç®—æ³•"><a href="#æç£ä¸‹é™ç®—æ³•" class="headerlink" title="æç£ä¸‹é™ç®—æ³•"></a>æç£ä¸‹é™ç®—æ³•</h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;start&quot;&gt;&lt;a href=&quot;#start&quot; class=&quot;headerlink&quot; title=&quot;start&quot;&gt;&lt;/a&gt;start&lt;/h1&gt;&lt;p&gt;use docker&lt;/p&gt;
&lt;h1 id=&quot;platform&quot;&gt;&lt;a href=&quot;#platform&quot; class
      
    
    </summary>
    
      <category term="pandle" scheme="http://zehai.info/categories/pandle/"/>
    
    
      <category term="intro" scheme="http://zehai.info/tags/intro/"/>
    
  </entry>
  
  <entry>
    <title>prom-client</title>
    <link href="http://zehai.info/2020/04/30/2020-04-30-prom-client/"/>
    <id>http://zehai.info/2020/04/30/2020-04-30-prom-client/</id>
    <published>2020-04-30T08:18:55.000Z</published>
    <updated>2020-05-30T01:40:04.969Z</updated>
    
    <content type="html"><![CDATA[<p>prom-clinet</p><p>prometheusçš„clientï¼Œæ”¯æŒhistogram summaries gauges counters</p><h1 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h1><ul><li>clusteræ¨¡å¼,é¿å…å„ä¸ªworkeréƒ½æœ‰ä¸€ä¸ªmetric</li><li>éclusteræ¨¡å¼ï¼Œå…¨å±€æŒ‚è½½</li></ul><h1 id="api"><a href="#api" class="headerlink" title="api"></a>api</h1><h2 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h2><p>æ‰€æœ‰metricéƒ½æœ‰ä¸¤ä¸ªå¼ºåˆ¶å±æ€§</p><ul><li>name</li><li>helpï¼ˆæè¿°ï¼‰</li></ul><h2 id="DefaultMetrics"><a href="#DefaultMetrics" class="headerlink" title="DefaultMetrics"></a>DefaultMetrics</h2><p>collectDefaultMetrics({options})</p><p>Options ï¼ˆObjectï¼‰å…·å¤‡ä»¥ä¸‹å››ä¸ªå‚æ•°</p><ul><li>prefixï¼šmetricæ·»åŠ å‰ç¼€ ï¼Œé»˜è®¤æ²¡æœ‰å‰ç¼€ï¼ˆjob instanceåæ›´åŠ ç»†åˆ†ï¼‰</li><li>registry:æŒ‡å‘å“ªä¸ªregisterï¼Œé»˜è®¤å…¨å±€</li><li>gcDurationBuckets è‡ªå®šä¹‰bucketsçš„gcæŒç»­æ—¶é—´ç›´æ–¹å›¾ï¼Œé»˜è®¤[0.001, 0.01, 0.1, 1, 2, 5]` (in seconds).</li><li>eventLoopMonitoringPrecision é‡‡æ ·ç‡ä»¥æ¯«ç§’ä¸ºå•ä½ï¼ˆ&gt;0ï¼‰ï¼Œé»˜è®¤10</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> client = <span class="built_in">require</span>(<span class="string">'prom-client'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> collectDefaultMetrics = client.collectDefaultMetrics;</span><br><span class="line"><span class="keyword">const</span> Registry = client.Registry;</span><br><span class="line"><span class="keyword">const</span> register = <span class="keyword">new</span> Registry();</span><br><span class="line"><span class="keyword">const</span> prefix = <span class="string">'my_application_'</span>;</span><br><span class="line"></span><br><span class="line">collectDefaultMetrics(&#123; register,prefix,<span class="attr">gcDurationBuckets</span>: [<span class="number">0.1</span>, <span class="number">0.2</span>, <span class="number">0.3</span>] &#125;);</span><br></pre></td></tr></table></figure><h2 id="counter"><a href="#counter" class="headerlink" title="counter"></a>counter</h2><p>å½“è¿›ç¨‹é‡å¯æ—¶ï¼Œcounterä¼šæ¸…ç©ºï¼Œä½¿ç”¨å‡½æ•°è§£å†³</p><p>ä½œè€…æ³¨ï¼š</p><ul><li>å¯ä»¥ç›‘æ§æŒ‰é’®ç‚¹å‡»æ¬¡æ•°ï¼Œè¯·æ±‚æ¬¡æ•°æ¥ç›‘æ§ä¸šåŠ¡æ•°æ®</li><li>åŒæ—¶ä¹Ÿ<strong>æ”¯æŒlabelNames</strong>ï¼Œå‚è€ƒHistogram</li><li>ä»0å¼€å§‹å¢ï¼Œ<strong>ä¸å¯å‡</strong>ï¼Œï¼ˆå‡-&gt;gaugeï¼‰</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> client = <span class="built_in">require</span>(<span class="string">'prom-client'</span>);</span><br><span class="line"><span class="keyword">const</span> counter = <span class="keyword">new</span> client.Counter(&#123;</span><br><span class="line">  name: <span class="string">'metric_name'</span>,</span><br><span class="line">  help: <span class="string">'metric_help'</span>,</span><br><span class="line">&#125;);</span><br><span class="line">counter.inc(); <span class="comment">// Inc with 1</span></span><br><span class="line">counter.inc(<span class="number">10</span>); <span class="comment">// Inc with 10</span></span><br></pre></td></tr></table></figure><h2 id="gauge"><a href="#gauge" class="headerlink" title="gauge"></a>gauge</h2><p>counteråŠŸèƒ½åŸºç¡€ä¸Šæ”¯æŒå‡æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//base</span></span><br><span class="line"><span class="keyword">const</span> client = <span class="built_in">require</span>(<span class="string">'prom-client'</span>);</span><br><span class="line"><span class="keyword">const</span> gauge = <span class="keyword">new</span> client.Gauge(&#123; <span class="attr">name</span>: <span class="string">'metric_name'</span>, <span class="attr">help</span>: <span class="string">'metric_help'</span> &#125;);</span><br><span class="line">gauge.set(<span class="number">10</span>); <span class="comment">// Set to 10</span></span><br><span class="line">gauge.inc(); <span class="comment">// Inc with 1</span></span><br><span class="line">gauge.inc(<span class="number">10</span>); <span class="comment">// Inc with 10</span></span><br><span class="line">gauge.dec(); <span class="comment">// Dec with 1</span></span><br><span class="line">gauge.dec(<span class="number">10</span>); <span class="comment">// Dec with 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//others</span></span><br><span class="line">gauge.setToCurrentTime(); <span class="comment">// Sets value to current time</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> end = gauge.startTimer();</span><br><span class="line">xhrRequest(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">  end(); <span class="comment">// Sets value to xhrRequests duration in seconds</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="histogram"><a href="#histogram" class="headerlink" title="histogram"></a>histogram</h2><p>è¿½è¸ªäº‹ä»¶çš„å¤§å°å’Œé¢‘ç‡</p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>é»˜è®¤çš„bucketsæ—¨åœ¨è¦†ç›–å¸¸è§„çš„web/rpcè¯·æ±‚ï¼Œä¹Ÿå¯ä»¥è¢«override</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> client = <span class="built_in">require</span>(<span class="string">'prom-client'</span>);</span><br><span class="line"><span class="keyword">new</span> client.Histogram(&#123;</span><br><span class="line">  name: <span class="string">'metric_name'</span>,</span><br><span class="line">  help: <span class="string">'metric_help'</span>,</span><br><span class="line">  labelNames: [<span class="string">'status_code'</span>],<span class="comment">//**Array**</span></span><br><span class="line">  buckets: [<span class="number">0.1</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">500</span>],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> client = <span class="built_in">require</span>(<span class="string">'prom-client'</span>);</span><br><span class="line"><span class="keyword">const</span> histogram = <span class="keyword">new</span> client.Histogram(&#123;</span><br><span class="line">  name: <span class="string">'metric_name'</span>,</span><br><span class="line">  help: <span class="string">'metric_help'</span>,</span><br><span class="line">&#125;);</span><br><span class="line">histogram.observe(<span class="number">10</span>); <span class="comment">// Observe value in histogram</span></span><br></pre></td></tr></table></figure><h3 id="Utility-to-observe-request-durations"><a href="#Utility-to-observe-request-durations" class="headerlink" title="Utility to observe request durations"></a>Utility to observe request durations</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> end = histogram.startTimer();</span><br><span class="line">xhrRequest(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> seconds = end(); <span class="comment">// Observes and returns the value to xhrRequests duration in seconds</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>è®¡ç®—è§‚å¯Ÿå€¼çš„ç™¾åˆ†æ¯”æ•°æ®</p><h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><p>é»˜è®¤ç™¾åˆ†æ¯”[0.01, 0.05, 0.5, 0.9, 0.95, 0.99, 0.999]ï¼Œä½†å¯ä»¥è¢«è¦†ç›–</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> client = <span class="built_in">require</span>(<span class="string">'prom-client'</span>);</span><br><span class="line"><span class="keyword">new</span> client.Summary(&#123;</span><br><span class="line">  name: <span class="string">'metric_name'</span>,</span><br><span class="line">  help: <span class="string">'metric_help'</span>,</span><br><span class="line">  percentiles: [<span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">0.9</span>, <span class="number">0.99</span>],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¦‚æœå¯ç”¨æ»‘åŠ¨çª—å£åŠŸèƒ½ï¼Œéœ€è¦æ–°å¢<code>maxAgeSeconds</code> and <code>ageBuckets</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> client = <span class="built_in">require</span>(<span class="string">'prom-client'</span>);</span><br><span class="line"><span class="keyword">new</span> client.Summary(&#123;</span><br><span class="line">  name: <span class="string">'metric_name'</span>,</span><br><span class="line">  help: <span class="string">'metric_help'</span>,</span><br><span class="line">  maxAgeSeconds: <span class="number">600</span>,</span><br><span class="line">  ageBuckets: <span class="number">5</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>maxAgeSeconds å¯ä»¥çŸ¥é“bucketé‡åˆ¶å‰çš„ä½¿ç”¨æ—¶å¸¸</p><p>ageBuckets æ»‘åŠ¨çª—å£ä¸­æœ€å¤šçš„bucketsæ•°ç›®</p><h3 id="Usage-example"><a href="#Usage-example" class="headerlink" title="Usage example"></a>Usage example</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> client = <span class="built_in">require</span>(<span class="string">'prom-client'</span>);</span><br><span class="line"><span class="keyword">const</span> summary = <span class="keyword">new</span> client.Summary(&#123;</span><br><span class="line">  name: <span class="string">'metric_name'</span>,</span><br><span class="line">  help: <span class="string">'metric_help'</span>,</span><br><span class="line">&#125;);</span><br><span class="line">summary.observe(<span class="number">10</span>);</span><br></pre></td></tr></table></figure><h3 id="Utility-to-observe-request-durations-1"><a href="#Utility-to-observe-request-durations-1" class="headerlink" title="Utility to observe request durations"></a>Utility to observe request durations</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> end = summary.startTimer();</span><br><span class="line">xhrRequest(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">  end(); <span class="comment">// Observes the value to xhrRequests duration in seconds</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="labels"><a href="#labels" class="headerlink" title="labels"></a>labels</h2><p>æ‰€æœ‰metricså¯ä»¥è®¾ç½®labelNameså±æ€§ï¼Œä¸¤ç§èµ‹å€¼æ–¹å¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> client = <span class="built_in">require</span>(<span class="string">'prom-client'</span>);</span><br><span class="line"><span class="keyword">const</span> gauge = <span class="keyword">new</span> client.Gauge(&#123;</span><br><span class="line">  name: <span class="string">'metric_name'</span>,</span><br><span class="line">  help: <span class="string">'metric_help'</span>,</span><br><span class="line">  labelNames: [<span class="string">'method'</span>, <span class="string">'statusCode'</span>],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">gauge.set(&#123; <span class="attr">method</span>: <span class="string">'GET'</span>, <span class="attr">statusCode</span>: <span class="string">'200'</span> &#125;, <span class="number">100</span>); <span class="comment">// 1st version, Set value 100 with method set to GET and statusCode to 200</span></span><br><span class="line">gauge.labels(<span class="string">'GET'</span>, <span class="string">'200'</span>).set(<span class="number">100</span>); <span class="comment">// 2nd version, Same as above</span></span><br></pre></td></tr></table></figure><p>ç”¨æ¥è®°å½•è¯·æ±‚ç»“æœ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> end = startTimer(&#123; <span class="attr">method</span>: <span class="string">'GET'</span> &#125;); <span class="comment">// Set method to GET, we don't know statusCode yet</span></span><br><span class="line">xhrRequest(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    end(&#123; <span class="attr">statusCode</span>: <span class="string">'500'</span> &#125;); <span class="comment">// Sets value to xhrRequest duration in seconds with statusCode 500</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    end(&#123; <span class="attr">statusCode</span>: <span class="string">'200'</span> &#125;); <span class="comment">// Sets value to xhrRequest duration in seconds with statusCode 200</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="default-labels"><a href="#default-labels" class="headerlink" title="default labels"></a>default labels</h3><h1 id="gc"><a href="#gc" class="headerlink" title="gc"></a>gc</h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;prom-clinet&lt;/p&gt;
&lt;p&gt;prometheusçš„clientï¼Œæ”¯æŒhistogram summaries gauges counters&lt;/p&gt;
&lt;h1 id=&quot;usage&quot;&gt;&lt;a href=&quot;#usage&quot; class=&quot;headerlink&quot; title=&quot;
      
    
    </summary>
    
      <category term="prometheus" scheme="http://zehai.info/categories/prometheus/"/>
    
    
      <category term="client" scheme="http://zehai.info/tags/client/"/>
    
  </entry>
  
  <entry>
    <title>prometheus</title>
    <link href="http://zehai.info/2020/04/30/2020-04-30-prometheus/"/>
    <id>http://zehai.info/2020/04/30/2020-04-30-prometheus/</id>
    <published>2020-04-30T08:18:55.000Z</published>
    <updated>2020-05-30T01:40:04.969Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h1><h1 id="2-Concepts"><a href="#2-Concepts" class="headerlink" title="2.Concepts"></a>2.Concepts</h1><h1 id="3-Prometheus"><a href="#3-Prometheus" class="headerlink" title="3. Prometheus"></a>3. Prometheus</h1><h1 id="4-Visualization"><a href="#4-Visualization" class="headerlink" title="4.Visualization"></a>4.Visualization</h1><h1 id="5-Operating"><a href="#5-Operating" class="headerlink" title="5.Operating"></a>5.Operating</h1><h2 id="5-1security"><a href="#5-1security" class="headerlink" title="5.1security"></a>5.1security</h2><p>promethueså…·å¤‡å¾ˆå¤šç»„ä»¶ï¼Œä»¥åŠä¸å…¶ä»–ç³»ç»Ÿé›†æˆï¼Œæœ¬èº«<strong>å¯ä»¥</strong>éƒ¨ç½²åœ¨å—ä¿¡ä»»å’Œä¸å—ä¿¡ä»»çš„ç¯å¢ƒ</p><h3 id="5-1-1-Promethues"><a href="#5-1-1-Promethues" class="headerlink" title="5.1.1 Promethues"></a>5.1.1 Promethues</h3><h3 id="5-1-2-AlertManager"><a href="#5-1-2-AlertManager" class="headerlink" title="5.1.2 AlertManager"></a>5.1.2 AlertManager</h3><h3 id="5-1-3-Pushgateway"><a href="#5-1-3-Pushgateway" class="headerlink" title="5.1.3 Pushgateway"></a>5.1.3 Pushgateway</h3><h3 id="5-1-4-Exporters"><a href="#5-1-4-Exporters" class="headerlink" title="5.1.4 Exporters"></a>5.1.4 Exporters</h3><h3 id="5-1-5-Client-Libraries"><a href="#5-1-5-Client-Libraries" class="headerlink" title="5.1.5 Client Libraries"></a>5.1.5 Client Libraries</h3><h3 id="5-1-6-Auth-and-encrytion"><a href="#5-1-6-Auth-and-encrytion" class="headerlink" title="5.1.6 Auth and encrytion"></a>5.1.6 Auth and encrytion</h3><p>prometheus åŠå…¶ç»„å»ºä¸æä¾›ä»»ä½•èº«ä»½éªŒè¯ï¼ˆserver-side authenticationï¼‰,æˆæƒï¼ˆauthorizationï¼‰ ,åŠ å¯†ï¼ˆencryptionï¼‰</p><p>å¦‚æœéœ€è¦ï¼Œå»ºè®®é‡‡ç”¨<code>åå‘ä»£ç†</code></p><ul><li><p>åœ¨ç®¡ç†æˆ–è€…mutating endpoints ä½¿ç”¨ç®€å•çš„è®¿é—®å·¥å…·ï¼ˆå¦‚cURLï¼‰è®¿é—®ï¼Œç”±äºpromæ²¡æœ‰å†…ç½®çš„csrfä¿æŠ¤æ¨¡å—ï¼Œæ‰€ä»¥ä¼šç ´åç±»ç”¨ä¾‹ï¼ˆbreak such use casesï¼‰,å› æ­¤ä½¿ç”¨åå‘ä»£ç†ï¼Œå¯ä»¥é¿å…csrfæ”»å‡»</p></li><li><p>å¯¹äºémutating endpoints ï¼Œä½ å¯ä»¥ä½¿ç”¨cors headers ï¼ˆå¦‚<code>Access-Control-Allow-Origin</code>ï¼‰æ¥é¿å…xssæ”»å‡»</p></li><li><p>å¯¹äºéä¿¡ä»»ç”¨æˆ·ï¼Œä½¿ç”¨è½¬è¯‘</p></li><li>å¯¹äºgrafanaï¼Œåšå¥½æƒé™ç›‘æ§ï¼Œä¸è¦é™åˆ¶ä½¿ç”¨ä»£ç†æ–¹å¼è¿è¡ŒæŸ¥è¯¢è¯­å¥çš„æƒé™</li></ul><h3 id="5-1-7-Secrets"><a href="#5-1-7-Secrets" class="headerlink" title="5.1.7 Secrets"></a>5.1.7 Secrets</h3><h3 id="5-1-8-Denial-of-Service"><a href="#5-1-8-Denial-of-Service" class="headerlink" title="5.1.8 Denial of Service"></a>5.1.8 Denial of Service</h3><h3 id="5-1-9-Libraries"><a href="#5-1-9-Libraries" class="headerlink" title="5.1.9 Libraries"></a>5.1.9 Libraries</h3><h3 id="5-1-10-Build-Process"><a href="#5-1-10-Build-Process" class="headerlink" title="5.1.10 Build Process"></a>5.1.10 Build Process</h3><h3 id="5-1-11-External-audits"><a href="#5-1-11-External-audits" class="headerlink" title="5.1.11 External audits"></a>5.1.11 External audits</h3><h2 id="5-2-Integrations"><a href="#5-2-Integrations" class="headerlink" title="5.2 Integrations"></a>5.2 Integrations</h2><h1 id="6-Instrumenting"><a href="#6-Instrumenting" class="headerlink" title="6.Instrumenting"></a>6.Instrumenting</h1><h1 id="7-Alerting"><a href="#7-Alerting" class="headerlink" title="7.Alerting"></a>7.Alerting</h1><h1 id="8-Best-Practices"><a href="#8-Best-Practices" class="headerlink" title="8.Best Practices"></a>8.Best Practices</h1><h2 id="8-4-Histograms-and-summaries"><a href="#8-4-Histograms-and-summaries" class="headerlink" title="8.4 Histograms and summaries"></a>8.4 Histograms and summaries</h2><h3 id="8-4-1-Library-support"><a href="#8-4-1-Library-support" class="headerlink" title="8.4.1 Library support"></a>8.4.1 Library support</h3><p>å®˜æ–¹ï¼šgo java py ruby</p><p>è¯‘è€…æ³¨ï¼šç›®å‰nodeé€šè¿‡prom-clientä¹Ÿå¯ä»¥ä½¿ç”¨</p><h3 id="8-4-2-Count-and-sum-of-observations"><a href="#8-4-2-Count-and-sum-of-observations" class="headerlink" title="8.4.2 Count and sum of observations"></a>8.4.2 Count and sum of observations</h3><p>ä¸¤è€…éƒ½æ˜¯æ ·æœ¬è§‚å¯Ÿï¼Œè¯·æ±‚æŒç»­æ—¶é—´æˆ–è€…å“åº”å¤§å°ï¼Œè§‚å¯Ÿvalueï¼Œæ±‚å’Œï¼Œè®¡ç®—å¹³å‡å€¼</p><p>å¯ä»¥ä½¿ç”¨summaries &amp; histogramè®¡ç®—è´Ÿå€¼ï¼ˆå¦‚æ¸©åº¦ï¼‰ï¼Œä¸”æ— æ³•ä½¿ç”¨rate</p><p>è®¡ç®—5minä¸­å†…çš„è¯·æ±‚æŒç»­æ—¶é—´ï¼Œå¹³å‡å€¼çš„hisogram or summary</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(http_request_duration_seconds_sum[<span class="number">5</span>m])/rate(http_request_duration_seconds_count[<span class="number">5</span>m])</span><br></pre></td></tr></table></figure><h3 id="8-4-3-Apdex-score"><a href="#8-4-3-Apdex-score" class="headerlink" title="8.4.3 Apdex score"></a>8.4.3 Apdex score</h3><p>Apex =Application Performance Index</p><h3 id="8-4-4-Quantiles"><a href="#8-4-4-Quantiles" class="headerlink" title="8.4.4 Quantiles"></a>8.4.4 Quantiles</h3><h3 id="8-4-5-Errors-of-quantile-estimation"><a href="#8-4-5-Errors-of-quantile-estimation" class="headerlink" title="8.4.5 Errors of quantile estimation"></a>8.4.5 Errors of quantile estimation</h3><h3 id="8-4-6-if-no-library-support"><a href="#8-4-6-if-no-library-support" class="headerlink" title="8.4.6 if no library support"></a>8.4.6 if no library support</h3><h1 id="9-Guides"><a href="#9-Guides" class="headerlink" title="9.Guides"></a>9.Guides</h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;1-Introduction&quot;&gt;&lt;a href=&quot;#1-Introduction&quot; class=&quot;headerlink&quot; title=&quot;1. Introduction&quot;&gt;&lt;/a&gt;1. Introduction&lt;/h1&gt;&lt;h1 id=&quot;2-Concepts&quot;&gt;&lt;a 
      
    
    </summary>
    
      <category term="prometheus" scheme="http://zehai.info/categories/prometheus/"/>
    
    
      <category term="intro" scheme="http://zehai.info/tags/intro/"/>
    
  </entry>
  
  <entry>
    <title>prom-client</title>
    <link href="http://zehai.info/2020/04/29/2020-04-29-prom-client/"/>
    <id>http://zehai.info/2020/04/29/2020-04-29-prom-client/</id>
    <published>2020-04-29T08:18:55.000Z</published>
    <updated>2020-05-30T01:33:31.564Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>prom-client æ”¯æŒnodejsæ”¶é›†metricsï¼Œç›´æ–¹å›¾histogramï¼Œsummariesï¼Œgaugesï¼Œå’Œcounters</p><p>prometheusé€šè¿‡pullè·å–nodeæœåŠ¡æ•°æ®</p><h2 id="æ”¯æŒcluster"><a href="#æ”¯æŒcluster" class="headerlink" title="æ”¯æŒcluster"></a>æ”¯æŒcluster</h2><h1 id="API"><a href="#API" class="headerlink" title="API"></a>API</h1><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>æ‰€æœ‰metricæœ‰ä¸¤ä¸ªå¿…å¡«å‚æ•°ï¼Œnameä¸help</p><h2 id="é»˜è®¤"><a href="#é»˜è®¤" class="headerlink" title="é»˜è®¤"></a>é»˜è®¤</h2><p>1.<code>collectDefaultMetrics</code>ä¸ºpromæ¨èmetricï¼ˆéƒ¨åˆ†metricä»…åœ¨linuxç”Ÿæ•ˆï¼‰</p><p>2.åŒ…å«nodeç‰¹æœ‰çš„metricï¼Œå¦‚eventLoop lagï¼Œactive handlesï¼Œgcï¼Œnode version</p><p>3.collectDefaultMetricså¯ä»¥æ¥å—ä»¥ä¸‹å‚æ•°</p><ul><li>prefixï¼šmetricè‡ªå®šä¹‰å‰ç¼€ï¼Œé»˜è®¤ç©º</li><li>registry ï¼šè‡ªå®šä¹‰æ³¨å†Œè¡¨ï¼Œé»˜è®¤global</li><li><code>gcDurationBuckets</code></li><li><code>eventLoopMonitoringPrecision</code> </li></ul><h3 id="æ›´æ¢registry"><a href="#æ›´æ¢registry" class="headerlink" title="æ›´æ¢registry"></a>æ›´æ¢registry</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> client = <span class="built_in">require</span>(<span class="string">'prom-client'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> collectDefaultMetrics = client.collectDefaultMetrics;</span><br><span class="line"><span class="keyword">const</span> Registry = client.Registry;</span><br><span class="line"><span class="keyword">const</span> register = <span class="keyword">new</span> Registry();</span><br><span class="line">collectDefaultMetrics(&#123; register &#125;);</span><br></pre></td></tr></table></figure><h3 id="To-use-custom-buckets-for-GC-duration-histogram-pass-it-in-as-gcDurationBuckets"><a href="#To-use-custom-buckets-for-GC-duration-histogram-pass-it-in-as-gcDurationBuckets" class="headerlink" title="To use custom buckets for GC duration histogram, pass it in as gcDurationBuckets:"></a>To use custom buckets for GC duration histogram, pass it in as <code>gcDurationBuckets</code>:</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> client = <span class="built_in">require</span>(<span class="string">'prom-client'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> collectDefaultMetrics = client.collectDefaultMetrics;</span><br><span class="line"></span><br><span class="line">collectDefaultMetrics(&#123; <span class="attr">gcDurationBuckets</span>: [<span class="number">0.1</span>, <span class="number">0.2</span>, <span class="number">0.3</span>] &#125;);</span><br></pre></td></tr></table></figure><h3 id="To-prefix-metric-names-with-your-own-arbitrary-string-pass-in-a-prefix"><a href="#To-prefix-metric-names-with-your-own-arbitrary-string-pass-in-a-prefix" class="headerlink" title="To prefix metric names with your own arbitrary string, pass in a prefix:"></a>To prefix metric names with your own arbitrary string, pass in a <code>prefix</code>:</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> client = <span class="built_in">require</span>(<span class="string">'prom-client'</span>);</span><br><span class="line"><span class="keyword">const</span> collectDefaultMetrics = client.collectDefaultMetrics;</span><br><span class="line"><span class="keyword">const</span> prefix = <span class="string">'my_application_'</span>;</span><br><span class="line">collectDefaultMetrics(&#123; prefix &#125;);</span><br></pre></td></tr></table></figure><h3 id="You-can-get-the-full-list-of-metrics-by-inspecting-client-collectDefaultMetrics-metricsList"><a href="#You-can-get-the-full-list-of-metrics-by-inspecting-client-collectDefaultMetrics-metricsList" class="headerlink" title="You can get the full list of metrics by inspecting client.collectDefaultMetrics.metricsList."></a>You can get the full list of metrics by inspecting <code>client.collectDefaultMetrics.metricsList</code>.</h3><p>Default metrics are collected on scrape of metrics endpoint, not on an interval.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> client = <span class="built_in">require</span>(<span class="string">'prom-client'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> collectDefaultMetrics = client.collectDefaultMetrics;</span><br><span class="line"></span><br><span class="line">collectDefaultMetrics();</span><br></pre></td></tr></table></figure><h1 id="counter"><a href="#counter" class="headerlink" title="counter"></a>counter</h1><h1 id="Gauge"><a href="#Gauge" class="headerlink" title="Gauge"></a>Gauge</h1><h1 id="Histogram"><a href="#Histogram" class="headerlink" title="Histogram"></a>Histogram</h1><h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><h1 id="Labels"><a href="#Labels" class="headerlink" title="Labels"></a>Labels</h1><h1 id="Multiple-registries"><a href="#Multiple-registries" class="headerlink" title="Multiple registries"></a>Multiple registries</h1><h1 id="Register"><a href="#Register" class="headerlink" title="Register"></a>Register</h1><h1 id="Pushgateway"><a href="#Pushgateway" class="headerlink" title="Pushgateway"></a>Pushgateway</h1><h1 id="Utilities"><a href="#Utilities" class="headerlink" title="Utilities"></a>Utilities</h1><h1 id="GC-stats"><a href="#GC-stats" class="headerlink" title="GC stats"></a>GC stats</h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h1&gt;&lt;p&gt;prom-client æ”¯æŒnodejsæ”¶é›†metricsï¼Œç›´æ–¹å›¾histogramï¼Œsummariesï¼Œgaugesï¼Œå’Œcounters&lt;
      
    
    </summary>
    
      <category term="prometheus" scheme="http://zehai.info/categories/prometheus/"/>
    
    
      <category term="client" scheme="http://zehai.info/tags/client/"/>
    
  </entry>
  
  <entry>
    <title>Node.JSv14</title>
    <link href="http://zehai.info/2020/04/22/2020-04-22-Node14/"/>
    <id>http://zehai.info/2020/04/22/2020-04-22-Node14/</id>
    <published>2020-04-22T02:37:29.000Z</published>
    <updated>2020-05-30T01:33:31.563Z</updated>
    
    <content type="html"><![CDATA[<h1 id="new"><a href="#new" class="headerlink" title="new"></a>new</h1><p>ä»Šå¤©çœ‹åˆ°Node Currentæ›´æ–°äº†14çš„ç‰ˆæœ¬ï¼Œçœ‹çœ‹éƒ½æœ‰äº›ä»€ä¹ˆä¸œè¥¿</p><p>å‰ç½®äº†è§£äº†ä¸€ä¸‹docä¸­æåˆ°çš„semverï¼Œæ˜¯ä¸€ä¸ªè¯­ä¹‰åŒ–ç‰ˆæœ¬semantic versioningï¼Œå®ç°ç‰ˆæœ¬å’Œç‰ˆæœ¬è§„èŒƒçš„è§£æï¼Œè®¡ç®—ï¼Œæ¯”è¾ƒï¼Œç”¨ä»¥è§£å†³åœ¨å¤§å‹é¡¹ç›®ä¸­å¯¹ä¾èµ–çš„ç‰ˆæœ¬å¤±å»æ§åˆ¶çš„é—®é¢˜ï¼ŒNode.js çš„åŒ…ç®¡ç†å·¥å…· npm ä¹Ÿå®Œå…¨åŸºäº Semantic Versioning æ¥ç®¡ç†ä¾èµ–çš„ç‰ˆæœ¬ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://zhuanlan.zhihu.com/p/20747196" target="_blank" rel="noopener">semverï¼šè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒåœ¨ Node.js ä¸­çš„å®ç°</a></p><h2 id="deprecations"><a href="#deprecations" class="headerlink" title="deprecations"></a>deprecations</h2><p>sermverå¼ƒç”¨ä¸€éƒ¨åˆ†åŠŸèƒ½</p><ul><li><strong>(SEMVER-MAJOR)</strong> <strong>crypto</strong>: move pbkdf2 without digest to EOL (James M Snell) </li><li><strong>(SEMVER-MAJOR)</strong> <strong>fs</strong>: deprecate closing FileHandle on garbage collection (James M Snell)</li><li><strong>(SEMVER-MAJOR)</strong> <strong>http</strong>: move OutboundMessage.prototype.flush to EOL (James M Snell)</li><li><strong>(SEMVER-MAJOR)</strong> <strong>lib</strong>: move GLOBAL and root aliases to EOL (James M Snell)</li><li><strong>(SEMVER-MAJOR)</strong> <strong>os</strong>: move tmpDir() to EOL (James M Snell) </li><li><strong>(SEMVER-MAJOR)</strong> <strong>src</strong>: remove deprecated wasm type check (Clemens Backes) </li><li><strong>(SEMVER-MAJOR)</strong> <strong>stream</strong>: move _writableState.buffer to EOL (James M Snell)</li><li><strong>(SEMVER-MINOR)</strong> <strong>doc</strong>: deprecate process.mainModule (Antoine du HAMEL)</li><li><strong>(SEMVER-MINOR)</strong> <strong>doc</strong>: deprecate process.umask() with no arguments (Colin Ihrig) </li></ul><h2 id="ECMAScript-Modules"><a href="#ECMAScript-Modules" class="headerlink" title="ECMAScript Modules"></a>ECMAScript Modules</h2><p>åœ¨ <code>v13</code> ä¸­ï¼Œéœ€è¦è°ƒç”¨ <code>--experimental-modules</code> æ¥å¼€å¯ <code>ESM module</code> æ”¯æŒï¼Œ è€Œä¸”è¿˜ä¼šæœ‰è­¦å‘Šï¼Œä½†ç›®å‰å·²ç»ç§»é™¤è­¦å‘Šï¼ˆè¿˜æ˜¯éœ€è¦æ‰‹åŠ¨å¼€å¯ï¼‰<br>ä»åœ¨å®éªŒä¸­ï¼Œä½†æ˜¯å…¶å·²ç»éå¸¸å®Œå–„ï¼Œç§»é™¤è­¦å‘Šè¿ˆå‘äº†stableçš„é‡è¦ä¸€æ­¥</p><h2 id="New-V8-ArrayBuffer-API"><a href="#New-V8-ArrayBuffer-API" class="headerlink" title="New V8 ArrayBuffer API"></a>New V8 ArrayBuffer API</h2><p>v8ä¸å†æ”¯æŒå¤šä¸ªArrayBufferæŒ‡å‘ç›¸åŒçš„base address</p><h2 id="Toolchain-and-Compiler-Upgrades"><a href="#Toolchain-and-Compiler-Upgrades" class="headerlink" title="Toolchain and Compiler Upgrades"></a>Toolchain and Compiler Upgrades</h2><p>//æ²¡çœ‹æ‡‚</p><ul><li><strong>(SEMVER-MAJOR)</strong> <strong>build</strong>: update macos deployment target to 10.13 for 14.x (AshCripps) <a href="https://github.com/nodejs/node/pull/32454" target="_blank" rel="noopener">#32454</a></li><li><strong>(SEMVER-MAJOR)</strong> <strong>doc</strong>: update cross compiler machine for Linux armv7 (Richard Lau) <a href="https://github.com/nodejs/node/pull/32812" target="_blank" rel="noopener">#32812</a></li><li><strong>(SEMVER-MAJOR)</strong> <strong>doc</strong>: update Centos/RHEL releases use devtoolset-8 (Richard Lau) <a href="https://github.com/nodejs/node/pull/32812" target="_blank" rel="noopener">#32812</a></li><li><strong>(SEMVER-MAJOR)</strong> <strong>doc</strong>: remove SmartOS from official binaries (Richard Lau) <a href="https://github.com/nodejs/node/pull/32812" target="_blank" rel="noopener">#32812</a></li><li><strong>(SEMVER-MAJOR)</strong> <strong>win</strong>: block running on EOL Windows versions (JoÃ£o Reis) <a href="https://github.com/nodejs/node/pull/31954" target="_blank" rel="noopener">#31954</a></li></ul><p>It is expected that there will be an ABI mismatch on ARM between the Node.js binary and native addons. Native addons are only broken if they interact with <code>std::shared_ptr</code>. This is expected to be fixed in a later version of Node.js 14.</p><h2 id="Update-to-V8-8-1"><a href="#Update-to-V8-8-1" class="headerlink" title="Update to V8 8.1"></a>Update to V8 8.1</h2><h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><ul><li><strong>cli, report</strong>: move â€“report-on-fatalerror to stable (Colin Ihrig) </li><li><strong>deps</strong>: upgrade to libuv 1.37.0 (Colin Ihrig) </li><li><strong>fs</strong>: add fs/promises alias module </li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;new&quot;&gt;&lt;a href=&quot;#new&quot; class=&quot;headerlink&quot; title=&quot;new&quot;&gt;&lt;/a&gt;new&lt;/h1&gt;&lt;p&gt;ä»Šå¤©çœ‹åˆ°Node Currentæ›´æ–°äº†14çš„ç‰ˆæœ¬ï¼Œçœ‹çœ‹éƒ½æœ‰äº›ä»€ä¹ˆä¸œè¥¿&lt;/p&gt;
&lt;p&gt;å‰ç½®äº†è§£äº†ä¸€ä¸‹docä¸­æåˆ°çš„semverï¼Œæ˜¯ä¸€ä¸ª
      
    
    </summary>
    
      <category term="Node" scheme="http://zehai.info/categories/Node/"/>
    
    
      <category term="14" scheme="http://zehai.info/tags/14/"/>
    
  </entry>
  
  <entry>
    <title>kubernetes</title>
    <link href="http://zehai.info/2020/04/21/2020-04-21-kubenates/"/>
    <id>http://zehai.info/2020/04/21/2020-04-21-kubenates/</id>
    <published>2020-04-21T08:18:55.000Z</published>
    <updated>2020-05-30T01:40:04.969Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2-Basic"><a href="#2-Basic" class="headerlink" title="2.Basic"></a>2.Basic</h1><h2 id="2-1-åˆ›å»ºé›†ç¾¤"><a href="#2-1-åˆ›å»ºé›†ç¾¤" class="headerlink" title="2.1 åˆ›å»ºé›†ç¾¤"></a>2.1 åˆ›å»ºé›†ç¾¤</h2><p>minikube create</p><h2 id="2-2-éƒ¨ç½²åº”ç”¨"><a href="#2-2-éƒ¨ç½²åº”ç”¨" class="headerlink" title="2.2 éƒ¨ç½²åº”ç”¨"></a>2.2 éƒ¨ç½²åº”ç”¨</h2><p>ä¸€æ—¦è¿è¡Œäº† Kubernetes é›†ç¾¤ï¼Œå°±å¯ä»¥åœ¨å…¶ä¸Šéƒ¨ç½²å®¹å™¨åŒ–åº”ç”¨ç¨‹åºã€‚ ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦åˆ›å»º Kubernetes <strong>Deployment</strong> é…ç½®ã€‚Deployment <strong>æŒ‡æŒ¥ Kubernetes å¦‚ä½•åˆ›å»ºå’Œæ›´æ–°åº”ç”¨ç¨‹åºçš„å®ä¾‹</strong>ã€‚åˆ›å»º Deployment åï¼ŒKubernetes master å°†åº”ç”¨ç¨‹åºå®ä¾‹è°ƒåº¦åˆ°é›†ç¾¤ä¸­çš„å„ä¸ªèŠ‚ç‚¹ä¸Šã€‚</p><p>åˆ›å»ºåº”ç”¨ç¨‹åºå®ä¾‹åï¼ŒKubernetes Deployment æ§åˆ¶å™¨ä¼šæŒç»­ç›‘è§†è¿™äº›å®ä¾‹ã€‚ å¦‚æœæ‰˜ç®¡å®ä¾‹çš„èŠ‚ç‚¹å…³é—­æˆ–è¢«åˆ é™¤ï¼Œåˆ™ Deployment æ§åˆ¶å™¨ä¼šå°†è¯¥å®ä¾‹æ›¿æ¢ä¸ºç¾¤é›†ä¸­å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„å®ä¾‹ã€‚ <strong>è¿™æä¾›äº†ä¸€ç§è‡ªæˆ‘ä¿®å¤æœºåˆ¶æ¥è§£å†³æœºå™¨æ•…éšœç»´æŠ¤é—®é¢˜ã€‚</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create deployment kubernetes-bootcamp --image=gcr.io/google-samples/kubernetes-bootcamp:v1</span><br></pre></td></tr></table></figure><h2 id="2-3-äº†è§£åº”ç”¨"><a href="#2-3-äº†è§£åº”ç”¨" class="headerlink" title="2.3 äº†è§£åº”ç”¨"></a>2.3 äº†è§£åº”ç”¨</h2><p>Kubernates podsï¼ˆå·¥ä½œèŠ‚ç‚¹ï¼‰</p><p>åˆ›å»º Deployment æ—¶, Kubernetes æ·»åŠ äº†ä¸€ä¸ª <strong>Pod</strong> æ¥æ‰˜ç®¡ä½ çš„åº”ç”¨å®ä¾‹ã€‚Pod æ˜¯ Kubernetes æŠ½è±¡å‡ºæ¥çš„ï¼Œè¡¨ç¤ºä¸€ç»„ä¸€ä¸ªæˆ–å¤šä¸ªåº”ç”¨ç¨‹åºå®¹å™¨ï¼ˆå¦‚ Docker æˆ– rkt ï¼‰ï¼Œä»¥åŠè¿™äº›å®¹å™¨çš„ä¸€äº›å…±äº«èµ„æºã€‚è¿™äº›èµ„æºåŒ…æ‹¬:</p><ul><li>å…±äº«å­˜å‚¨ï¼Œå½“ä½œå·</li><li>ç½‘ç»œï¼Œä½œä¸ºå”¯ä¸€çš„é›†ç¾¤ IP åœ°å€</li><li>æœ‰å…³æ¯ä¸ªå®¹å™¨å¦‚ä½•è¿è¡Œçš„ä¿¡æ¯ï¼Œä¾‹å¦‚å®¹å™¨æ˜ åƒç‰ˆæœ¬æˆ–è¦ä½¿ç”¨çš„ç‰¹å®šç«¯å£ã€‚</li></ul><p>Pod ä¸ºç‰¹å®šäºåº”ç”¨ç¨‹åºçš„â€œé€»è¾‘ä¸»æœºâ€å»ºæ¨¡ï¼Œå¹¶ä¸”å¯ä»¥åŒ…å«ç›¸å¯¹ç´§è€¦åˆçš„ä¸åŒåº”ç”¨å®¹å™¨ã€‚ä¾‹å¦‚ï¼ŒPod å¯èƒ½æ—¢åŒ…å«å¸¦æœ‰ Node.js åº”ç”¨çš„å®¹å™¨ï¼Œä¹ŸåŒ…å«å¦ä¸€ä¸ªä¸åŒçš„å®¹å™¨ï¼Œç”¨äºæä¾› Node.js ç½‘ç»œæœåŠ¡å™¨è¦å‘å¸ƒçš„æ•°æ®ã€‚Pod ä¸­çš„å®¹å™¨å…±äº« IP åœ°å€å’Œç«¯å£ï¼Œå§‹ç»ˆä½äºåŒä¸€ä½ç½®å¹¶ä¸”å…±åŒè°ƒåº¦ï¼Œå¹¶åœ¨åŒä¸€å·¥ä½œèŠ‚ç‚¹ä¸Šçš„å…±äº«ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚</p><h2 id="2-4-æš´éœ²åº”ç”¨"><a href="#2-4-æš´éœ²åº”ç”¨" class="headerlink" title="2.4 æš´éœ²åº”ç”¨"></a>2.4 æš´éœ²åº”ç”¨</h2><h2 id="2-5-ä¼¸ç¼©åº”ç”¨"><a href="#2-5-ä¼¸ç¼©åº”ç”¨" class="headerlink" title="2.5 ä¼¸ç¼©åº”ç”¨"></a>2.5 ä¼¸ç¼©åº”ç”¨</h2><h2 id="2-6-æ›´æ–°åº”ç”¨"><a href="#2-6-æ›´æ–°åº”ç”¨" class="headerlink" title="2.6 æ›´æ–°åº”ç”¨"></a>2.6 æ›´æ–°åº”ç”¨</h2><h1 id="3-åœ¨çº¿åŸ¹è®­è¯¾ç¨‹"><a href="#3-åœ¨çº¿åŸ¹è®­è¯¾ç¨‹" class="headerlink" title="3.åœ¨çº¿åŸ¹è®­è¯¾ç¨‹"></a>3.åœ¨çº¿åŸ¹è®­è¯¾ç¨‹</h1><h1 id="4-é…ç½®"><a href="#4-é…ç½®" class="headerlink" title="4. é…ç½®"></a>4. é…ç½®</h1><h1 id="5-æ— çŠ¶æ€åº”ç”¨"><a href="#5-æ— çŠ¶æ€åº”ç”¨" class="headerlink" title="5.æ— çŠ¶æ€åº”ç”¨"></a>5.æ— çŠ¶æ€åº”ç”¨</h1><h1 id="6-æœ‰çŠ¶æ€åº”ç”¨"><a href="#6-æœ‰çŠ¶æ€åº”ç”¨" class="headerlink" title="6.æœ‰çŠ¶æ€åº”ç”¨"></a>6.æœ‰çŠ¶æ€åº”ç”¨</h1><h1 id="7-é›†ç¾¤"><a href="#7-é›†ç¾¤" class="headerlink" title="7.é›†ç¾¤"></a>7.é›†ç¾¤</h1><h1 id="8-Service"><a href="#8-Service" class="headerlink" title="8.Service"></a>8.Service</h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;2-Basic&quot;&gt;&lt;a href=&quot;#2-Basic&quot; class=&quot;headerlink&quot; title=&quot;2.Basic&quot;&gt;&lt;/a&gt;2.Basic&lt;/h1&gt;&lt;h2 id=&quot;2-1-åˆ›å»ºé›†ç¾¤&quot;&gt;&lt;a href=&quot;#2-1-åˆ›å»ºé›†ç¾¤&quot; class=&quot;headerli
      
    
    </summary>
    
      <category term="kubernetes" scheme="http://zehai.info/categories/kubernetes/"/>
    
    
      <category term="intro" scheme="http://zehai.info/tags/intro/"/>
    
  </entry>
  
  <entry>
    <title>LeetCodeWeek2</title>
    <link href="http://zehai.info/2020/04/19/2020-04-19-LeetCodeWeek1/"/>
    <id>http://zehai.info/2020/04/19/2020-04-19-LeetCodeWeek1/</id>
    <published>2020-04-19T05:23:52.000Z</published>
    <updated>2020-05-30T01:33:31.563Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Problem-Product-of-Array-Except-Self"><a href="#Problem-Product-of-Array-Except-Self" class="headerlink" title="Problem Product of Array Except Self"></a>Problem Product of Array Except Self</h1><p>Given an array <code>nums</code> of <em>n</em> integers where <em>n</em> &gt; 1,  return an array <code>output</code> such that <code>output[i]</code> is equal to the product of all the elements of <code>nums</code> except <code>nums[i]</code>.</p><p><strong>Example:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input:  [1,2,3,4]</span><br><span class="line">Output: [24,12,8,6]</span><br></pre></td></tr></table></figure><p><strong>Constraint:</strong> Itâ€™s guaranteed that the product of the elements of any prefix or suffix of the array (including the whole array) fits in a 32 bit integer.</p><p><strong>Note:</strong> Please solve it <strong>without division</strong> and in O(<em>n</em>).</p><p><strong>Follow up:</strong><br>Could you solve it with constant space complexity? (The output array <strong>does not</strong> count as extra space for the purpose of space complexity analysis.)</p><h2 id="key"><a href="#key" class="headerlink" title="key"></a>key</h2><h2 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//3ms</span><br><span class="line">class Solution &#123;</span><br><span class="line">    public int[] productExceptSelf(int[] nums) &#123;</span><br><span class="line">        int sum =1;</span><br><span class="line">        int hasZero =0;</span><br><span class="line">        for(int num :nums)&#123;</span><br><span class="line">            if(num!=0)&#123;</span><br><span class="line">                sum*=num;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                hasZero++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for(int i=0;i&lt;nums.length;i++)&#123;</span><br><span class="line">            if(hasZero&gt;=2)&#123;</span><br><span class="line">                nums[i]=0;</span><br><span class="line">            &#125;else if(hasZero==1)&#123;</span><br><span class="line">                if(nums[i]==0)&#123;</span><br><span class="line">                    nums[i]=sum;</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    nums[i]=0;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                nums[i]=sum/nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return nums;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//1ms</span><br><span class="line">class Solution &#123;</span><br><span class="line">    public int[] productExceptSelf(int[] nums) &#123;</span><br><span class="line">        int n = nums.length;</span><br><span class="line">        int[] left = new int[n];</span><br><span class="line">        left[0] = 1;</span><br><span class="line">        for (int i = 1; i &lt; n; i++) &#123;</span><br><span class="line">            left[i] = left[i-1] * nums[i-1];</span><br><span class="line">        &#125;</span><br><span class="line">        int product = 1;</span><br><span class="line">        for (int i = n - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">            left[i] *= product;</span><br><span class="line">            product *= nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        return left;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Problem-678Valid-Parenthesis-String"><a href="#Problem-678Valid-Parenthesis-String" class="headerlink" title="Problem-678Valid Parenthesis String"></a>Problem-678Valid Parenthesis String</h1><p><strong>Medium</strong></p><p>Given a string containing only three types of characters: â€˜(â€˜, â€˜)â€™ and â€˜*â€™, write a function to check whether this string is valid. We define the validity of a string by these rules:</p><ol><li>Any left parenthesis <code>&#39;(&#39;</code> must have a corresponding right parenthesis <code>&#39;)&#39;</code>.</li><li>Any right parenthesis <code>&#39;)&#39;</code> must have a corresponding left parenthesis <code>&#39;(&#39;</code>.</li><li>Left parenthesis <code>&#39;(&#39;</code> must go before the corresponding right parenthesis <code>&#39;)&#39;</code>.</li><li><code>&#39;*&#39;</code> could be treated as a single right parenthesis <code>&#39;)&#39;</code> or a single left parenthesis <code>&#39;(&#39;</code> or an empty string.</li><li>An empty string is also valid.</li></ol><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;()&quot;</span><br><span class="line">Output: True</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;(*)&quot;</span><br><span class="line">Output: True</span><br></pre></td></tr></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;(*))&quot;</span><br><span class="line">Output: True</span><br></pre></td></tr></table></figure><p><strong>Note:</strong></p><ol><li>The string size will be in the range [1, 100].</li></ol><h2 id="key-1"><a href="#key-1" class="headerlink" title="key"></a>key</h2><h2 id="solution-1"><a href="#solution-1" class="headerlink" title="solution"></a>solution</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkValidString</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s.length() == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>;<span class="keyword">int</span> star=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">char</span>[] c = s.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> i : c) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (i) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'('</span>:</span><br><span class="line">                    left++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">')'</span>:</span><br><span class="line">                    left--;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">'*'</span>:</span><br><span class="line">                    star++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (left == <span class="number">0</span> || left - star == <span class="number">0</span> || left + star == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Brute-Force"><a href="#Brute-Force" class="headerlink" title="Brute Force"></a>Brute Force</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> ans = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkValidString</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        solve(<span class="keyword">new</span> StringBuilder(s), <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(StringBuilder sb, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (i == sb.length()) &#123;</span><br><span class="line">            ans |= valid(sb);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sb.charAt(i) == <span class="string">'*'</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">char</span> c: <span class="string">"() "</span>.toCharArray()) &#123;</span><br><span class="line">                sb.setCharAt(i, c);</span><br><span class="line">                solve(sb, i+<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (ans) <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            sb.setCharAt(i, <span class="string">'*'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            solve(sb, i + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">valid</span><span class="params">(StringBuilder sb)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> bal = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sb.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = sb.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="string">'('</span>) bal++;</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="string">')'</span>) bal--;</span><br><span class="line">            <span class="keyword">if</span> (bal &lt; <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bal == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Dynamic-Programming"><a href="#Dynamic-Programming" class="headerlink" title="Dynamic Programming"></a>Dynamic Programming</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkValidString</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = s.length();</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">boolean</span>[][] dp = <span class="keyword">new</span> <span class="keyword">boolean</span>[n][n];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s.charAt(i) == <span class="string">'*'</span>) dp[i][i] = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &lt; n-<span class="number">1</span> &amp;&amp;</span><br><span class="line">                    (s.charAt(i) == <span class="string">'('</span> || s.charAt(i) == <span class="string">'*'</span>) &amp;&amp;</span><br><span class="line">                    (s.charAt(i+<span class="number">1</span>) == <span class="string">')'</span> || s.charAt(i+<span class="number">1</span>) == <span class="string">'*'</span>)) &#123;</span><br><span class="line">                dp[i][i+<span class="number">1</span>] = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> size = <span class="number">2</span>; size &lt; n; size++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i + size &lt; n; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s.charAt(i) == <span class="string">'*'</span> &amp;&amp; dp[i+<span class="number">1</span>][i+size] == <span class="keyword">true</span>) &#123;</span><br><span class="line">                    dp[i][i+size] = <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s.charAt(i) == <span class="string">'('</span> || s.charAt(i) == <span class="string">'*'</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = i+<span class="number">1</span>; k &lt;= i+size; k++) &#123;</span><br><span class="line">                        <span class="keyword">if</span> ((s.charAt(k) == <span class="string">')'</span> || s.charAt(k) == <span class="string">'*'</span>) &amp;&amp;</span><br><span class="line">                                (k == i+<span class="number">1</span> || dp[i+<span class="number">1</span>][k-<span class="number">1</span>]) &amp;&amp;</span><br><span class="line">                                (k == i+size || dp[k+<span class="number">1</span>][i+size])) &#123;</span><br><span class="line">                            dp[i][i+size] = <span class="keyword">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>][n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Greedy"><a href="#Greedy" class="headerlink" title="Greedy"></a>Greedy</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkValidString</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">int</span> lo = <span class="number">0</span>, hi = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">char</span> c: s.toCharArray()) &#123;</span><br><span class="line">           lo += c == <span class="string">'('</span> ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">           hi += c != <span class="string">')'</span> ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">           <span class="keyword">if</span> (hi &lt; <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">           lo = Math.max(lo, <span class="number">0</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> lo == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Problem-Product-of-Array-Except-Self&quot;&gt;&lt;a href=&quot;#Problem-Product-of-Array-Except-Self&quot; class=&quot;headerlink&quot; title=&quot;Problem Product of A
      
    
    </summary>
    
      <category term="LeetCode" scheme="http://zehai.info/categories/LeetCode/"/>
    
    
      <category term="Easy" scheme="http://zehai.info/tags/Easy/"/>
    
  </entry>
  
  <entry>
    <title>åŒä¸€å®¿ä¸»æœºä¸‹dockeräº’ç›¸è®¿é—®</title>
    <link href="http://zehai.info/2020/04/16/2020-04-16-%E5%90%8C%E4%B8%80%E5%AE%BF%E4%B8%BB%E6%9C%BA%E4%B8%8Bdocker%E4%BA%92%E7%9B%B8%E8%AE%BF%E9%97%AE/"/>
    <id>http://zehai.info/2020/04/16/2020-04-16-åŒä¸€å®¿ä¸»æœºä¸‹dockeräº’ç›¸è®¿é—®/</id>
    <published>2020-04-16T10:06:19.000Z</published>
    <updated>2020-05-30T01:33:31.563Z</updated>
    
    <content type="html"><![CDATA[<h1 id="what"><a href="#what" class="headerlink" title="what"></a>what</h1><p>è¯¥æ–‡æ¡£è§£å†³ï¼šdockerä¸‹ï¼Œaltermanageræ”¶ä¸åˆ°prometheusæ¶ˆæ¯</p><p>äº‹å› ï¼Œæˆ‘åœ¨ä¸€ä¸ªå®¿ä¸»æœºä¸‹å»ºç«‹äº†å¤šä¸ªdockerå®¹å™¨</p><ul><li>node-exporter</li><li>prometheus</li><li>grafana</li><li>alertmanager</li><li>timonwong/prometheus-webhook-dingtalk</li></ul><p>è¿™äº›æœåŠ¡ä¹‹é—´ä¼šæœ‰ä¸€äº›äº’ç›¸è®¿é—®ï¼Œå¦‚prometheuså¯ä»¥å‘é€æ•°æ®ç»™alertmanageræ¥å‘é€æŠ¥è­¦ä¿¡æ¯ï¼Œalertmanageré€šè¿‡è§„åˆ™å¤„ç†å¯ä»¥å‘é€é‚®ä»¶ï¼Œå‘é€é’‰é’‰ç­‰æ–¹å¼å‘ŠçŸ¥ç”¨æˆ·ï¼Œé—®é¢˜å°±å‡ºåœ¨prometheusçš„ymlé…ç½®æ–‡æ¡£ä¸­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">    - static_configs:</span><br><span class="line">        - targets: ['localhost:9002']  </span><br><span class="line">        </span><br><span class="line"><span class="meta">#</span>##############</span><br><span class="line">ä¿®æ”¹åï¼š</span><br><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">    - static_configs:</span><br><span class="line">        - targets: ['10.10.10.10:9002']</span><br></pre></td></tr></table></figure><p>é—®é¢˜å‡ºåœ¨äº†prometheusçš„é…ç½®ä¸­è®¿é—®äº†localhostç«¯å£ï¼Œä½†è¿™ä¸ªå¹¶ä¸æ˜¯è®¿é—®å®¿ä¸»æœºçš„9002çš„ç«¯å£ï¼Œè€Œæ˜¯è®¿é—®çš„æ˜¯<code>dockerå†…éƒ¨çš„9002</code>ç«¯å£</p><p>æ‰¾åˆ°é—®é¢˜åï¼Œä½¿ç”¨äº†å®¿ä¸»æœºip+portçš„æ–¹å¼è¿›è¡Œè®¿é—®</p><h1 id="how"><a href="#how" class="headerlink" title="how"></a>how</h1><p>æŸ¥è¯¢äº†èµ„æ–™åï¼Œå‘ç°è§£å†³è¯¥é—®é¢˜çš„æ–¹æ³•æœ‰ï¼š</p><ul><li>å®¿ä¸»ipï¼športè®¿é—®</li><li>å®¹å™¨ipè®¿é—®</li><li>linkå»ºç«‹é€šä¿¡ç½‘ç»œ(å•å‘ï¼Œä¸æ¨è)â€“link xxx</li><li>user-defined networksï¼ˆdocker dns server/bridgeï¼‰</li></ul><p>å‰ä¸¤ç§ä¸å¤ªæ¨èï¼Œå› ä¸ºå¦‚æœå®¹å™¨ipæ›´æ”¹æˆ–è€…å®¿ä¸»æœºipæ›´æ”¹å°±éœ€è¦æ›´æ–°é…ç½®æ–‡æ¡£ï¼Œç¬¬ä¸‰ç§æ–¹æ³•ä¸å¤ªæ¨èï¼Œrun æ—¶å€™linkåªæ˜¯å•å‘çš„å»ºç«‹è¿æ¥ï¼Œç¬¬å››ç§<a href="https://docs.docker.com/engine/reference/commandline/network_create/" target="_blank" rel="noopener">docker network create</a>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//åˆ›å»ºç½‘ç»œ</span><br><span class="line">docker network create -d bridge my-bridge-network</span><br><span class="line">//runæ—¶å€™åŠ å…¥ç½‘ç»œ</span><br><span class="line">docker run -it --network test-network --network-alias mysql  -e MYSQL_ROOT_PASSWORD=123 mysql:5.7</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;what&quot;&gt;&lt;a href=&quot;#what&quot; class=&quot;headerlink&quot; title=&quot;what&quot;&gt;&lt;/a&gt;what&lt;/h1&gt;&lt;p&gt;è¯¥æ–‡æ¡£è§£å†³ï¼šdockerä¸‹ï¼Œaltermanageræ”¶ä¸åˆ°prometheusæ¶ˆæ¯&lt;/p&gt;
&lt;p&gt;äº‹å› ï¼Œæˆ‘åœ¨ä¸€ä¸ªå®¿ä¸»æœºä¸‹å»ºç«‹
      
    
    </summary>
    
      <category term="Question" scheme="http://zehai.info/categories/Question/"/>
    
    
      <category term="æ•´ç†" scheme="http://zehai.info/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>nodeæ•´ç†</title>
    <link href="http://zehai.info/2020/04/10/2020-04-10-eventloop/"/>
    <id>http://zehai.info/2020/04/10/2020-04-10-eventloop/</id>
    <published>2020-04-10T08:44:26.000Z</published>
    <updated>2020-05-30T01:33:31.563Z</updated>
    
    <content type="html"><![CDATA[<h1 id="What"><a href="#What" class="headerlink" title="What"></a>What</h1><p>eventloopä½¿å¾—å•çº¿ç¨‹æœºåˆ¶çš„nodeå®ç°éé˜»å¡I/Oçš„æœºåˆ¶ï¼Œå°†ä»»åŠ¡é€šè¿‡libuvåˆ†å‘ç»™çº¿ç¨‹æ± åï¼Œäº¤ç”±ç³»ç»Ÿå†…æ ¸å®Œæˆï¼ˆå¤šçº¿ç¨‹ï¼‰ï¼Œå®Œæˆåå†…æ ¸é€šçŸ¥nodejsï¼Œå°†å›è°ƒæ”¾å…¥<code>poll</code>é˜Ÿåˆ—æ‰§è¡Œ</p><p>å¯åŠ¨nodejsæ—¶ï¼Œeventloopåˆå§‹åŒ–ï¼Œè¿›ç¨‹ä¼šè¾“å…¥å¾ˆå¤šscriptï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>async API calls</li><li>å®šæ—¶å™¨</li><li>process.nextTick()</li></ul><p><img src="../img/phaseOfEventloop-1586590365657.png" alt=""></p><p>eventloopæœ‰å…­ä¸ªé˜Ÿåˆ—</p><ul><li>timers</li><li>pending callbacks</li><li>idle,prepare</li><li>poll(connections,data,etc)</li><li>check</li><li>close callbacks</li></ul><p>è¿™äº›é˜Ÿåˆ—è¢«ç§°ä½œphase,æ¯ä¸ªphaseéƒ½æ˜¯ä¸€ä¸ªå¯ä»¥æ”¾callbackçš„FIFOé˜Ÿåˆ—ï¼Œå½“è¿›å…¥ä¸€ä¸ªphaseæ—¶ï¼Œé˜Ÿåˆ—å°†æ‰§è¡Œå®Œphaseä¸­çš„callbackæˆ–è€…æ‰§è¡Œæœ€å¤§æ•°ç›®çš„callbackåå°†è¿›å…¥å¦ä¸€ä¸ªphase</p><ul><li>timersï¼šæ‰§è¡Œå®šæ—¶å™¨ï¼ŒåŒ…æ‹¬setTimeoutï¼ŒsetInerval</li><li>pending callbacks æ‰§è¡Œå»¶è¿Ÿåˆ°ä¸‹ä¸€ä¸ªå¾ªç¯çš„I/O callback</li><li>idleï¼Œprepare å¤„ç†ç³»ç»Ÿå†…éƒ¨</li><li>pollï¼šæ£€æŸ¥æ–°çš„I/Oäº‹ä»¶ï¼Œæ‰§è¡ŒI/Oå›è°ƒ,nodeä¼šé€‚å½“çš„åœ¨æ­¤é˜»å¡</li><li>check:setImmediate()</li><li>closeï¼šå…³é—­å›è°ƒå‡½æ•°ï¼Œå¦‚ï¼šsocket.on(â€˜closeâ€™,foo())</li></ul><h1 id="Detail"><a href="#Detail" class="headerlink" title="Detail"></a>Detail</h1><h2 id="Timers"><a href="#Timers" class="headerlink" title="Timers"></a>Timers</h2><p>è®¾å®šå»¶è¿Ÿåï¼Œtimersä¼šåœ¨è§„å®šçš„æ—¶é—´æ‰§è¡Œï¼Œä½†å­˜åœ¨æƒ…å†µå»¶è¿Ÿï¼Œå¦‚<code>poll</code> phaseæ‰§è¡Œå›è°ƒï¼Œè¶…è¿‡äº†timerè®¾å®šçš„æ—¶é—´ã€‚å› ä¸ºpollå¿…é¡»å®Œæˆä¸€ä¸ªä»»åŠ¡åæ‰å¯ä»¥æ£€æŸ¥æœ€è¿‘çš„å®šæ—¶å™¨ï¼Œæ²¡åˆ°æ—¶é—´å°±æ‰§è¡Œä¸‹ä¸€ä¸ªcallbackï¼Œæ‰§è¡ŒcallbackæœŸé—´æ— æ³•ä¸­æ–­</p><blockquote><p>å¯ä»¥å¾—å‡ºç»“è®ºï¼š<code>poll</code>æ§åˆ¶ç€å®šæ—¶å™¨ä½•æ—¶æ‰§è¡Œ</p></blockquote><p>å¦å¤–ä¸ºäº†é˜²æ­¢poll phase å˜æˆæ¶æ±‰ï¼Œlibuv åˆ¶å®šäº†ä¸€ä¸ªä¾èµ–äºç³»ç»Ÿçš„ç¡¬æ€§æœ€å¤§å€¼ï¼Œæ¥åœæ­¢è½®è¯¢è·å–æ›´å¤šäº‹ä»¶</p><h2 id="pending-callbacks"><a href="#pending-callbacks" class="headerlink" title="pending callbacks"></a>pending callbacks</h2><p>è¯¥é˜Ÿåˆ—åœ¨ç³»ç»Ÿé”™è¯¯æ—¶æ‰§è¡Œå›è°ƒï¼ˆå¦‚TCP errï¼‰ï¼Œå¦‚TCP socketå°è¯•é‡è¿æ”¶åˆ°äº†<code>ECONNREFUSED</code>ï¼Œç³»ç»Ÿéœ€è¦è¿™äº›é”™è¯¯æŠ¥å‘Šï¼Œé‚£è¿™ä¸ªé”™è¯¯æŠ¥å‘Šå›è°ƒå°±ä¼šæ”¾åœ¨pending callbacksä¸­ç­‰å¾…è¢«æ‰§è¡Œ</p><h2 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h2><p>æœ€é‡è¦çš„é˜¶æ®µï¼Œpollä¸»è¦åŒ…å«ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><ol><li><p>è®¡ç®—é˜»å¡å’Œè½®è¯¢çš„IOæ—¶é—´</p></li><li><p>æ‰§è¡Œpoll é˜Ÿåˆ—é‡Œçš„events</p></li></ol><p>å½“eventloopè¿›å…¥<code>poll</code>é˜¶æ®µï¼Œå¹¶æ²¡æœ‰timersçš„æ—¶å€™</p><ul><li><code>poll</code>ä¸ä¸ºç©ºï¼Œé¡ºåºåŒæ­¥æ‰§è¡Œä»»åŠ¡ï¼Œç›´åˆ°ä¸ºç©ºæˆ–è¾¾åˆ°å¤„ç†æ•°é‡ä¸Šé™</li><li><code>poll</code>ä¸ºç©ºï¼šå¦‚æœæœ‰setImmediate()ï¼Œåˆ™è¿›å…¥<code>check phase</code>ï¼Œåä¹‹å°±åœ¨<code>poll</code>ç­‰å®¢äºº</li></ul><p>ä¸€ä½†<code>poll</code>ä¸ºç©ºï¼Œeventloppå°†ä¼šæ£€æŸ¥è®¡æ—¶å™¨æ˜¯å¦æœ‰å¿«åˆ°çš„ï¼Œå¦‚æœæœ‰éœ€è¦æ‰§è¡Œçš„ï¼Œeventloopå°†è¦è¿›å…¥<code>timers</code>é˜¶æ®µæ¥é¡ºåºæ‰§è¡Œtimer callback</p><h2 id="check"><a href="#check" class="headerlink" title="check"></a>check</h2><p>è¿™ä¸ªphaseå¯ä»¥åœ¨<code>poll</code>æ‰§è¡Œå®Œæˆæ—¶å¼€å§‹æ‰§è¡ŒsetImmediate()å›è°ƒã€‚ä»–å…¶å®æ˜¯ç‰¹æ®Šçš„å®šæ—¶å™¨é˜Ÿåˆ—ï¼Œ<strong>ä½¿ç”¨libuv APIåœ¨pollå®Œæˆçš„é˜¶æ®µæ‰§è¡Œ</strong>ï¼ˆè¿™ä¹Ÿæ˜¯ä»–å­˜åœ¨çš„åŸå› ï¼‰ã€‚</p><h2 id="close-callbacks"><a href="#close-callbacks" class="headerlink" title="close callbacks"></a>close callbacks</h2><p>socket.desroy()ç­‰æ‰§è¡Œå…³é—­eventæ—¶å€™ä¼šè¿›å…¥è¯¥phaseï¼Œå¦åˆ™ä¼šè¢«process.nextTick()è§¦å‘</p><h1 id="setImmedate-vs-setTimeout"><a href="#setImmedate-vs-setTimeout" class="headerlink" title="setImmedate() vs setTimeout()"></a>setImmedate() vs setTimeout()</h1><p>ç›¸ä¼¼å´åˆä¸åŒ</p><ul><li>setImmediate()æ˜¯pollæ‰§è¡Œå®Œæˆåæ‰§è¡Œçš„script</li><li>setTimeout()æ˜¯å®šæ—¶æ‰§è¡Œçš„</li></ul><p>æ‰§è¡Œå“ªä¸ªæ”¶åˆ°ä¸Šä¸‹æ–‡çš„çº¦æŸï¼Œå¦‚æœä¸¤ä¸ªéƒ½è¢«ä¸»æ¨¡å—è°ƒç”¨ï¼Œé‚£ä¹ˆè¿›ç¨‹æ€§èƒ½å°†ä¼šæ”¶åˆ°çº¦æŸï¼ˆå½±å“å…¶ä»–appè¿è¡Œï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">without IO</span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  console.log(&apos;timeout&apos;);</span><br><span class="line">&#125;, 0);</span><br><span class="line"></span><br><span class="line">setImmediate(() =&gt; &#123;</span><br><span class="line">  console.log(&apos;immediate&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">//</span><br><span class="line">$ node timeout_vs_immediate.js</span><br><span class="line">timeout</span><br><span class="line">immediate</span><br><span class="line"></span><br><span class="line">$ node timeout_vs_immediate.js</span><br><span class="line">immediate</span><br><span class="line">timeout</span><br><span class="line"></span><br><span class="line">with IO</span><br><span class="line">// timeout_vs_immediate.js</span><br><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line"></span><br><span class="line">fs.readFile(__filename, () =&gt; &#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    console.log(&apos;timeout&apos;);</span><br><span class="line">  &#125;, 0);</span><br><span class="line">  setImmediate(() =&gt; &#123;</span><br><span class="line">    console.log(&apos;immediate&apos;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">//</span><br><span class="line">immediate</span><br><span class="line">timeout</span><br></pre></td></tr></table></figure><p>setImmediate()å¥½å¤„åœ¨äºï¼Œå¦‚æœæœ‰IOæ—¶ä¼šæ¯”setTimeoutå…ˆæ‰§è¡Œ</p><h2 id="process-nextTick"><a href="#process-nextTick" class="headerlink" title="process.nextTick()"></a>process.nextTick()</h2><p>å®ƒæ˜¯ä¸ªå¼‚æ­¥APIï¼Œå¹¶æ²¡æœ‰å‡ºç°åœ¨å…­ä¸ªphaseä¸­ï¼Œä»–å¹¶ä¸å±äºeventloopçš„ä¸€éƒ¨åˆ†ï¼Œå½“æ“ä½œå®Œæˆåå¤„ç†nextTickQueueè€Œä¸ç®¡eventloopæ‰§è¡Œåˆ°å“ªä¸ªé˜¶æ®µï¼Œè¿™ä¸ªå¼‚æ­¥APIä¾èµ–äºC/C++å¤„ç† JavaScript</p><p>ä»–çš„callbakcsä¼šç«‹å³æ‰§è¡Œï¼Œ<strong>ç›´åˆ°æ‰§è¡Œå®Œ</strong>ï¼Œeventloopæ‰ä¼šæ­£å¸¸å·¥ä½œï¼ˆå¦‚æœnextTické€’å½’è°ƒç”¨åˆ™ä¼šæ­»å¾ªç¯ï¼‰</p><p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§è®¾è®¡ï¼Ÿ</p><p>å‡ºäºæ‰€æœ‰<strong>æ¥å£éƒ½åº”è¯¥å¼‚æ­¥</strong>çš„è®¾è®¡æ€è·¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function apiCall(arg, callback) &#123;</span><br><span class="line">  if (typeof arg !== &apos;string&apos;)</span><br><span class="line">    return process.nextTick(callback,</span><br><span class="line">                            new TypeError(&apos;argument should be string&apos;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç æ®µä¼šæ ¡éªŒå‚æ•°ï¼Œå¦‚æœä¸æ­£ç¡®ï¼Œå®ƒå°†ä¼šæŠŠé”™è¯¯ä¼ é€’ç»™å›è°ƒã€‚è¯¥APIæœ€è¿‘æ›´æ–°ï¼Œå…è®¸ä¼ ä»»ä½•å‚ç»™process.nextTick(),æ‰€ä»¥ä½ ä¸éœ€è¦åµŒå¥—ã€‚ä»…åœ¨å‰©ä½™ä»£ç æ‰§è¡Œä¹‹åæˆ‘ä»¬ä¼šæŠŠé”™è¯¯åé¦ˆç»™ç”¨æˆ·ï¼Œé€šè¿‡nextTickï¼Œæˆ‘ä»¬ä¿è¯<code>apiCal()</code>å§‹ç»ˆåœ¨ç”¨æˆ·èƒœäºä»£ç ä¹‹ååŠeventloopç»§ç»­ä¹‹å‰ï¼Œæ‰§è¡Œã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼ŒJSæ ˆå†…å­˜å…è®¸å±•å¼€å¹¶ä¸”ç«‹å³æ‰§è¡Œæä¾›çš„callbackï¼Œä¼¼çš„nextTické€’å½’ä¸ä¼šæœ‰æŠ¥é”™ã€‚</p><h3 id="process-nextTick-vs-setImmediate"><a href="#process-nextTick-vs-setImmediate" class="headerlink" title="process.nextTick() vs setImmediate()"></a>process.nextTick() vs setImmediate()</h3><ul><li>process.nextTick()ç«‹åˆ»æ‰§è¡Œ</li><li>setImmediate()ä¸‹æ¬¡tickæ‰§è¡Œ</li></ul><p>ä¸ºä»€ä¹ˆéœ€è¦process.nextTick()</p><ul><li>å…è®¸ç”¨æˆ·å¤„ç†errorsï¼Œæ¸…ç†ä¸éœ€è¦çš„èµ„æºï¼Œäº‹ä»¶å¾ªç¯å‰ å°è¯•é‡æ–°è¿æ¥</li><li>æœ‰æ—¶æœ‰å¿…è¦åœ¨eventloopç»§ç»­ä¹‹å‰ï¼Œåœ¨call stack unwoundä¹‹åï¼Œè®©callbackæ‰§è¡Œ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const server = net.createServer();</span><br><span class="line">server.on(&apos;connection&apos;, (conn) =&gt; &#123; &#125;);</span><br><span class="line"></span><br><span class="line">server.listen(8080);</span><br><span class="line">server.on(&apos;listening&apos;, () =&gt; &#123; &#125;);</span><br></pre></td></tr></table></figure><p>listen()çš„callbackè°ƒç”¨çš„æ˜¯setImmiate()ï¼Œé™¤éä¼ é€’Hostnameï¼Œå¦åˆ™ç«‹å³ç»‘å®šç«¯å£ã€‚ä¸ºäº†ä¿è¯eventloopç»§ç»­ï¼Œä»–å¿…é¡»è¿›å…¥<code>poll</code> phaseï¼Œè¿™æ„å‘³ç€ï¼Œå­˜åœ¨å¯èƒ½å·²ç»æ”¶åˆ°äº†è¿æ¥ï¼Œä»è€Œå…è®¸åœ¨ä¾¦å¬äº‹ä»¶ä¹‹å‰è§¦å‘è¿æ¥äº‹ä»¶</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;What&quot;&gt;&lt;a href=&quot;#What&quot; class=&quot;headerlink&quot; title=&quot;What&quot;&gt;&lt;/a&gt;What&lt;/h1&gt;&lt;p&gt;eventloopä½¿å¾—å•çº¿ç¨‹æœºåˆ¶çš„nodeå®ç°éé˜»å¡I/Oçš„æœºåˆ¶ï¼Œå°†ä»»åŠ¡é€šè¿‡libuvåˆ†å‘ç»™çº¿ç¨‹æ± åï¼Œäº¤ç”±ç³»ç»Ÿå†…æ ¸å®Œæˆï¼ˆå¤šçº¿
      
    
    </summary>
    
      <category term="Node" scheme="http://zehai.info/categories/Node/"/>
    
    
      <category term="æ•´ç†" scheme="http://zehai.info/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>LeetCodeWeek2</title>
    <link href="http://zehai.info/2020/04/08/2020-04-08-LeetCodeWeek2/"/>
    <id>http://zehai.info/2020/04/08/2020-04-08-LeetCodeWeek2/</id>
    <published>2020-04-08T08:44:26.000Z</published>
    <updated>2020-05-30T01:33:31.563Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Prolem876-Submission-Detail"><a href="#Prolem876-Submission-Detail" class="headerlink" title="Prolem876-Submission Detail"></a>Prolem876-Submission Detail</h1><p>Given a non-empty, singly linked list with head node <code>head</code>, return a middle node of linked list.</p><p>If there are two middle nodes, return the second middle node.</p><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Input: [1,2,3,4,5]</span><br><span class="line">Output: Node 3 from this list (Serialization: [3,4,5])</span><br><span class="line">The returned node has value 3.  (The judge&apos;s serialization of this node is [3,4,5]).</span><br><span class="line">Note that we returned a ListNode object ans, such that:</span><br><span class="line">ans.val = 3, ans.next.val = 4, ans.next.next.val = 5, and ans.next.next.next = NULL.</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: [1,2,3,4,5,6]</span><br><span class="line">Output: Node 4 from this list (Serialization: [4,5,6])</span><br><span class="line">Since the list has two middle nodes with values 3 and 4, we return the second one.</span><br></pre></td></tr></table></figure><p><strong>Note:</strong></p><ul><li>The number of nodes in the given list will be between <code>1</code> and <code>100</code>.</li></ul><h2 id="key"><a href="#key" class="headerlink" title="key"></a>key</h2><p>é¢˜ç›®è¾“å‡ºå•å‘é“¾è¡¨çš„ä¸­é—´å…ƒç´ ï¼Œæœ‰è¿™ä¹ˆå‡ ä¸ªæ€è·¯</p><ul><li>O(N)â€“&gt;éå†æ”¾æ•°ç»„ï¼Œ1/2è¾“å‡º<code>return A[t / 2]</code></li><li>O(N)â€“&gt;æ ¹æ®ä¸­é—´ç‰¹ç‚¹ï¼Œmidå‰è¿›ä¸€æ ¼ï¼Œendå‰è¿›ä¸¤æ ¼</li></ul><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>ç¬¬ä¸€æ¬¡æäº¤:0ms</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">middleNode</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">        ListNode mid = head;</span><br><span class="line">        ListNode end = head;</span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(end.next!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            mid = head.next;</span><br><span class="line">            ListNode tmp = mid;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">int</span> j=i;</span><br><span class="line">            <span class="keyword">while</span>(j&gt;<span class="number">0</span>)&#123;<span class="comment">//æå¤æ‚äº†</span></span><br><span class="line">                <span class="keyword">if</span>(tmp.next==<span class="keyword">null</span>)<span class="keyword">return</span> mid;</span><br><span class="line">                end = tmp.next;</span><br><span class="line">                tmp=tmp.next;</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">            head=head.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mid;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ¬¡å‚è€ƒå…¶ä»–ä»£ç -æäº¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public ListNode middleNode(ListNode head) &#123;</span><br><span class="line">        ListNode mid = head, end = head;</span><br><span class="line">        while (mid != null &amp;&amp; end.next != null) &#123;</span><br><span class="line">            mid = mid.next;</span><br><span class="line">            end = end.next.next;</span><br><span class="line">        &#125;</span><br><span class="line">        return mid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Prolem876-Submission-Detail&quot;&gt;&lt;a href=&quot;#Prolem876-Submission-Detail&quot; class=&quot;headerlink&quot; title=&quot;Prolem876-Submission Detail&quot;&gt;&lt;/a&gt;Prole
      
    
    </summary>
    
      <category term="LeetCode" scheme="http://zehai.info/categories/LeetCode/"/>
    
    
      <category term="Easy" scheme="http://zehai.info/tags/Easy/"/>
    
  </entry>
  
  <entry>
    <title>LeetCodeWeek1</title>
    <link href="http://zehai.info/2020/04/05/2020-04-05-LeetCodeWeek1/"/>
    <id>http://zehai.info/2020/04/05/2020-04-05-LeetCodeWeek1/</id>
    <published>2020-04-05T14:32:05.000Z</published>
    <updated>2020-05-30T01:33:31.563Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Problem-Single-Number"><a href="#Problem-Single-Number" class="headerlink" title="Problem  Single Number"></a>Problem  Single Number</h1><p>å¥½ä¹…æ²¡æœ‰åˆ·é¢˜äº†ï¼Œåˆšå¥½é‡åˆ°LeetCodeï¼Œ30å¤©è®¡åˆ’ï¼Œæ‰“ç®—å¼ºè¿«è‡ªå·±å®Œæˆ</p><p>Given a <strong>non-empty</strong> array of integers, every element appears <em>twice</em> except for one. Find that single one.</p><p><strong>Note:</strong></p><p>Your algorithm should have a linear runtime complexity. Could you implement it without using extra memory?</p><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [2,2,1]</span><br><span class="line">Output: 1</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [4,1,2,1,2]</span><br><span class="line">Output: 4</span><br></pre></td></tr></table></figure><h1 id="Key"><a href="#Key" class="headerlink" title="Key"></a>Key</h1><p>æ€è·¯</p><ul><li>ç¬¬ä¸€ä¸ªæ€è·¯O(n^2)å»åšç±»ä¼¼äºå†’æ³¡éå†çš„åŠæ³•</li><li>å€ŸåŠ©Array.sort()å¯ä»¥è¿…é€Ÿæ’åºï¼Œç„¶åO(n)çš„åŠæ³•éå†å¾—åˆ°ç»“æœ</li><li>ï¼ˆä»¥ä¸Šæ˜¯è‡ªå·±çš„æ€è·¯ï¼Œä»¥ä¸‹ä¸ºLeetCodeä»£ç æ€è€ƒï¼‰</li><li><a href="## å¼‚æˆ–">é€šè¿‡å¼‚æˆ–æ“ä½œè¿…é€Ÿæ¯”è¾ƒ</a></li><li>é€šè¿‡ Arrays.stream(nums).reduce(0, (x, y) -&gt; x ^ y)æ¥æ›´å¿«è¿­ä»£æ¯ä¸ªå…ƒç´ </li></ul><h2 id="Array-steam"><a href="#Array-steam" class="headerlink" title="Array.steam()"></a>Array.steam()</h2><p>ä»¥ä¸‹å‚è€ƒ<a href="https://blog.csdn.net/a13662080711/article/details/84928181" target="_blank" rel="noopener">CSDN</a></p><p>Stream ä¸æ˜¯é›†åˆå…ƒç´ ï¼Œå®ƒä¸æ˜¯æ•°æ®ç»“æ„å¹¶ä¸ä¿å­˜æ•°æ®ï¼Œå®ƒæ˜¯æœ‰å…³ç®—æ³•å’Œè®¡ç®—çš„ï¼Œå®ƒæ›´åƒä¸€ä¸ªé«˜çº§ç‰ˆæœ¬çš„ Iteratorã€‚åŸå§‹ç‰ˆæœ¬çš„ Iteratorï¼Œç”¨æˆ·åªèƒ½æ˜¾å¼åœ°ä¸€ä¸ªä¸€ä¸ªéå†å…ƒç´ å¹¶å¯¹å…¶æ‰§è¡ŒæŸäº›æ“ä½œï¼›é«˜çº§ç‰ˆæœ¬çš„ Streamï¼Œç”¨æˆ·åªè¦ç»™å‡ºéœ€è¦å¯¹å…¶åŒ…å«çš„å…ƒç´ æ‰§è¡Œä»€ä¹ˆæ“ä½œï¼Œæ¯”å¦‚ â€œè¿‡æ»¤æ‰é•¿åº¦å¤§äº 10 çš„å­—ç¬¦ä¸²â€ã€â€œè·å–æ¯ä¸ªå­—ç¬¦ä¸²çš„é¦–å­—æ¯â€ç­‰ï¼ŒStream ä¼šéšå¼åœ°åœ¨å†…éƒ¨è¿›è¡Œéå†ï¼Œåšå‡ºç›¸åº”çš„æ•°æ®è½¬æ¢ã€‚</p><p>Stream å°±å¦‚åŒä¸€ä¸ªè¿­ä»£å™¨ï¼ˆIteratorï¼‰ï¼Œå•å‘ï¼Œä¸å¯å¾€å¤ï¼Œæ•°æ®åªèƒ½éå†ä¸€æ¬¡ï¼Œéå†è¿‡ä¸€æ¬¡åå³ç”¨å°½äº†ï¼Œå°±å¥½æ¯”æµæ°´ä»é¢å‰æµè¿‡ï¼Œä¸€å»ä¸å¤è¿”ã€‚</p><p>è€Œå’Œè¿­ä»£å™¨åˆä¸åŒçš„æ˜¯ï¼ŒStream å¯ä»¥å¹¶è¡ŒåŒ–æ“ä½œï¼Œè¿­ä»£å™¨åªèƒ½å‘½ä»¤å¼åœ°ã€ä¸²è¡ŒåŒ–æ“ä½œã€‚é¡¾åæ€ä¹‰ï¼Œå½“ä½¿ç”¨ä¸²è¡Œæ–¹å¼å»éå†æ—¶ï¼Œæ¯ä¸ª item è¯»å®Œåå†è¯»ä¸‹ä¸€ä¸ª itemã€‚è€Œä½¿ç”¨å¹¶è¡Œå»éå†æ—¶ï¼Œæ•°æ®ä¼šè¢«åˆ†æˆå¤šä¸ªæ®µï¼Œå…¶ä¸­æ¯ä¸€ä¸ªéƒ½åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å¤„ç†ï¼Œç„¶åå°†ç»“æœä¸€èµ·è¾“å‡ºã€‚Stream çš„å¹¶è¡Œæ“ä½œä¾èµ–äº Java7 ä¸­å¼•å…¥çš„ Fork/Join æ¡†æ¶ï¼ˆJSR166yï¼‰æ¥æ‹†åˆ†ä»»åŠ¡å’ŒåŠ é€Ÿå¤„ç†è¿‡ç¨‹</p><p>ç®€å•è¯´ï¼Œå¯¹ Stream çš„ä½¿ç”¨å°±æ˜¯å®ç°ä¸€ä¸ª filter-map-reduce è¿‡ç¨‹ï¼Œäº§ç”Ÿä¸€ä¸ªæœ€ç»ˆç»“æœï¼Œæˆ–è€…å¯¼è‡´ä¸€ä¸ªå‰¯ä½œç”¨ï¼ˆside effectï¼‰ã€‚</p><p>ï¼ˆä»¥ä¸‹ä¸ºä¸ªäººç†è§£ï¼‰</p><p>ç›¸å¯¹äºJavaä¸­çš„Streamæµï¼ŒJavaä¸­ä¹Ÿæœ‰ï¼Œæ¯”å¦‚Array.reduce(),Array.foreach()ç­‰ï¼Œé€šè¿‡å›è°ƒå‡½æ•°çš„æ–¹å¼è¿›è¡Œï¼Œ</p><h2 id="å¼‚æˆ–"><a href="#å¼‚æˆ–" class="headerlink" title="å¼‚æˆ–"></a>å¼‚æˆ–</h2><p>|=ï¼šä¸¤ä¸ªäºŒè¿›åˆ¶å¯¹åº”ä½éƒ½ä¸º0æ—¶ï¼Œç»“æœç­‰äº0ï¼Œå¦åˆ™ç»“æœç­‰äº1ï¼›</p><p>&amp;=ï¼šä¸¤ä¸ªäºŒè¿›åˆ¶çš„å¯¹åº”ä½éƒ½ä¸º1æ—¶ï¼Œç»“æœä¸º1ï¼Œå¦åˆ™ç»“æœç­‰äº0ï¼›</p><p>^=ï¼šä¸¤ä¸ªäºŒè¿›åˆ¶çš„å¯¹åº”ä½ç›¸åŒï¼Œç»“æœä¸º0ï¼Œå¦åˆ™ç»“æœä¸º1ã€‚</p><p>å¯¹äºè¿™é“é¢˜æ¥è¯´ï¼Œ[2,2,1]</p><p>ç¬¬é›¶æ¬¡éå†ï¼šinit res=0,é¢˜ç›®è¦æ±‚æ‰¾å‡ºå‡ºç°ä¸€æ¬¡çš„æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªæ•°è‚¯å®šå­˜åœ¨</p><p>ç¬¬ä¸€æ¬¡éå†ï¼šres=2</p><p>ç¬¬äºŒæ¬¡éå†ï¼šres=0ï¼Œå› ä¸ºres^=2ï¼ˆå³res=res^2ï¼‰</p><p>ç¬¬ä¸‰æ¬¡éå†ï¼šres=1ç»“æŸéå†</p><p><strong>ç»¼ä¸Šï¼šå¸¸ç”¨^= ä»¥åŠ&gt;&gt;ä½è¿ç®—ç¬¦ï¼ŒCçº§åˆ«çš„æ€§èƒ½</strong></p><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><ul><li>å¯¹äºå¼‚æˆ–æ–¹æ³•ï¼ˆ0msï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> n : nums) &#123;</span><br><span class="line">            result ^= n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå·±çš„æ–¹æ³•å°±ä¸è´´äº†ã€‚ã€‚==æ„Ÿè§‰å¥½è ¢==å†™äº†åŠå¤©ã€‚</p><h1 id="Problem-Move-Zeroes"><a href="#Problem-Move-Zeroes" class="headerlink" title="Problem  Move Zeroes"></a>Problem  Move Zeroes</h1><p>Given an array <code>nums</code>, write a function to move all <code>0</code>â€˜s to the end of it while maintaining the relative order of the non-zero elements.</p><p><strong>Example:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [0,1,0,3,12]</span><br><span class="line">Output: [1,3,12,0,0]</span><br></pre></td></tr></table></figure><p><strong>Note</strong>:</p><ol><li>You must do this <strong>in-place</strong> without making a copy of the array.</li><li>Minimize the total number of operations.</li></ol><h1 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h1><p>ç¬¬ä¸€ç‰ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">moveZeroes</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=i;j&lt;nums.length-<span class="number">1</span>;j++)&#123;</span><br><span class="line">                    nums[j]=nums[j+<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                nums[nums.length-<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸæœ¬æ ¹æ®é¢˜ç›®çš„æ„æ€ï¼Œæƒ³æ³•å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ª0ï¼Œæ•´ä½“å¾€å‰ç§»åŠ¨ä¸€ä½ï¼Œä¸€æŠŠæ¢­ï¼Œä½†å†™å®Œå‘ç°ï¼Œ<strong>æœ¬èº«æ²¡æœ‰å¿…è¦æ•´ä½“å‰ç§»</strong>ï¼Œå› ä¸ºæˆ‘çš„åˆ¤æ–­æ˜¯num[i]æ˜¯ä¸æ˜¯ä¸º0ï¼Œæ‰€ä»¥åªéœ€è¦å°†0çš„ä¸ªæ•°è®°å½•ä¸‹æ¥ï¼Œé0çš„å…ƒç´ å‰ç§»ï¼Œæœ€åè¡¥0å°±å¯ä»¥äº†</p><p>ç¬¬äºŒç‰ˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public void moveZeroes(int[] nums) &#123;</span><br><span class="line">         if (nums == null || nums.length == 0) return;        </span><br><span class="line"> </span><br><span class="line">        int insertPos = 0;</span><br><span class="line">        for (int num: nums) &#123;</span><br><span class="line">            if (num != 0) nums[insertPos++] = num;</span><br><span class="line">        &#125;        </span><br><span class="line"></span><br><span class="line">        while (insertPos &lt; nums.length) &#123;</span><br><span class="line">            nums[insertPos++] = 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Problem-Best-Time-to-Buy-and-Sell-Stock-II"><a href="#Problem-Best-Time-to-Buy-and-Sell-Stock-II" class="headerlink" title="Problem Best Time to Buy and Sell Stock II"></a>Problem Best Time to Buy and Sell Stock II</h1><p>Say you have an array for which the ith element is the price of a given stock on day i.</p><p>Design an algorithm to find the maximum profit. You may complete as many transactions as you like (i.e., buy one and sell one share of the stock multiple times).</p><p>Note: You may not engage in multiple transactions at the same time (i.e., you must sell the stock before you buy again).</p><p>Example 1:</p><p>Input: [7,1,5,3,6,4]<br>Output: 7<br>Explanation: Buy on day 2 (price = 1) and sell on day 3 (price = 5), profit = 5-1 = 4.<br>             Then buy on day 4 (price = 3) and sell on day 5 (price = 6), profit = 6-3 = 3.<br>Example 2:</p><p>Input: [1,2,3,4,5]<br>Output: 4<br>Explanation: Buy on day 1 (price = 1) and sell on day 5 (price = 5), profit = 5-1 = 4.<br>             Note that you cannot buy on day 1, buy on day 2 and sell them later, as you are<br>             engaging multiple transactions at the same time. You must sell before buying again.<br>Example 3:</p><p>Input: [7,6,4,3,1]<br>Output: 0<br>Explanation: In this case, no transaction is done, i.e. max profit = 0.</p><h1 id="key"><a href="#key" class="headerlink" title="key"></a>key</h1><p>é¢˜ç›®è·å–æœ€å¤§åˆ©æ¶¦ï¼Œæœ¬ä»¥ä¸ºæ˜¯é€šè¿‡åŠ¨æ€è§„åˆ’DPæ¥åšï¼Œä½†æ˜¯ä»”ç»†ä¸€æƒ³ï¼Œå·®å€¼å°±èƒ½è§£å†³é—®é¢˜<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public int maxProfit(int[] prices) &#123;</span><br><span class="line">        int res = 0;</span><br><span class="line">        for (int i = 0; i &lt; prices.length - 1; ++i) &#123;</span><br><span class="line">            if (prices[i] &lt; prices[i + 1]) &#123;</span><br><span class="line">                res += prices[i + 1] - prices[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="Problem-happy-Number"><a href="#Problem-happy-Number" class="headerlink" title="Problem happy Number"></a>Problem happy Number</h1><p>Write an algorithm to determine if a number is â€œhappyâ€.</p><p>A happy number is a number defined by the following process: Starting with any positive integer, replace the number by the sum of the squares of its digits, and repeat the process until the number equals 1 (where it will stay), or it loops endlessly in a cycle which does not include 1. Those numbers for which this process ends in 1 are happy numbers.</p><p><strong>Example:</strong> </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Input: 19</span><br><span class="line">Output: true</span><br><span class="line">Explanation: </span><br><span class="line">12 + 92 = 82</span><br><span class="line">82 + 22 = 68</span><br><span class="line">62 + 82 = 100</span><br><span class="line">12 + 02 + 02 = 1</span><br></pre></td></tr></table></figure><h1 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h1><p>ç¬¬ä¸€ç‰ˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public boolean isHappy(int n) &#123;</span><br><span class="line">         int sum =0;</span><br><span class="line">        while (sum != 1) &#123;</span><br><span class="line">            if(sum!=0)&#123;</span><br><span class="line">                n=sum;sum=0;</span><br><span class="line">            &#125;</span><br><span class="line">            while (n &gt; 0) &#123;</span><br><span class="line">                int t = n % 10;</span><br><span class="line">                sum += t * t;</span><br><span class="line">                n /= 10;</span><br><span class="line">            &#125;</span><br><span class="line">            if(sum==0)return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å†™å®Œè¿™ä¸ªæ¡†æ¶æˆ‘å°±æƒ³èµ·æ¥äº†ï¼Œå¯èƒ½åœ¨è®¡ç®—ä¸Šå­˜åœ¨æ­»å¾ªç¯ï¼Œå°±æ¯”å¦‚</p><p><img src="../img/aHR0cHM6Ly9waWMubGVldGNvZGUtY24uY29tL0ZpZ3VyZXMvMjAyL2ltYWdlMi5wbmc.jfif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¦‚æœè¿™æ ·çš„é¢˜ç›®å°±è¿›å…¥äº†æ­»å¾ªç¯ï¼Œæ‰€ä»¥å¹²è„†ç›´æ¥é€šè¿‡hashsetçš„æ–¹å¼è¿›è¡Œè¿‡æ»¤</p><p>æ·»åŠ äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(set.contains(sum))&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    set.add(sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´ä½“ä»£ç å¦‚ä¸‹ï¼š</p><p>Runtime: 5 ms, faster than 9.41% of Java online submissions for Happy Number.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isHappy</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    Set&lt;Integer&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">    <span class="keyword">int</span> sum =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (sum != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(sum!=<span class="number">0</span>)&#123;</span><br><span class="line">            n=sum;sum=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> t = n % <span class="number">10</span>;</span><br><span class="line">            sum += t * t;</span><br><span class="line">            n /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(sum==<span class="number">0</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(set.contains(sum))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            set.add(sum);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Problem-Single-Number&quot;&gt;&lt;a href=&quot;#Problem-Single-Number&quot; class=&quot;headerlink&quot; title=&quot;Problem  Single Number&quot;&gt;&lt;/a&gt;Problem  Single Number
      
    
    </summary>
    
      <category term="LeetCode" scheme="http://zehai.info/categories/LeetCode/"/>
    
    
      <category term="Easy" scheme="http://zehai.info/tags/Easy/"/>
    
  </entry>
  
  <entry>
    <title>UniqueBinarySearchTrees</title>
    <link href="http://zehai.info/2020/03/22/2020-03-22-UniqueBinarySearchTrees/"/>
    <id>http://zehai.info/2020/03/22/2020-03-22-UniqueBinarySearchTrees/</id>
    <published>2020-03-22T04:37:47.000Z</published>
    <updated>2020-05-30T01:33:31.563Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Problem-96"><a href="#Problem-96" class="headerlink" title="Problem 96"></a>Problem 96</h1><p>Given <em>n</em>, how many structurally unique <strong>BSTâ€™s</strong> (binary search trees) that store values 1 â€¦ <em>n</em>?</p><p><strong>Example:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Input: 3</span><br><span class="line">Output: 5</span><br><span class="line">Explanation:</span><br><span class="line">Given n = 3, there are a total of 5 unique BST&apos;s:</span><br><span class="line"></span><br><span class="line">   1         3     3      2      1</span><br><span class="line">    \       /     /      / \      \</span><br><span class="line">     3     2     1      1   3      2</span><br><span class="line">    /     /       \                 \</span><br><span class="line">   2     1         2                 3</span><br></pre></td></tr></table></figure><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>é¢˜ç›®å…¶å®ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œç»™å‡º1~nï¼Œç»™å‡ºèƒ½å¤Ÿæˆçš„BSTçš„æ•°ç›®ï¼Œé¢˜ç›®ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯ç”¨1~nå»ç”ŸæˆBSTï¼Œçœ‹ä¸€ä¸‹æœ‰å¤šå°‘ç§æƒ…å†µï¼Œç„¶ååšäº†å¾ˆå¤šæ— ç”¨åŠŸ=.=</p><p>è¶Šå†™è¶Šä¸å¯¹åŠ²åæ¥æŸ¥äº†ä¸€ä¸‹ï¼Œè¿™é“é¢˜æ˜¯æœ‰æ•°å­¦è§„å¾‹çš„</p><p>BSTæœ‰å‡ ä¸ªç‰¹ç‚¹</p><ul><li>ä¸­åºéå†ä¾æ¬¡å¢ï¼ˆå¤§äºç­‰äºï¼‰</li><li>å·¦å³è‡ªè¿°ä¹Ÿæ˜¯BSTï¼ˆrecursionï¼‰</li></ul><p>æ‰€ä»¥åœ¨iä½œä¸ºæ ¹èŠ‚ç‚¹æ—¶ï¼Œå·¦å­æ ‘i-1ä¸ªèŠ‚ç‚¹ï¼Œå³å­æ ‘n-iä¸ªèŠ‚ç‚¹</p><p>æ•°å­¦çš„æ€æƒ³åœ¨äº<strong>å”¯ä¸€äºŒå‰æ ‘çš„ä¸ªæ•°ä¸ºå·¦å­æ ‘ç»“ç‚¹çš„ä¸ªæ•°ä¹˜ä»¥å³å­æ ‘çš„ä¸ªæ•°ã€‚è€Œæ ¹èŠ‚ç‚¹å¯ä»¥ä»1åˆ°n ä¸­é€‰æ‹©</strong>ï¼Œæ‰€ä»¥æœ‰</p><blockquote><p>for(int i=1;i&lt;=n;++i)<br>           sum+=numTrees(i-1)*numTrees(n-i);</p></blockquote><p>å†åŠ ä¸Šè¾¹é™…æ§åˆ¶n&lt;=1â€“&gt;sum=1</p><p>å°±æœ‰äº†è§£é¢˜çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numTrees</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n&lt;=<span class="number">1</span>)    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">            sum+=numTrees(i-<span class="number">1</span>)*numTrees(n-i);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sum;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Solution-95-Unique-Binary-Search-Trees-II"><a href="#Solution-95-Unique-Binary-Search-Trees-II" class="headerlink" title="Solution 95 Unique Binary Search Trees II"></a>Solution 95 Unique Binary Search Trees II</h2><p>ä¸‡å¹¸ï¼Œè‡ªå·±æŠ˜è…¾çš„ç”ŸæˆBSTçš„ä»£ç æ²¡ç™½å†™</p><p>Given an integer <em>n</em>, generate all structurally unique <strong>BSTâ€™s</strong> (binary search trees) that store values 1 â€¦ <em>n</em>.</p><p><strong>Example:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Input: 3</span><br><span class="line">Output:</span><br><span class="line">[</span><br><span class="line">  [1,null,3,2],</span><br><span class="line">  [3,2,null,1],</span><br><span class="line">  [3,1,null,null,2],</span><br><span class="line">  [2,1,3],</span><br><span class="line">  [1,null,2,null,3]</span><br><span class="line">]</span><br><span class="line">Explanation:</span><br><span class="line">The above output corresponds to the 5 unique BST&apos;s shown below:</span><br><span class="line"></span><br><span class="line">   1         3     3      2      1</span><br><span class="line">    \       /     /      / \      \</span><br><span class="line">     3     2     1      1   3      2</span><br><span class="line">    /     /       \                 \</span><br><span class="line">   2     1         2                 3</span><br></pre></td></tr></table></figure><p>çœ‹é¢˜ç›®æ˜¯å‰åºéå†,æˆ‘ä»¬ä»ä¸Šå‘ä¸‹æŸ¥æ‰¾ï¼Œå¤–é¢ä¸€å±‚å¤§å¾ªç¯éå†æ ¹èŠ‚ç‚¹</p><blockquote><p>for(int i=start ;i&lt;=end;i++){}</p></blockquote><p>ç¡®å®šäº†ièŠ‚ç‚¹åå¯ä»¥é€šè¿‡é€’å½’å†™å‡ºæ ¹èŠ‚ç‚¹içš„æƒ…å†µä¸‹çš„å·¦å³å­æ ‘</p><blockquote><p> List<treenode> leftChild = recursion(start, i - 1);</treenode></p><p>List<treenode> rightChild = recursion(i + 1, end);</treenode></p></blockquote><p>ç„¶åéå†å·¦å³å­æ ‘çš„æ¯ä¸ªå…ƒç´ ï¼Œä¸¤å±‚forå¾ªç¯åµŒå¥—</p><blockquote><p>  for(TreeNode left : leftChild) {<br>                for(TreeNode right : rightChild) {<br>                    TreeNode root = new TreeNode(i);<br>                    root.left = left;<br>                    root.right = right;<br>                    res.add(root);<br>                }<br>            }</p></blockquote><p>å¾—åˆ°æœ€åçš„resè¿›è¡Œè¿”å›ï¼Œä»¥åŠå¤„ç†ä¸€ä¸‹start&gt;endçš„è¾¹é™…æ¡ä»¶å°±å®Œæˆäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;TreeNode&gt; <span class="title">generateTrees</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">if</span>(n &lt; <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;TreeNode&gt;();</span><br><span class="line">        <span class="keyword">return</span> recursion(<span class="number">1</span>, n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;TreeNode&gt; <span class="title">recursion</span><span class="params">(<span class="keyword">int</span> start,<span class="keyword">int</span> end)</span></span>&#123;</span><br><span class="line">        List&lt;TreeNode&gt; res = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        <span class="keyword">if</span>(start &gt; end) &#123;</span><br><span class="line">            res.add(<span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = start;i&lt;=end;i++)&#123;</span><br><span class="line">            List&lt;TreeNode&gt; leftChild = recursion(start, i - <span class="number">1</span>);</span><br><span class="line">            List&lt;TreeNode&gt; rightChild = recursion(i + <span class="number">1</span>, end);</span><br><span class="line">            <span class="keyword">for</span>(TreeNode left : leftChild) &#123;</span><br><span class="line">                <span class="keyword">for</span>(TreeNode right : rightChild) &#123;</span><br><span class="line">                    TreeNode root = <span class="keyword">new</span> TreeNode(i);</span><br><span class="line">                    root.left = left;</span><br><span class="line">                    root.right = right;</span><br><span class="line">                    res.add(root);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜å½“æ—¶å¡åœ¨   </p><p>List<treenode> leftChild = recursion(start, i - 1);<br>List<treenode> rightChild = recursion(i + 1, end);</treenode></treenode></p><p>å½“ç„¶é‡‡ç”¨recursionè™½ç„¶ç®€æ´æ˜“æ‡‚ï¼Œä½†ä¸¤æ¡é¢˜ç›®çš„å¤æ‚åº¦éƒ½ç›¸å¯¹è¾ƒé«˜ï¼Œæ˜¯é€’å½’çš„å‹æ ˆé€ æˆçš„ï¼Œå¾ˆå¤šå¯èƒ½ç›¸åŒç‚¹çš„åœ°æ–¹å¯èƒ½è®¡ç®—äº†ä¸¤éï¼Œå¯¼è‡´äº†ä¸¤é“é¢˜ç›®éƒ½æ˜¯æ‰“è´¥äº†5%çš„solutionï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡dp(æ¥è‡ªLeetCode)çš„æ–¹å¼æ¥è¿›è¡Œå®Œæˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;TreeNode&gt; <span class="title">generateTrees</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        List&lt;TreeNode&gt;[][] dp = <span class="keyword">new</span> ArrayList[n][n];</span><br><span class="line">        <span class="keyword">return</span> helper(<span class="number">1</span>, n, dp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;TreeNode&gt; <span class="title">helper</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end, List&lt;TreeNode&gt;[][] dp)</span></span>&#123;</span><br><span class="line">        List&lt;TreeNode&gt; res = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(start &gt; end)&#123;</span><br><span class="line">            res.add(<span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(dp[start - <span class="number">1</span>][end - <span class="number">1</span>] != <span class="keyword">null</span> &amp;&amp; !dp[start - <span class="number">1</span>][end - <span class="number">1</span>].isEmpty())&#123;</span><br><span class="line">            <span class="keyword">return</span> dp[start - <span class="number">1</span>][end - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = start ; i &lt;= end ; i++) &#123;</span><br><span class="line">            List&lt;TreeNode&gt; left = helper(start, i - <span class="number">1</span>, dp);</span><br><span class="line">            List&lt;TreeNode&gt; right = helper(i + <span class="number">1</span>, end, dp);</span><br><span class="line">            <span class="keyword">for</span>(TreeNode a : left)&#123;</span><br><span class="line">                <span class="keyword">for</span>(TreeNode b : right)&#123;</span><br><span class="line">                    TreeNode node = <span class="keyword">new</span> TreeNode(i);</span><br><span class="line">                    node.left = a;</span><br><span class="line">                    node.right = b;</span><br><span class="line">                    res.add(node);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[start - <span class="number">1</span>][end - <span class="number">1</span>] = res;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Problem-96&quot;&gt;&lt;a href=&quot;#Problem-96&quot; class=&quot;headerlink&quot; title=&quot;Problem 96&quot;&gt;&lt;/a&gt;Problem 96&lt;/h1&gt;&lt;p&gt;Given &lt;em&gt;n&lt;/em&gt;, how many structurall
      
    
    </summary>
    
      <category term="LeetCode" scheme="http://zehai.info/categories/LeetCode/"/>
    
    
      <category term="Medium" scheme="http://zehai.info/tags/Medium/"/>
    
  </entry>
  
  <entry>
    <title>QUIC</title>
    <link href="http://zehai.info/2020/03/16/2020-03-16-QUIC/"/>
    <id>http://zehai.info/2020/03/16/2020-03-16-QUIC/</id>
    <published>2020-03-16T10:24:42.000Z</published>
    <updated>2020-05-30T01:33:31.563Z</updated>
    
    <content type="html"><![CDATA[<h1 id="What"><a href="#What" class="headerlink" title="What"></a>What</h1><p><strong>å¿«é€ŸUDPç½‘ç»œè¿æ¥ï¼ˆQuick UDP Internet Connectionsï¼ŒQUICï¼‰</strong></p><p>æ˜¯ä¸€ç§å®éªŒæ€§çš„ä¼ è¾“å±‚ç½‘ç»œä¼ è¾“åè®®ï¼Œç”±Googleå¼€å‘ï¼Œåœ¨2013å¹´å®ç°ã€‚QUICä½¿ç”¨UDPåè®®ï¼Œå®ƒåœ¨ä¸¤ä¸ªç«¯ç‚¹é—´åˆ›å»ºè¿çº¿ï¼Œä¸”æ”¯æŒå¤šè·¯å¤ç”¨è¿çº¿ã€‚åœ¨è®¾è®¡ä¹‹åˆï¼ŒQUICå¸Œæœ›èƒ½å¤Ÿæä¾›ç­‰åŒäºSSL/TLSå±‚çº§çš„ç½‘ç»œå®‰å…¨ä¿æŠ¤ï¼Œå‡å°‘æ•°æ®ä¼ è¾“åŠåˆ›å»ºè¿çº¿æ—¶çš„å»¶è¿Ÿæ—¶é—´ï¼ŒåŒå‘æ§åˆ¶å¸¦å®½ï¼Œä»¥é¿å…ç½‘ç»œæ‹¥å¡ã€‚Googleå¸Œæœ›ä½¿ç”¨è¿™ä¸ªåè®®æ¥å–ä»£TCPåè®®ï¼Œä½¿ç½‘é¡µä¼ è¾“é€Ÿåº¦åŠ å¿«ã€‚2018å¹´10æœˆï¼ŒIETFçš„HTTPåŠQUICå·¥ä½œå°ç»„æ­£å¼å°†åŸºäºQUICåè®®çš„HTTPï¼ˆHTTP over QUICï¼‰é‡å‘½åä¸ºHTTP/3ä»¥ä¸ºç¡®ç«‹ä¸‹ä¸€ä»£è§„èŒƒåšå‡†å¤‡ã€‚</p><h1 id="Feature"><a href="#Feature" class="headerlink" title="Feature"></a>Feature</h1><p>compared with HTTP2+TCP+TLS</p><ul><li>æ— TCPæ¡æ‰‹åŠTLSæ¡æ‰‹â€“&gt;å¿«</li><li>æ”¹è¿›çš„æ‹¥å¡æ§åˆ¶</li><li>é¿å…é˜Ÿå¤´é˜»å¡çš„å¤šè·¯å¤ç”¨</li><li>å‰å‘å†—ä½™çº é”™</li></ul><h1 id="Reason"><a href="#Reason" class="headerlink" title="Reason"></a>Reason</h1><ul><li>ä¸­é—´è®¾å¤‡åƒµåŒ–ï¼ˆé˜²ç«å¢™ï¼ŒNATç­‰ç¡¬ä»¶è®¾å¤‡å›ºè¯443ï¼Œ80ç«¯å£ï¼ŒNATæ“¦å†™åœ°å€ï¼ŒæŠ›å¼ƒä¸è®¤è¯†çš„é€‰é¡¹å­—æ®µç­‰æ—§è§„åˆ™ï¼‰</li><li>ä¾èµ–æ“ä½œç³»ç»Ÿå®ç°å¯¼è‡´çš„åè®®åƒµåŒ–ï¼ˆä¾èµ–åº•å±‚TCPå¾ˆéš¾å¿«è¿­ä»£ï¼‰</li><li>å»ºç«‹è¿æ¥çš„æ¡æ‰‹å»¶è¿Ÿå¤§ï¼ˆHTTPS/2 use TSL ä½¿å¾—TCPï¼ŒTLSæ¡æ‰‹æ—¶é—´è¾ƒé•¿ï¼‰</li><li>é˜Ÿå¤´é˜»å¡ï¼ˆåºå·é¡ºåºæ¥å—ï¼Œå‰é¢ä¸¢äº†åé¢æ¥å—ç›´æ¥ä¸¢å¼ƒï¼‰</li></ul><h1 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h1><h2 id="RTT"><a href="#RTT" class="headerlink" title="RTT"></a>RTT</h2><p>0RTT (0æ¬¡Round-Trip Time,0æ¬¡å¾€è¿”)å»ºè¿å¯ä»¥è¯´æ˜¯ QUIC ç›¸æ¯” HTTP2 æœ€å¤§çš„æ€§èƒ½ä¼˜åŠ¿ã€‚é‚£ä»€ä¹ˆæ˜¯ 0RTT å»ºè¿å‘¢ï¼Ÿè¿™é‡Œé¢æœ‰ä¸¤å±‚å«ä¹‰ã€‚</p><ol><li>ä¼ è¾“å±‚ 0RTT å°±èƒ½å»ºç«‹è¿æ¥ã€‚</li><li>åŠ å¯†å±‚ 0RTT å°±èƒ½å»ºç«‹åŠ å¯†è¿æ¥ã€‚</li></ol><p><img src="../img/v2-b4b3eb89464b192eed0304e5647a2d26_r.jpg" alt="preview"></p><blockquote><p>ä¸€ä¸ªå®Œæ•´çš„ TLS æ¡æ‰‹éœ€è¦ä¸¤æ¬¡ï¼š</p><ol><li>Client å‘é€ ClientHelloï¼›Server å›å¤ ServerHello</li><li>Client å›å¤æœ€ç»ˆç¡®å®šçš„ Keyï¼ŒFinishedï¼›Server å›å¤ Finished</li><li>æ¡æ‰‹å®Œæ¯•ï¼ŒClient å‘é€åŠ å¯†åçš„ HTTP è¯·æ±‚ï¼›Server å›å¤åŠ å¯†åçš„ HTTP å“åº”</li></ol><p>TLS Session Resumption</p><ol><li>Client å‘é€ ClientHelloï¼ˆåŒ…å« Session IDï¼‰ï¼›Server å›å¤ ServerHello å’Œ Finished</li><li>æ¡æ‰‹å®Œæ¯•ï¼ŒClient å‘é€åŠ å¯†åçš„ HTTP è¯·æ±‚ï¼›Server å›å¤åŠ å¯†åçš„ HTTP å“åº”</li></ol><p>TLS 0RTT</p><p>0 RTT æ˜¯ TLSv1.3 çš„å¯é€‰åŠŸèƒ½ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç¬¬ä¸€æ¬¡å»ºç«‹ä¼šè¯æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ª PSKï¼ˆpre-shared keyï¼‰ã€‚æœåŠ¡å™¨ä¼šç”¨ ticket key å»åŠ å¯† PSKï¼Œä½œä¸º Session Ticket è¿”å›ã€‚ å®¢æˆ·ç«¯å†æ¬¡å’ŒæœåŠ¡å™¨å»ºç«‹ä¼šè¯æ—¶ï¼Œä¼šå…ˆç”¨ PSK å»åŠ å¯† HTTP è¯·æ±‚ï¼Œç„¶åæŠŠåŠ å¯†åçš„å†…å®¹å‘ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨è§£å¯† PSKï¼Œç„¶åå†ç”¨ PSK å»è§£å¯† HTTP è¯·æ±‚ï¼Œå¹¶åŠ å¯† HTTP å“åº”ã€‚</p><p> HTTPS æ¡æ‰‹å·²ç»è·Ÿ HTTP è¯·æ±‚åˆå¹¶åˆ°ä¸€èµ·</p><p>â€‹    1.Client å‘é€ ClientHelloï¼ˆåŒ…å« PSKï¼‰å’ŒåŠ å¯†åçš„ HTTP è¯·æ±‚ï¼›Server å›å¤ ServerHello å’Œ Finished å’ŒåŠ å¯†åçš„ HTTP å“åº”ã€‚</p></blockquote><h2 id="congestion-control"><a href="#congestion-control" class="headerlink" title="congestion control"></a>congestion control</h2><p>TCPé‡‡ç”¨äº†</p><ul><li>æ…¢å¯åŠ¨</li><li>æ‹¥å¡é¿å…</li><li>å¿«é‡ä¼ </li><li>å¿«æ¢å¤</li></ul><p>QUCIé»˜è®¤æ”¯æŒCubicï¼Œå¦å¤–æ”¯æŒCubicBytes,Reno,RenoBytes,BBR,PCC</p><h2 id="Pluggable"><a href="#Pluggable" class="headerlink" title="Pluggable"></a>Pluggable</h2><p>å¯æ’æ‹”ï¼Œå³çµæ´»ç”Ÿæ•ˆä¸éœ€è¦é‡å¯æˆ–æ”¹å˜åº•å±‚</p><ul><li>åº”ç”¨å±‚å®ç°ä¸åŒçš„æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œä¸éœ€è¦åº•å±‚æ”¯æŒ</li><li>å•ä¸ªåº”ç”¨ç¨‹åºçš„ä¸åŒè¿æ¥æ”¯æŒä¸åŒçš„æ‹¥å¡æ§åˆ¶ï¼Œå¦‚BBRï¼ŒCubic</li><li>åº”ç”¨ç¨‹åºæ— éœ€å˜åŠ¨ç›´æ¥å˜æ›´æ‹¥å¡æ§åˆ¶ï¼Œreloadç”Ÿæ•ˆ</li></ul><p>STGWåœ¨é…ç½®å±‚é¢è¿›è¡Œäº†ä¼˜åŒ–ï¼Œé’ˆå¯¹ä¸åŒä¸šåŠ¡ï¼Œä¸åŒç½‘ç»œèŠå£«ï¼Œä¸åŒRTTï¼Œä½¿ç”¨ä¸åŒæ‹¥å¡æ§åˆ¶</p><h2 id="å•é€’å¢çš„Packet-Number"><a href="#å•é€’å¢çš„Packet-Number" class="headerlink" title="å•é€’å¢çš„Packet Number"></a>å•é€’å¢çš„Packet Number</h2><p>ä¸ºäº†ä¿éšœTCPçš„å¯é æ€§ï¼Œä½¿ç”¨Seqï¼ˆsequenceNumber åºå·ï¼‰å’Œackæ¥ç¡®è®¤,Nä¸¢å¤±ï¼Œé‡ä¼ Nï¼ˆé—®é¢˜ï¼šNå¦‚æœé‡ä¼ ä¸¤æ¬¡ï¼Œæ”¶åˆ°ä¸€ä¸ªACKï¼Œä¸çŸ¥é“æ˜¯å“ªä¸ªçš„ACKï¼‰</p><p>QUICä½¿ç”¨PacketNumberä»£æ›¿seqï¼Œå¹¶ä¸”packetnumberä¸¥æ ¼é€’å¢ï¼Œä¹Ÿå°±æ˜¯è¯´å°±ç®— Packet N ä¸¢å¤±äº†ï¼Œé‡ä¼ çš„ Packet N çš„ Packet Number å·²ç»ä¸æ˜¯ Nï¼Œè€Œæ˜¯ä¸€ä¸ªæ¯” N å¤§çš„å€¼,å¦å¤–æ”¯æŒStream offsetæ›´å¥½æ”¯æŒå¤šä¸ªpacketä¼ è¾“</p><h2 id="ä¸å…è®¸Reneging"><a href="#ä¸å…è®¸Reneging" class="headerlink" title="ä¸å…è®¸Reneging"></a>ä¸å…è®¸Reneging</h2><p>renegingï¼šTCPé€šä¿¡æ—¶ï¼Œå¦‚æœå‘é€åºåˆ—ä¸­é—´æŸä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼ŒTCPä¼šé€šè¿‡é‡ä¼ æœ€åç¡®è®¤çš„åŒ…å¼€å§‹çš„åç»­åŒ…ï¼Œè¿™æ ·åŸå…ˆå·²ç»æ­£ç¡®ä¼ è¾“çš„åŒ…ä¹Ÿå¯èƒ½é‡å¤å‘é€ï¼Œæ€¥å‰§é™ä½äº†TCPæ€§èƒ½ã€‚</p><p>ä¸ºæ”¹å–„è¿™ç§æƒ…å†µï¼Œå‘å±•å‡ºSACK(Selective Acknowledgment, é€‰æ‹©æ€§ç¡®è®¤)æŠ€æœ¯ï¼Œä½¿TCPåªé‡æ–°å‘é€ä¸¢å¤±çš„åŒ…ï¼Œä¸ç”¨å‘é€åç»­æ‰€æœ‰çš„åŒ…ï¼Œè€Œä¸”æä¾›ç›¸åº”æœºåˆ¶ä½¿æ¥æ”¶æ–¹èƒ½å‘Šè¯‰å‘é€æ–¹å“ªäº›æ•°æ®ä¸¢å¤±ï¼Œå“ªäº›æ•°æ®é‡å‘äº†ï¼Œå“ªäº›æ•°æ®å·²ç»æå‰æ”¶åˆ°ç­‰</p><p>QUICç¦æ­¢reneging</p><h2 id="æ›´å¤šçš„ackå—"><a href="#æ›´å¤šçš„ackå—" class="headerlink" title="æ›´å¤šçš„ackå—"></a>æ›´å¤šçš„ackå—</h2><p>TCP çš„ Sack é€‰é¡¹èƒ½å¤Ÿå‘Šè¯‰å‘é€æ–¹å·²ç»æ¥æ”¶åˆ°çš„è¿ç»­ Segment çš„èŒƒå›´ï¼Œæ–¹ä¾¿å‘é€æ–¹è¿›è¡Œé€‰æ‹©æ€§é‡ä¼ ã€‚</p><p>ç”±äº TCP å¤´éƒ¨æœ€å¤§åªæœ‰ 60 ä¸ªå­—èŠ‚ï¼Œæ ‡å‡†å¤´éƒ¨å ç”¨äº† 20 å­—èŠ‚ï¼Œæ‰€ä»¥ Tcp Option æœ€å¤§é•¿åº¦åªæœ‰ 40 å­—èŠ‚ï¼Œå†åŠ ä¸Š Tcp Timestamp option å ç”¨äº† 10 ä¸ªå­—èŠ‚ [25]ï¼Œæ‰€ä»¥ç•™ç»™ Sack é€‰é¡¹çš„åªæœ‰ 30 ä¸ªå­—èŠ‚ã€‚</p><p>æ¯ä¸€ä¸ª Sack Block çš„é•¿åº¦æ˜¯ 8 ä¸ªï¼ŒåŠ ä¸Š Sack Option å¤´éƒ¨ 2 ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ„å‘³ç€ Tcp Sack Option æœ€å¤§åªèƒ½æä¾› 3 ä¸ª Blockã€‚</p><p>ä½†æ˜¯ Quic Ack Frame å¯ä»¥åŒæ—¶æä¾› 256 ä¸ª Ack Blockï¼Œåœ¨ä¸¢åŒ…ç‡æ¯”è¾ƒé«˜çš„ç½‘ç»œä¸‹ï¼Œæ›´å¤šçš„ Sack Block å¯ä»¥æå‡ç½‘ç»œçš„æ¢å¤é€Ÿåº¦ï¼Œå‡å°‘é‡ä¼ é‡ã€‚</p><h2 id="ack-delayæ—¶é—´"><a href="#ack-delayæ—¶é—´" class="headerlink" title="ack delayæ—¶é—´"></a>ack delayæ—¶é—´</h2><p>æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åˆ°å“åº”çš„è¿‡ç¨‹æ—¶é—´æˆä¸ºack delay,QUICçš„RTTéœ€è¦å‡æ‰ack delayï¼ˆè®¡ç®—æˆ‘æ˜¯æ²¡çœ‹æ‡‚ã€‚ã€‚ã€‚ï¼‰</p><h2 id="åŸºäºstreamå’Œconnectionçº§åˆ«çš„æµé‡æ§åˆ¶"><a href="#åŸºäºstreamå’Œconnectionçº§åˆ«çš„æµé‡æ§åˆ¶" class="headerlink" title="åŸºäºstreamå’Œconnectionçº§åˆ«çš„æµé‡æ§åˆ¶"></a>åŸºäºstreamå’Œconnectionçº§åˆ«çš„æµé‡æ§åˆ¶</h2><p>ä½œç”¨ï¼š</p><ul><li>streamå¯ä»¥è®¤ä¸ºæ˜¯ä¸€æ¡HTTPè¯·æ±‚</li><li>Connectionå¯ä»¥ç±»æ¯”ä¸€æ¡TCPè¿æ¥ï¼Œåœ¨connectionä¸Šå­˜åœ¨å¤šæ¡stream</li></ul><p>tcpæ‰¿è½½å¤šä¸ªhttpè¯·æ±‚</p><ol><li>window_updateå‘Šè¯‰å¯¹æ–¹è‡ªå·±æ¥å—çš„å­—èŠ‚æ•°</li><li>blockFrameå‘Šè¯‰å¯¹æ–¹ç”±äºæµé‡æ§åˆ¶è¢«é˜»å¡ï¼Œæ— æ³•å‘é€æ•°æ®</li><li>streamå¯ç”¨çª—å£=æœ€å¤§çª—å£æ•°-æ”¶åˆ°çš„æœ€å¤§åç§»æ•°</li><li>connectionå¯ç”¨çª—å£=$\sum$streamså¯ç”¨çª—å£</li></ol><h2 id="æ²¡æœ‰é˜Ÿå¤´é˜»å¡çš„å¤šè·¯å¤ç”¨"><a href="#æ²¡æœ‰é˜Ÿå¤´é˜»å¡çš„å¤šè·¯å¤ç”¨" class="headerlink" title="æ²¡æœ‰é˜Ÿå¤´é˜»å¡çš„å¤šè·¯å¤ç”¨"></a>æ²¡æœ‰é˜Ÿå¤´é˜»å¡çš„å¤šè·¯å¤ç”¨</h2><p>QUIC çš„å¤šè·¯å¤ç”¨å’Œ HTTP2 ç±»ä¼¼ã€‚åœ¨ä¸€æ¡ QUIC è¿æ¥ä¸Šå¯ä»¥å¹¶å‘å‘é€å¤šä¸ª HTTP è¯·æ±‚ (stream)ã€‚ä½†æ˜¯ QUIC çš„å¤šè·¯å¤ç”¨ç›¸æ¯” HTTP2 æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜åŠ¿ã€‚</p><p>QUIC ä¸€ä¸ªè¿æ¥ä¸Šçš„å¤šä¸ª stream ä¹‹é—´æ²¡æœ‰ä¾èµ–ã€‚è¿™æ ·å‡å¦‚ stream2 ä¸¢äº†ä¸€ä¸ª udp packetï¼Œä¹Ÿåªä¼šå½±å“ stream2 çš„å¤„ç†ã€‚ä¸ä¼šå½±å“ stream2 ä¹‹å‰åŠä¹‹åçš„ stream çš„å¤„ç†ã€‚</p><p>è¿™ä¹Ÿå°±åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šç¼“è§£ç”šè‡³æ¶ˆé™¤äº†é˜Ÿå¤´é˜»å¡çš„å½±å“ã€‚</p><p>HTTP2 åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸ŠåŒæ—¶å‘é€ 4 ä¸ª Streamã€‚å…¶ä¸­ Stream1 å·²ç»æ­£ç¡®åˆ°è¾¾ï¼Œå¹¶è¢«åº”ç”¨å±‚è¯»å–ã€‚ä½†æ˜¯ Stream2 çš„ç¬¬ä¸‰ä¸ª tcp segment ä¸¢å¤±äº†ï¼ŒTCP ä¸ºäº†ä¿è¯æ•°æ®çš„å¯é æ€§ï¼Œéœ€è¦å‘é€ç«¯é‡ä¼ ç¬¬ 3 ä¸ª segment æ‰èƒ½é€šçŸ¥åº”ç”¨å±‚è¯»å–æ¥ä¸‹å»çš„æ•°æ®ï¼Œè™½ç„¶è¿™ä¸ªæ—¶å€™ Stream3 å’Œ Stream4 çš„å…¨éƒ¨æ•°æ®å·²ç»åˆ°è¾¾äº†æ¥æ”¶ç«¯ï¼Œä½†éƒ½è¢«é˜»å¡ä½äº†ã€‚</p><p>ä¸ä»…å¦‚æ­¤ï¼Œç”±äº HTTP2 å¼ºåˆ¶ä½¿ç”¨ TLSï¼Œè¿˜å­˜åœ¨ä¸€ä¸ª TLS åè®®å±‚é¢çš„é˜Ÿå¤´é˜»å¡ </p><p>Record æ˜¯ TLS åè®®å¤„ç†çš„æœ€å°å•ä½ï¼Œæœ€å¤§ä¸èƒ½è¶…è¿‡ 16Kï¼Œä¸€äº›æœåŠ¡å™¨æ¯”å¦‚ Nginx é»˜è®¤çš„å¤§å°å°±æ˜¯ 16Kã€‚ç”±äºä¸€ä¸ª record å¿…é¡»ç»è¿‡æ•°æ®ä¸€è‡´æ€§æ ¡éªŒæ‰èƒ½è¿›è¡ŒåŠ è§£å¯†ï¼Œæ‰€ä»¥ä¸€ä¸ª 16K çš„ recordï¼Œå°±ç®—ä¸¢äº†ä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿä¼šå¯¼è‡´å·²ç»æ¥æ”¶åˆ°çš„ 15.99K æ•°æ®æ— æ³•å¤„ç†ï¼Œå› ä¸ºå®ƒä¸å®Œæ•´ã€‚</p><p>é‚£ QUIC å¤šè·¯å¤ç”¨ä¸ºä»€ä¹ˆèƒ½é¿å…ä¸Šè¿°é—®é¢˜å‘¢ï¼Ÿ</p><ol><li>QUIC æœ€åŸºæœ¬çš„ä¼ è¾“å•å…ƒæ˜¯ Packetï¼Œä¸ä¼šè¶…è¿‡ MTU çš„å¤§å°ï¼Œæ•´ä¸ªåŠ å¯†å’Œè®¤è¯è¿‡ç¨‹éƒ½æ˜¯åŸºäº Packet çš„ï¼Œä¸ä¼šè·¨è¶Šå¤šä¸ª Packetã€‚è¿™æ ·å°±èƒ½é¿å… TLS åè®®å­˜åœ¨çš„é˜Ÿå¤´é˜»å¡ã€‚</li><li>Stream ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œæ¯”å¦‚ Stream2 ä¸¢äº†ä¸€ä¸ª Pakcetï¼Œä¸ä¼šå½±å“ Stream3 å’Œ Stream4ã€‚ä¸å­˜åœ¨ TCP é˜Ÿå¤´é˜»å¡ã€‚</li></ol><p>å½“ç„¶ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ QUIC æ•°æ®éƒ½ä¸ä¼šå—åˆ°é˜Ÿå¤´é˜»å¡çš„å½±å“ï¼Œæ¯”å¦‚ QUIC å½“å‰ä¹Ÿæ˜¯ä½¿ç”¨ Hpack å‹ç¼©ç®—æ³• [10]ï¼Œç”±äºç®—æ³•çš„é™åˆ¶ï¼Œä¸¢å¤±ä¸€ä¸ªå¤´éƒ¨æ•°æ®æ—¶ï¼Œå¯èƒ½é‡åˆ°é˜Ÿå¤´é˜»å¡ã€‚</p><p>æ€»ä½“æ¥è¯´ï¼ŒQUIC åœ¨ä¼ è¾“å¤§é‡æ•°æ®æ—¶ï¼Œæ¯”å¦‚è§†é¢‘ï¼Œå—åˆ°é˜Ÿå¤´é˜»å¡çš„å½±å“å¾ˆå°ã€‚</p><h2 id="åŠ å¯†è®¤è¯çš„æŠ¥æ–‡"><a href="#åŠ å¯†è®¤è¯çš„æŠ¥æ–‡" class="headerlink" title="åŠ å¯†è®¤è¯çš„æŠ¥æ–‡"></a>åŠ å¯†è®¤è¯çš„æŠ¥æ–‡</h2><p>TCP åè®®å¤´éƒ¨æ²¡æœ‰ç»è¿‡ä»»ä½•åŠ å¯†å’Œè®¤è¯ï¼Œæ‰€ä»¥åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“è¢«ä¸­é—´ç½‘ç»œè®¾å¤‡ç¯¡æ”¹ï¼Œæ³¨å…¥å’Œçªƒå¬ã€‚æ¯”å¦‚ä¿®æ”¹åºåˆ—å·ã€æ»‘åŠ¨çª—å£ã€‚è¿™äº›è¡Œä¸ºæœ‰å¯èƒ½æ˜¯å‡ºäºæ€§èƒ½ä¼˜åŒ–ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸»åŠ¨æ”»å‡»ã€‚</p><p>ä½†æ˜¯ QUIC çš„ packet å¯ä»¥è¯´æ˜¯æ­¦è£…åˆ°äº†ç‰™é½¿ã€‚é™¤äº†ä¸ªåˆ«æŠ¥æ–‡æ¯”å¦‚ PUBLIC_RESET å’Œ CHLOï¼Œæ‰€æœ‰æŠ¥æ–‡å¤´éƒ¨éƒ½æ˜¯ç»è¿‡è®¤è¯çš„ï¼ŒæŠ¥æ–‡ Body éƒ½æ˜¯ç»è¿‡åŠ å¯†çš„ã€‚</p><p>è¿™æ ·åªè¦å¯¹ QUIC æŠ¥æ–‡ä»»ä½•ä¿®æ”¹ï¼Œæ¥æ”¶ç«¯éƒ½èƒ½å¤ŸåŠæ—¶å‘ç°ï¼Œæœ‰æ•ˆåœ°é™ä½äº†å®‰å…¨é£é™©ã€‚</p><h2 id="è¿æ¥è¿ç§»"><a href="#è¿æ¥è¿ç§»" class="headerlink" title="è¿æ¥è¿ç§»"></a>è¿æ¥è¿ç§»</h2><p>ä¸€æ¡ TCP è¿æ¥ [17] æ˜¯ç”±å››å…ƒç»„æ ‡è¯†çš„ï¼ˆæº IPï¼Œæºç«¯å£ï¼Œç›®çš„ IPï¼Œç›®çš„ç«¯å£ï¼‰,å½“å…¶ä¸­ä»»ä½•ä¸€ä¸ªå…ƒç´ å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™æ¡è¿æ¥ä¾ç„¶ç»´æŒç€ï¼Œèƒ½å¤Ÿä¿æŒä¸šåŠ¡é€»è¾‘ä¸ä¸­æ–­</p><p>æ¯”å¦‚å¤§å®¶ä½¿ç”¨æ‰‹æœºåœ¨ WIFI å’Œ 4G ç§»åŠ¨ç½‘ç»œåˆ‡æ¢æ—¶ï¼Œå®¢æˆ·ç«¯çš„ IP è‚¯å®šä¼šå‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦é‡æ–°å»ºç«‹å’ŒæœåŠ¡ç«¯çš„ TCP è¿æ¥ã€‚</p><p>åˆæ¯”å¦‚å¤§å®¶ä½¿ç”¨å…¬å…± NAT å‡ºå£æ—¶ï¼Œæœ‰äº›è¿æ¥ç«äº‰æ—¶éœ€è¦é‡æ–°ç»‘å®šç«¯å£ï¼Œå¯¼è‡´å®¢æˆ·ç«¯çš„ç«¯å£å‘ç”Ÿå˜åŒ–ï¼ŒåŒæ ·éœ€è¦é‡æ–°å»ºç«‹ TCP è¿æ¥ã€‚</p><p>é’ˆå¯¹ TCP çš„è¿æ¥å˜åŒ–ï¼ŒMPTCP[5] å…¶å®å·²ç»æœ‰äº†è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ç”±äº MPTCP éœ€è¦æ“ä½œç³»ç»ŸåŠç½‘ç»œåè®®æ ˆæ”¯æŒï¼Œéƒ¨ç½²é˜»åŠ›éå¸¸å¤§ï¼Œç›®å‰å¹¶ä¸é€‚ç”¨ã€‚</p><p>æ‰€ä»¥ä» TCP è¿æ¥çš„è§’åº¦æ¥è®²ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯æ— è§£çš„ã€‚</p><p>é‚£ QUIC æ˜¯å¦‚ä½•åšåˆ°è¿æ¥è¿ç§»å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œä»»ä½•ä¸€æ¡ QUIC è¿æ¥ä¸å†ä»¥ IP åŠç«¯å£å››å…ƒç»„æ ‡è¯†ï¼Œè€Œæ˜¯ä»¥ä¸€ä¸ª<code>64 ä½çš„éšæœºæ•°</code>ä½œä¸º ID æ¥æ ‡è¯†ï¼Œè¿™æ ·å°±ç®— IP æˆ–è€…ç«¯å£å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªè¦ ID ä¸å˜ï¼Œè¿™æ¡è¿æ¥ä¾ç„¶ç»´æŒç€ï¼Œä¸Šå±‚ä¸šåŠ¡é€»è¾‘æ„ŸçŸ¥ä¸åˆ°å˜åŒ–ï¼Œä¸ä¼šä¸­æ–­ï¼Œä¹Ÿå°±ä¸éœ€è¦é‡è¿ã€‚</p><p>ç”±äºè¿™ä¸ª ID æ˜¯å®¢æˆ·ç«¯éšæœºäº§ç”Ÿçš„ï¼Œå¹¶ä¸”é•¿åº¦æœ‰ 64 ä½ï¼Œæ‰€ä»¥å†²çªæ¦‚ç‡éå¸¸ä½ã€‚</p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>æ­¤å¤–ï¼ŒQUIC è¿˜èƒ½å®ç°å‰å‘å†—ä½™çº é”™ï¼Œåœ¨é‡è¦çš„åŒ…æ¯”å¦‚æ¡æ‰‹æ¶ˆæ¯å‘ç”Ÿä¸¢å¤±æ—¶ï¼Œèƒ½å¤Ÿæ ¹æ®å†—ä½™ä¿¡æ¯è¿˜åŸå‡ºæ¡æ‰‹æ¶ˆæ¯ã€‚</p><p>QUIC è¿˜èƒ½å®ç°è¯ä¹¦å‹ç¼©ï¼Œå‡å°‘è¯ä¹¦ä¼ è¾“é‡ï¼Œé’ˆå¯¹åŒ…å¤´è¿›è¡ŒéªŒè¯ç­‰ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;What&quot;&gt;&lt;a href=&quot;#What&quot; class=&quot;headerlink&quot; title=&quot;What&quot;&gt;&lt;/a&gt;What&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;å¿«é€ŸUDPç½‘ç»œè¿æ¥ï¼ˆQuick UDP Internet Connectionsï¼ŒQUICï¼‰&lt;/strong
      
    
    </summary>
    
      <category term="Introduction" scheme="http://zehai.info/categories/Introduction/"/>
    
    
      <category term="QUIC" scheme="http://zehai.info/tags/QUIC/"/>
    
  </entry>
  
  <entry>
    <title>Traversal</title>
    <link href="http://zehai.info/2020/03/15/2020-03-15-BinaryTreeLevelOrderTraversal/"/>
    <id>http://zehai.info/2020/03/15/2020-03-15-BinaryTreeLevelOrderTraversal/</id>
    <published>2020-03-15T09:23:39.000Z</published>
    <updated>2020-05-30T01:33:31.562Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Problem-102-107"><a href="#Problem-102-107" class="headerlink" title="Problem 102 107"></a>Problem 102 107</h1><p>Given a binary tree, return the <em>level order</em> traversal of its nodesâ€™ values. (ie, from left to right, level by level).</p><p>For example:<br>Given binary tree <code>[3,9,20,null,null,15,7]</code>,</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>return its level order traversal as:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  [3],</span><br><span class="line">  [9,20],</span><br><span class="line">  [15,7]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>keyï¼š</p><ul><li>å±‚åºéå†</li><li>é€’å½’</li></ul><p>åœ¨Javaä¸­å¯ä»¥å…ˆå®šä¹‰ä¸€ä¸ªListä¿å­˜ç»“æœ,Listé‡Œé¢å†åµŒå…¥ArrayListæ¥è®°å½•æ¯ä¸€å±‚çš„æ•°æ®</p><blockquote><p>List&lt;List<integer>&gt; res = new ArrayList&lt;&gt;();</integer></p><p>res.add(new ArrayList&lt;&gt;());</p></blockquote><p>å°†é€’å½’ä¸­çš„rootèŠ‚ç‚¹è¿½åŠ è¿›å…¥res.get(level)çš„æ•°ç»„ä¸­</p><blockquote><p>  res.get(level).add(root.val);</p></blockquote><p>é€šè¿‡é€’å½’å®Œæˆç®—æ³•</p><blockquote><p>travelsal(root.left,level+1);<br>travelsal(root.right,level+1);</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; levelOrder(TreeNode root) &#123;</span><br><span class="line">        travelsal(root, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span>  res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">travelsal</span><span class="params">(TreeNode root,<span class="keyword">int</span> level)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(level==res.size())&#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">        &#125;</span><br><span class="line">        res.get(level).add(root.val);</span><br><span class="line">        travelsal(root.left,level+<span class="number">1</span>);</span><br><span class="line">        travelsal(root.right,level+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>æ¥ä¸‹æ¥æ˜¯107ï¼Œæ˜¯102çš„å˜ç§ï¼Œæ”¹æˆäº†å¶èŠ‚ç‚¹å¼€å§‹éå†</p><p>difficultyï¼šEasy</p><p>Given a binary tree, return the <em>bottom-up level order</em> traversal of its nodesâ€™ values. (ie, from left to right, level by level from leaf to root).</p><p>For example:<br>Given binary tree <code>[3,9,20,null,null,15,7]</code>,</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>return its bottom-up level order traversal as:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  [15,7],</span><br><span class="line">  [9,20],</span><br><span class="line">  [3]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h1 id="key"><a href="#key" class="headerlink" title="key"></a>key</h1><p>é¢˜ç›®æœ¬èº«æ²¡æœ‰è®¾ç½®å¤ªå¤šçš„éš¾åº¦ï¼Œæˆ‘ä»¬åªéœ€è¦å°†<strong>level</strong>å®ç°æ•°ç»„çš„å†…å±‚æ•°ç»„çš„å€’åºå°±å¯ä»¥äº†</p><blockquote><p> res.get(level).add(root.val);<br> change this code to<br> res.get(res.size()-i-1).add(root.val);</p></blockquote><p>åŸæœ¬åˆ¤æ–­æ–°å¢æ•°ç»„çš„è¯­å¥å˜æˆåœ¨ç¬¬0ä¸ªä½ç½®æ–°å¢ä¸€ä¸ªæ•°ç»„</p><blockquote><p>if(i &gt;= res.size()){<br>    res.add(0,new ArrayList<integer>());<br>}</integer></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Problem-102-107&quot;&gt;&lt;a href=&quot;#Problem-102-107&quot; class=&quot;headerlink&quot; title=&quot;Problem 102 107&quot;&gt;&lt;/a&gt;Problem 102 107&lt;/h1&gt;&lt;p&gt;Given a binary tre
      
    
    </summary>
    
      <category term="LeetCode" scheme="http://zehai.info/categories/LeetCode/"/>
    
    
      <category term="Medium" scheme="http://zehai.info/tags/Medium/"/>
    
  </entry>
  
  <entry>
    <title>Eggæ’ä»¶åˆ°åº•å°è£…äº†å•¥</title>
    <link href="http://zehai.info/2020/03/13/2020-03-13-Egg%E6%8F%92%E4%BB%B6%E5%88%B0%E5%BA%95%E5%B0%81%E8%A3%85%E4%BA%86%E5%95%A5/"/>
    <id>http://zehai.info/2020/03/13/2020-03-13-Eggæ’ä»¶åˆ°åº•å°è£…äº†å•¥/</id>
    <published>2020-03-13T05:23:12.000Z</published>
    <updated>2020-05-30T01:33:31.562Z</updated>
    
    <content type="html"><![CDATA[<p>è¿«äºæ¯”è¾ƒå¥½å¥‡ï¼Œä¸‹è½½äº†egg-redisï¼Œçœ‹çœ‹ä»–å¦‚ä½•å°†nodeç›´æ¥å¯ä»¥å¼•ç”¨çš„åŒ…ï¼Œå°è£…æˆä¸ºeggçš„æ’ä»¶<br><img src="../img/1584077589714.png" alt="1584077589714"></p><p>æ ¸å¿ƒä»£ç é€šè¿‡</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿«äºæ¯”è¾ƒå¥½å¥‡ï¼Œä¸‹è½½äº†egg-redisï¼Œçœ‹çœ‹ä»–å¦‚ä½•å°†nodeç›´æ¥å¯ä»¥å¼•ç”¨çš„åŒ…ï¼Œå°è£…æˆä¸ºeggçš„æ’ä»¶&lt;br&gt;&lt;img src=&quot;../img/1584077589714.png&quot; alt=&quot;1584077589714&quot;&gt;&lt;/p&gt;
&lt;p&gt;æ ¸å¿ƒä»£ç é€šè¿‡&lt;/p&gt;

      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="http://zehai.info/2020/03/11/2020-03-11-MaximumDepthOfBinaryTree/"/>
    <id>http://zehai.info/2020/03/11/2020-03-11-MaximumDepthOfBinaryTree/</id>
    <published>2020-03-11T09:47:55.000Z</published>
    <updated>2020-05-30T01:33:31.562Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Prolem-104"><a href="#Prolem-104" class="headerlink" title="Prolem 104"></a>Prolem 104</h1><p>Given a binary tree, find its maximum depth.</p><p>The maximum depth is the number of nodes along the longest path from the root node down to the farthest leaf node.</p><p><strong>Note:</strong> A leaf is a node with no children.</p><p><strong>Example:</strong></p><p>Given binary tree <code>[3,9,20,null,null,15,7]</code>,</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>return its depth = 3.</p><h2 id="key"><a href="#key" class="headerlink" title="key"></a>key</h2><p>åˆ¤æ–­æ ‘çš„æ·±æµ…ï¼Œé‡‡ç”¨</p><blockquote><p>int left = max(root.left);<br><strong>int</strong> right = max(root.right);<br><strong>return</strong> Math.max(left,right) + 1; </p></blockquote><blockquote><p>//æˆ–è€…ç®€å†™</p><p>return Math.max(max(root.left) + 1, max(root.right) + 1);</p></blockquote><p>è¿›è¡Œé€’å½’</p><blockquote><p>Runtime: 0 ms, faster than 100.00% of Java online submissions for Maximum Depth of Binary Tree.</p><p>Memory Usage: 39.2 MB, less than 94.62% of Java online submissions for Maximum Depth of Binary Tree.</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxDepth</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> max(root);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">max</span><span class="params">(TreeNode root)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Math.max(max(root.left) + <span class="number">1</span>, max(root.right) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Prolem-104&quot;&gt;&lt;a href=&quot;#Prolem-104&quot; class=&quot;headerlink&quot; title=&quot;Prolem 104&quot;&gt;&lt;/a&gt;Prolem 104&lt;/h1&gt;&lt;p&gt;Given a binary tree, find its maximum 
      
    
    </summary>
    
      <category term="LeetCode" scheme="http://zehai.info/categories/LeetCode/"/>
    
    
      <category term="Easy" scheme="http://zehai.info/tags/Easy/"/>
    
  </entry>
  
  <entry>
    <title>SymmetricTree</title>
    <link href="http://zehai.info/2020/03/10/2020-03-10-SymmetricTree/"/>
    <id>http://zehai.info/2020/03/10/2020-03-10-SymmetricTree/</id>
    <published>2020-03-10T10:33:33.000Z</published>
    <updated>2020-05-30T01:33:31.562Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Problem101"><a href="#Problem101" class="headerlink" title="Problem101"></a>Problem101</h1><p>Given a binary tree, check whether it is a mirror of itself (ie, symmetric around its center).</p><p>For example, this binary tree <code>[1,2,2,3,4,4,3]</code> is symmetric:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   2</span><br><span class="line"> / \ / \</span><br><span class="line">3  4 4  3</span><br></pre></td></tr></table></figure><p>But the following <code>[1,2,2,null,3,null,3]</code> is not:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  1</span><br><span class="line"> / \</span><br><span class="line">2   2</span><br><span class="line"> \   \</span><br><span class="line"> 3    3</span><br></pre></td></tr></table></figure><p><strong>Note:</strong><br>Bonus points if you could solve it both recursively and iteratively.</p><h2 id="key"><a href="#key" class="headerlink" title="key"></a>key</h2><p>ä¸€é“éªŒè¯æ ‘æ˜¯å¦æ˜¯å¯¹ç§°çš„é—®é¢˜ï¼Œä¸»è¦é‡‡å–é€’å½’çš„æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Definition for a binary tree node.</span><br><span class="line"> * public class TreeNode &#123;</span><br><span class="line"> *     int val;</span><br><span class="line"> *     TreeNode left;</span><br><span class="line"> *     TreeNode right;</span><br><span class="line"> *     TreeNode(int x) &#123; val = x; &#125;</span><br><span class="line"> * &#125;</span><br><span class="line"> */</span><br><span class="line">class Solution &#123;</span><br><span class="line">    public boolean isSymmetric(TreeNode root) &#123;</span><br><span class="line">        return isMirror(root,root);</span><br><span class="line">    &#125;</span><br><span class="line">    public boolean isMirror(TreeNode root,TreeNode self)&#123;</span><br><span class="line">        if(root==null &amp;&amp; self==null)return true;</span><br><span class="line">        if(root==null ||self==null) return false;</span><br><span class="line">        return root.val==self.val &amp;&amp; isMirror(root.left,self.right)&amp;&amp;isMirror(root.right,self.left);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Problem101&quot;&gt;&lt;a href=&quot;#Problem101&quot; class=&quot;headerlink&quot; title=&quot;Problem101&quot;&gt;&lt;/a&gt;Problem101&lt;/h1&gt;&lt;p&gt;Given a binary tree, check whether it 
      
    
    </summary>
    
      <category term="LeetCode" scheme="http://zehai.info/categories/LeetCode/"/>
    
    
      <category term="Easy" scheme="http://zehai.info/tags/Easy/"/>
    
  </entry>
  
  <entry>
    <title>AMDvsCMD</title>
    <link href="http://zehai.info/2020/03/09/2020-03-09-AMDvsCMD/"/>
    <id>http://zehai.info/2020/03/09/2020-03-09-AMDvsCMD/</id>
    <published>2020-03-09T02:46:11.000Z</published>
    <updated>2020-05-30T01:33:31.562Z</updated>
    
    <content type="html"><![CDATA[<p>AMD:Asynchronous Module Definition (RequireJS)</p><p>CMD:<a href="https://github.com/cmdjs/specification/blob/master/draft/module.md" target="_blank" rel="noopener">Common Module Definition</a>ï¼ˆSeaJSï¼‰</p><table><thead><tr><th></th><th>AMD</th><th>CMD</th></tr></thead><tbody><tr><td>1.</td><td>æå‰æ‰§è¡Œ</td><td>å»¶è¿Ÿæ‰§è¡Œï¼ˆç±»ä¼¼é¥¿æ±‰æ¨¡å¼ï¼‰</td></tr><tr><td>2.</td><td>ä¾èµ–å‰ç½®</td><td>ä¾èµ–å°±è¿‘</td></tr><tr><td>3.</td><td>æµè§ˆå™¨ï¼ˆåŠ è½½ç¼“æ…¢ï¼Œå¼‚æ­¥loadæ›´å¥½ï¼‰</td><td>æœåŠ¡å™¨ç«¯</td></tr><tr><td>4.</td><td>å¼‚æ­¥æ¨¡å—å®šä¹‰</td><td>é€šç”¨æ¨¡å—å®šä¹‰</td></tr></tbody></table><h1 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h1><p>å¾…è¡¥å……ï¼Œimport-export</p><h1 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h1><h2 id="define-Function"><a href="#define-Function" class="headerlink" title="define Function"></a>define Function</h2><p>ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œåœ¨æˆ‘ä»¬çš„ä»£ç å¤–å±‚ï¼Œä¼šå¥—ä¸Šä¸€å±‚CMDè§„èŒƒ,è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥<strong>ç›´æ¥å¼•ç”¨require,export,moduleçš„åŸå› </strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">define(function(require, exports, module) &#123;</span><br><span class="line">  // code</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å•ä¸ªå‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define(factory)</span><br><span class="line">param--&gt;factory:funtion|Object|String</span><br><span class="line">define(&#123; &quot;foo&quot;: &quot;bar&quot; &#125;);</span><br><span class="line">define(&apos;I am a template. My name is &#123;&#123;name&#125;&#125;.&apos;);</span><br></pre></td></tr></table></figure><p>å¤šä¸ªå‚æ•°define <code>define(id?, deps?, factory)</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">define(&apos;hello&apos;, [&apos;jquery&apos;], function(require, exports, module) &#123;</span><br><span class="line">  // code</span><br><span class="line">&#125;);</span><br><span class="line">idï¼šStringæ¨¡å—æ ‡è¯†</span><br><span class="line">depsï¼šArrayæ¨¡å—ä¾èµ–</span><br></pre></td></tr></table></figure><p>define.cmd Object</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (typeof define === &quot;function&quot; &amp;&amp; define.cmd) &#123;</span><br><span class="line">  // æœ‰ Sea.js ç­‰ CMD æ¨¡å—åŠ è½½å™¨å­˜åœ¨</span><br><span class="line">&#125;</span><br><span class="line">//ç”¨æ¥åˆ¤æ–­å½“å‰é¡µé¢æ˜¯å¦æœ‰CMDæ¨¡å—åŠ è½½å™¨</span><br></pre></td></tr></table></figure><h2 id="require-Function"><a href="#require-Function" class="headerlink" title="require Function"></a>require Function</h2><p>åŒæ­¥åŠ è½½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">define(function(require, exports) &#123;</span><br><span class="line"></span><br><span class="line">  // è·å–æ¨¡å— a çš„æ¥å£</span><br><span class="line">  var a = require(&apos;./a&apos;);</span><br><span class="line"></span><br><span class="line">  // è°ƒç”¨æ¨¡å— a çš„æ–¹æ³•</span><br><span class="line">  a.doSomething();</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="require-async-Function"><a href="#require-async-Function" class="headerlink" title="require.async Function"></a>require.async Function</h2><p>å¼‚æ­¥åŠ è½½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">define(function(require, exports, module) &#123;</span><br><span class="line"></span><br><span class="line">  // å¼‚æ­¥åŠ è½½ä¸€ä¸ªæ¨¡å—ï¼Œåœ¨åŠ è½½å®Œæˆæ—¶ï¼Œæ‰§è¡Œå›è°ƒ</span><br><span class="line">  require.async(&apos;./b&apos;, function(b) &#123;</span><br><span class="line">    b.doSomething();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // å¼‚æ­¥åŠ è½½å¤šä¸ªæ¨¡å—ï¼Œåœ¨åŠ è½½å®Œæˆæ—¶ï¼Œæ‰§è¡Œå›è°ƒ</span><br><span class="line">  require.async([&apos;./c&apos;, &apos;./d&apos;], function(c, d) &#123;</span><br><span class="line">    c.doSomething();</span><br><span class="line">    d.doSomething();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="require-resolve"><a href="#require-resolve" class="headerlink" title="require.resolve"></a>require.resolve</h2><p>è¿”å›è§£æåçš„ç»å¯¹è·¯å¾„</p><h2 id="exprots"><a href="#exprots" class="headerlink" title="exprots"></a>exprots</h2><p>return Objectï¼Œå¯¹å¤–æä¾›æ¥å£</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">define(function(require, exports) &#123;</span><br><span class="line"></span><br><span class="line">  // å¯¹å¤–æä¾› foo å±æ€§</span><br><span class="line">  exports.foo = &apos;bar&apos;;</span><br><span class="line"></span><br><span class="line">  // å¯¹å¤–æä¾› doSomething æ–¹æ³•</span><br><span class="line">  exports.doSomething = function() &#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">retrunå¯ä»¥å®ç°åŒç­‰æ•ˆæœ</span><br><span class="line">define(function(require) &#123;</span><br><span class="line"></span><br><span class="line">  // é€šè¿‡ return ç›´æ¥æä¾›æ¥å£</span><br><span class="line">  return &#123;</span><br><span class="line">    foo: &apos;bar&apos;,</span><br><span class="line">    doSomething: function() &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">ä»¥åŠä¸ªäººä¸å¤ªå–œæ¬¢çš„ç¼©ç•¥å†™æ³•</span><br><span class="line">define(&#123;</span><br><span class="line">  foo: &apos;bar&apos;,</span><br><span class="line">  doSomething: function() &#123;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>ä½†ä»¥ä¸‹å†™æ³•æ˜¯é”™è¯¯çš„</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">define(function(require, exports) &#123;</span><br><span class="line"></span><br><span class="line">  // é”™è¯¯ç”¨æ³•ï¼ï¼!</span><br><span class="line">  exports = &#123;</span><br><span class="line">    foo: &apos;bar&apos;,</span><br><span class="line">    doSomething: function() &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>exports</code> ä»…ä»…æ˜¯ <code>module.exports</code> çš„ä¸€ä¸ªå¼•ç”¨ã€‚åœ¨ <code>factory</code> å†…éƒ¨ç»™ <code>exports</code> é‡æ–°èµ‹å€¼æ—¶ï¼Œå¹¶ä¸ä¼šæ”¹å˜ <code>module.exports</code> çš„å€¼ã€‚å› æ­¤ç»™ <code>exports</code> èµ‹å€¼æ˜¯æ— æ•ˆçš„ï¼Œä¸èƒ½ç”¨æ¥æ›´æ”¹æ¨¡å—æ¥å£ã€‚</p><p>æˆ‘è¯´å¥ç®€å•çš„è¯ï¼šexportså’Œmodule.exportsï¼Œéƒ½æ˜¯åœ°å€ï¼ŒæŒ‡å‘åŒä¸€ä¸ªå†…å®¹ï¼Œå¦‚æœä½ ç»™exportsèµ‹å€¼äº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä»–æŒ‡å‘çš„å†…å®¹å°±å®Œå…¨å˜äº†ï¼Œå’Œmodule.exprotså°±æŒ‡å‘ä¸æ˜¯åŒä¸€ä¸ªåœ°æ–¹äº†</p><h2 id="module"><a href="#module" class="headerlink" title="module"></a>module</h2><p>modeuleæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå­˜å‚¨ä¸å½“å‰æ¨¡å—ç›¸å…³è”çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•ï¼Œé»˜è®¤ä¸º{}</p><p>module:function</p><p>module.id:Stringæ¨¡å—æ ‡è¯†</p><p>module.urlï¼šStringè¿”å›ç»å¯¹è·¯å¾„ï¼ˆé»˜è®¤id=urlï¼Œé™¤éæ‰‹å†™idï¼‰</p><p>module.dependencies:Arrayæ¨¡å—ä¾èµ–</p><p>module.export:Object å¤§éƒ¨åˆ†æƒ…å†µä¸‹å’Œexportsé€šç”¨ï¼Œä½†å¦‚æœæ¨¡å—æ˜¯ä¸€ä¸ªç±»ï¼Œå°±åº”è¯¥ç›´æ¥èµ‹å€¼ç»™module.exportsï¼Œè¿™æ ·è°ƒç”¨å°±æ˜¯ä¸€ä¸ªç±»çš„æ„é€ å™¨ï¼Œå¯ä»¥ç›´æ¥newå®ä¾‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">module.exports=new Person();</span><br><span class="line">const p = require(./xxx.js);</span><br><span class="line">p.say();</span><br><span class="line">//or</span><br><span class="line">exports.p = new Person();</span><br><span class="line">const &#123;p&#125; = require(./xxxjs);</span><br><span class="line">p.say();</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;AMD:Asynchronous Module Definition (RequireJS)&lt;/p&gt;
&lt;p&gt;CMD:&lt;a href=&quot;https://github.com/cmdjs/specification/blob/master/draft/module.md&quot; ta
      
    
    </summary>
    
      <category term="JavaScript" scheme="http://zehai.info/categories/JavaScript/"/>
    
    
      <category term="other" scheme="http://zehai.info/tags/other/"/>
    
  </entry>
  
</feed>
